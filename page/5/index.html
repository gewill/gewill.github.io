<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
<meta property="og:type" content="website">
<meta property="og:title" content="Will&#39;s Blog">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Will&#39;s Blog">
<meta property="og:description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ge Will">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Will's Blog</title>
  







<head>
    <!-- 霞鹜文楷字体 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css"/>

    <!-- datapulse统计 -->
    <script defer type="text/javascript" src="https://datapulse.app/datapulse.min.js" id="datapulse" data-endpoint="https://datapulse.app/api/v1/event" data-workspace="cljxqml5q0y0f8j37d4futnbl"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DR0FC9YJLH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-DR0FC9YJLH');
    </script>
</head>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Will's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">198</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">17</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">1</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ge Will"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Ge Will</p>
  <div class="site-description" itemprop="description">The people who are crazy enough to think they can change the world, are the ones who DO.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">198</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/gewill" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gewill" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:531sunlight@gmail.com" title="E-Mail → mailto:531sunlight@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/gewei" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;gewei" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/BoJack_D" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;BoJack_D" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/01/Data-Structures-and-Algorithms-in-Swift-Notes-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/01/Data-Structures-and-Algorithms-in-Swift-Notes-1/" class="post-title-link" itemprop="url">Swift数据结构和算法（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-08-01 14:59:59" itemprop="dateCreated datePublished" datetime="2019-08-01T14:59:59+08:00">2019-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="第一部分：引言"><a href="#第一部分：引言" class="headerlink" title="第一部分：引言"></a>第一部分：引言</h2><h3 id="第一章：前言"><a href="#第一章：前言" class="headerlink" title="第一章：前言"></a>第一章：前言</h3><p>数据结构是一门经过充分研究的学科，其概念与语言无关; 来自C的数据结构在功能上和概念上与任何其他语言中的相同数据结构相同，例如Swift。 与此同时，Swift的高级表现力使其成为学习这些核心概念的理想选择，而不会牺牲太多的性能。</p>
<p>Swift标准库有一小组通用集合类型; 他们甚至没有涵盖每一个案例。正如您将看到的，这些 原始的类型可以用作构建更复杂和特殊用途构造的一个很好的起点。 了解比标准数组和字典更多的数据结构，您可以使用更多的工具来构建自己的应用程序。</p>
<h3 id="第二章：Swift标准库"><a href="#第二章：Swift标准库" class="headerlink" title="第二章：Swift标准库"></a>第二章：Swift标准库</h3><p>在开始构建自己的自定义数据结构之前，了解Swift标准库已经提供的主要数据结构非常重要。</p>
<p>字典缺乏明确的排序劣势，却又带来了一些其他的优点。 与数组不同，字典不需要担心元素的转移。 插入字典总是O(1)。 查找操作也在O(1)时间内完成，这比在需要O(n)扫描的数组中找到特定元素要快得多。</p>
<h3 id="第三章：复杂度"><a href="#第三章：复杂度" class="headerlink" title="第三章：复杂度"></a>第三章：复杂度</h3><p>常见的时间复杂度和空间复杂度。</p>
<p>对于计算机，算法的资源是内存。空间复杂度就意味着内存占用率。</p>
<p><strong>总结</strong></p>
<ul>
<li><p>时间复杂度衡量输入大小增加时运行算法所需的时间。</p>
</li>
<li><p>空间复杂度衡量算法运行所需的资源。</p>
</li>
<li><p>Big O表示法用于表示时间和空间复杂性的一般形式。</p>
</li>
<li><p>时间和空间复杂性是可扩展性的高级度量; 它们不测量算法本身的实际速度。</p>
</li>
<li><p>对于小型数据集，时间复杂度通常无关紧要。 拟线性算法可能比线性算法慢。</p>
</li>
</ul>
<h2 id="第二部分：基本数据类型"><a href="#第二部分：基本数据类型" class="headerlink" title="第二部分：基本数据类型"></a>第二部分：基本数据类型</h2><h3 id="第四章：链表"><a href="#第四章：链表" class="headerlink" title="第四章：链表"></a>第四章：链表</h3><p>链表是以线性单向序列排列的值的集合。链表比连续存储选项（如Swift数组）具有几个理论上的优势：</p>
<ul>
<li>从列表前面插入和删除恒定时间。</li>
<li>可靠的性能特征。</li>
</ul>
<p><img src="https://gewill.org/assets/image-20190801154442688.png" alt="image-20190801154442688"></p>
<p>如图所示，链表是一系列节点。 节点有两个职责：</p>
<p>1.保存一个值。</p>
<p>2.保存对下一个节点的引用。 空表示列表的结尾。<img src="https://gewill.org/assets/image-20190801154554314.png" alt="image-20190801154554314"></p>
<p>节点</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;<span class="title class_">Value</span>&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">Value</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> next: <span class="type">Node</span>?</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">value</span>: <span class="type">Value</span>, <span class="params">next</span>: <span class="type">Node</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">    <span class="keyword">self</span>.next <span class="operator">=</span> next</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>链表</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">LinkedList</span>&lt;<span class="title class_">Value</span>&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> head: <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;?</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> tail: <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;?</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> head <span class="operator">==</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// MARK: - 增加和删除节点的方法</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 时间复杂度：O(1)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">push</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Value</span>) &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    head <span class="operator">=</span> <span class="type">Node</span>(value: value, next: head)</span><br><span class="line">    <span class="keyword">if</span> tail <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">      tail <span class="operator">=</span> head</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 时间复杂度：O(1)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Value</span>) &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">      push(value)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    tail<span class="operator">!</span>.next <span class="operator">=</span> <span class="type">Node</span>(value: value)</span><br><span class="line">    tail <span class="operator">=</span> tail<span class="operator">!</span>.next</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 时间复杂度：O(i) , i 就是给定的index</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">node</span>(<span class="params">at</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;? &#123;</span><br><span class="line">    <span class="keyword">var</span> currentNode <span class="operator">=</span> head</span><br><span class="line">    <span class="keyword">var</span> currentIndex <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> currentNode <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> currentIndex <span class="operator">&lt;</span> index &#123;</span><br><span class="line">      currentNode <span class="operator">=</span> currentNode<span class="operator">!</span>.next</span><br><span class="line">      currentIndex <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 时间复杂度：O(1)</span></span><br><span class="line">  <span class="keyword">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">insert</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Value</span>, <span class="params">after</span> <span class="params">node</span>: <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;) -&gt; <span class="type">Node</span>&lt;<span class="type">Value</span>&gt; &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    <span class="keyword">guard</span> tail <span class="operator">!==</span> node <span class="keyword">else</span> &#123;</span><br><span class="line">      append(value)</span><br><span class="line">      <span class="keyword">return</span> tail<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    node.next <span class="operator">=</span> <span class="type">Node</span>(value: value, next: node.next)</span><br><span class="line">    <span class="keyword">return</span> node.next<span class="operator">!</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 时间复杂度：O(1)  </span></span><br><span class="line">  <span class="keyword">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">pop</span>() -&gt; <span class="type">Value</span>? &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">      head <span class="operator">=</span> head<span class="operator">?</span>.next</span><br><span class="line">      <span class="keyword">if</span> isEmpty &#123;</span><br><span class="line">        tail <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head<span class="operator">?</span>.value</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 时间复杂度：O(n)</span></span><br><span class="line">  <span class="keyword">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">removeLast</span>() -&gt; <span class="type">Value</span>? &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> head <span class="operator">=</span> head <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">guard</span> head.next <span class="operator">!=</span> <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> pop()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> prev <span class="operator">=</span> head</span><br><span class="line">    <span class="keyword">var</span> current <span class="operator">=</span> head</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> next <span class="operator">=</span> current.next &#123;</span><br><span class="line">      prev <span class="operator">=</span> current</span><br><span class="line">      current <span class="operator">=</span> next</span><br><span class="line">    &#125;</span><br><span class="line">    prev.next <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    tail <span class="operator">=</span> prev</span><br><span class="line">    <span class="keyword">return</span> current.value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 时间复杂度：O(1)  </span></span><br><span class="line">  <span class="keyword">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="params">after</span> <span class="params">node</span>: <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;) -&gt; <span class="type">Value</span>? &#123;</span><br><span class="line">    copyNodes()</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> node.next <span class="operator">===</span> tail &#123;</span><br><span class="line">        tail <span class="operator">=</span> node</span><br><span class="line">      &#125;</span><br><span class="line">      node.next <span class="operator">=</span> node.next<span class="operator">?</span>.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node.next<span class="operator">?</span>.value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - 实现值类型和写入时复制</span></span><br><span class="line">  <span class="comment">//使用COW实现价值语义的策略非常简单。在改变链接列表的内容之前，您希望执行底层存储的副本并将所有引用（头部和尾部）更新为新副本。</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">copyNodes</span>() &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span><span class="built_in">isKnownUniquelyReferenced</span>(<span class="operator">&amp;</span>head) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">var</span> oldNode <span class="operator">=</span> head <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    head <span class="operator">=</span> <span class="type">Node</span>(value: oldNode.value)</span><br><span class="line">    <span class="keyword">var</span> newNode <span class="operator">=</span> head</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> nextOldNode <span class="operator">=</span> oldNode.next &#123;</span><br><span class="line">      newNode<span class="operator">!</span>.next <span class="operator">=</span> <span class="type">Node</span>(value: nextOldNode.value)</span><br><span class="line">      newNode <span class="operator">=</span> newNode<span class="operator">!</span>.next</span><br><span class="line">      oldNode <span class="operator">=</span> nextOldNode</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    tail <span class="operator">=</span> newNode</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 实现Swift的Collection协议</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Swift Collection还允许通过下标进行访问，这是一个很好的术语，用于表示索引可以映射到集合中的值。</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">LinkedList</span>: <span class="title class_">Collection</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Index</span>: <span class="title class_">Comparable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> node: <span class="type">Node</span>&lt;<span class="type">Value</span>&gt;?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">==</span>(<span class="params">lhs</span>: <span class="type">Index</span>, <span class="params">rhs</span>: <span class="type">Index</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">      <span class="keyword">switch</span> (lhs.node, rhs.node) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">let</span> (left<span class="operator">?</span>, right<span class="operator">?</span>):</span><br><span class="line">        <span class="keyword">return</span> left.next <span class="operator">===</span> right.next</span><br><span class="line">      <span class="keyword">case</span> (<span class="literal">nil</span>, <span class="literal">nil</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">&lt;</span>(<span class="params">lhs</span>: <span class="type">Index</span>, <span class="params">rhs</span>: <span class="type">Index</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> lhs <span class="operator">!=</span> rhs <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> nodes <span class="operator">=</span> <span class="built_in">sequence</span>(first: lhs.node) &#123; <span class="variable">$0</span><span class="operator">?</span>.next &#125;</span><br><span class="line">      <span class="keyword">return</span> nodes.contains &#123; <span class="variable">$0</span> <span class="operator">===</span> rhs.node &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> startIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Index</span>(node: head)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> endIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Index</span>(node: tail<span class="operator">?</span>.next)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">index</span>(<span class="params">after</span> <span class="params">i</span>: <span class="type">Index</span>) -&gt; <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Index</span>(node: i.node<span class="operator">?</span>.next)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">subscript</span>(<span class="params">position</span>: <span class="type">Index</span>) -&gt; <span class="type">Value</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> position.node<span class="operator">!</span>.value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>关键点</strong></p>
<ul>
<li>链接列表是线性和单向的。 只要将引用从一个节点移动到另一个节点，就无法返回。</li>
<li>链接列表的头部第一次插入具有O(1)时间复杂度。 对于头部第一次插入，数组有O(n)时间复杂度。</li>
<li>符合Swift收集协议（如序列和集合），可为相当少的要求提供一系列有用的方法。</li>
<li>写时复制行为使您可以实现值语义。</li>
</ul>
<h3 id="第五章：链表挑战"><a href="#第五章：链表挑战" class="headerlink" title="第五章：链表挑战"></a>第五章：链表挑战</h3><h4 id="逆序打印所有节点元素"><a href="#逆序打印所有节点元素" class="headerlink" title="逆序打印所有节点元素"></a>逆序打印所有节点元素</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">printInReverse</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">list</span>: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;) &#123;</span><br><span class="line">  <span class="comment">//巧妙的递归：先迭代后打印，这样打印的就是逆序了</span></span><br><span class="line">  printInReverse(list.head)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">printInReverse</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">node</span>: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?) &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> node <span class="operator">=</span> node <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  printInReverse(node.next)</span><br><span class="line">  <span class="built_in">print</span>(node.value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="取中间节点"><a href="#取中间节点" class="headerlink" title="取中间节点"></a>取中间节点</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">getMiddle</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">list</span>: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Node</span>&lt;<span class="type">T</span>&gt;? &#123;</span><br><span class="line">  	<span class="comment">//两个步长差一倍，这样快的遍历到终点，慢的刚好到中间</span></span><br><span class="line">    <span class="keyword">var</span> fast <span class="operator">=</span> list.head</span><br><span class="line">    <span class="keyword">var</span> slow <span class="operator">=</span> list.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> nextFast <span class="operator">=</span> fast<span class="operator">?</span>.next &#123;</span><br><span class="line">        fast <span class="operator">=</span> nextFast.next</span><br><span class="line">        slow <span class="operator">=</span> slow<span class="operator">?</span>.next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> slow</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="反转链表"><a href="#反转链表" class="headerlink" title="反转链表"></a>反转链表</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">LinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// 不断的分割链表，从头部开始，下一步时把之前分割的节点拼接在新的节点之后。</span></span><br><span class="line">    <span class="comment">// 如此遍历到底，就实现了逆序。</span></span><br><span class="line">    <span class="comment">// 核心思路：把每个节点的前节点变成后节点，同时通过遍历时分割成2~3个分段。</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">reverse</span>() &#123;</span><br><span class="line">        tail <span class="operator">=</span> head</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> current <span class="operator">=</span> head<span class="operator">?</span>.next</span><br><span class="line">        <span class="comment">//  临时存储逆序的链表</span></span><br><span class="line">        <span class="keyword">var</span> prev <span class="operator">=</span> head</span><br><span class="line">        prev<span class="operator">?</span>.next <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> current <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> next <span class="operator">=</span> current<span class="operator">?</span>.next</span><br><span class="line">            current<span class="operator">?</span>.next <span class="operator">=</span> prev</span><br><span class="line">            prev <span class="operator">=</span> current</span><br><span class="line">            current <span class="operator">=</span> next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        head <span class="operator">=</span> prev</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="合并两个已经排序好的链表"><a href="#合并两个已经排序好的链表" class="headerlink" title="合并两个已经排序好的链表"></a>合并两个已经排序好的链表</h4><p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// list1 1 -&gt; 4 -&gt; 10 -&gt; 11</span><br><span class="line"></span><br><span class="line">// list2 -1 -&gt; 2 -&gt; 3 -&gt; 6</span><br><span class="line"></span><br><span class="line">// merged list -1 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 6 -&gt; 10 -&gt; 11</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">mergeSorted</span>&lt;<span class="type">T</span>: <span class="type">Comparable</span>&gt;(<span class="keyword">_</span> <span class="params">left</span>: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;,</span><br><span class="line">                                <span class="keyword">_</span> <span class="params">right</span>: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>left.isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> right</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>right.isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义新的链表的首尾</span></span><br><span class="line">    <span class="keyword">var</span> newHead: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">    <span class="keyword">var</span> tail: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原有链表的游标，后面以此遍历</span></span><br><span class="line">    <span class="keyword">var</span> currentLeft <span class="operator">=</span> left.head</span><br><span class="line">    <span class="keyword">var</span> currentRight <span class="operator">=</span> right.head</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始设置</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> leftNode <span class="operator">=</span> currentLeft, <span class="keyword">let</span> rightNode <span class="operator">=</span> currentRight &#123;</span><br><span class="line">        <span class="keyword">if</span> leftNode.value <span class="operator">&lt;</span> rightNode.value &#123;</span><br><span class="line">            newHead <span class="operator">=</span> leftNode</span><br><span class="line">            currentLeft <span class="operator">=</span> leftNode.next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newHead <span class="operator">=</span> rightNode</span><br><span class="line">            currentRight <span class="operator">=</span> rightNode.next</span><br><span class="line">        &#125;</span><br><span class="line">        tail <span class="operator">=</span> newHead</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> leftNode <span class="operator">=</span> currentLeft, <span class="keyword">let</span> rightNode <span class="operator">=</span> currentRight &#123;</span><br><span class="line">        <span class="keyword">if</span> leftNode.value <span class="operator">&lt;</span> rightNode.value &#123;</span><br><span class="line">            tail<span class="operator">?</span>.next <span class="operator">=</span> leftNode</span><br><span class="line">            currentLeft <span class="operator">=</span> leftNode.next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tail<span class="operator">?</span>.next <span class="operator">=</span> rightNode</span><br><span class="line">            currentRight <span class="operator">=</span> rightNode.next</span><br><span class="line">        &#125;</span><br><span class="line">        tail <span class="operator">=</span> tail<span class="operator">?</span>.next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> leftNode <span class="operator">=</span> currentLeft &#123;</span><br><span class="line">        tail<span class="operator">?</span>.next <span class="operator">=</span> leftNode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> rightNode <span class="operator">=</span> currentRight &#123;</span><br><span class="line">        tail<span class="operator">?</span>.next <span class="operator">=</span> rightNode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理新的链表的首尾</span></span><br><span class="line">    <span class="keyword">var</span> list <span class="operator">=</span> <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line"></span><br><span class="line">    list.head <span class="operator">=</span> newHead</span><br><span class="line">    <span class="comment">// 找到真的尾部节点</span></span><br><span class="line">    list.tail <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> next <span class="operator">=</span> tail<span class="operator">?</span>.next &#123;</span><br><span class="line">            tail <span class="operator">=</span> next</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tail</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建一个从链表中删除所有特定元素的函数"><a href="#创建一个从链表中删除所有特定元素的函数" class="headerlink" title="创建一个从链表中删除所有特定元素的函数"></a>创建一个从链表中删除所有特定元素的函数</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">LinkedList</span> <span class="title class_">where</span> <span class="title class_">Value</span>: <span class="title class_">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">removeAll</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Value</span>) &#123;</span><br><span class="line">        <span class="comment">// 头部的值相等时单独处理</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> head <span class="operator">=</span> <span class="keyword">self</span>.head, head.value <span class="operator">==</span> value &#123;</span><br><span class="line">            <span class="keyword">self</span>.head <span class="operator">=</span> head.next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> current <span class="operator">=</span> head<span class="operator">?</span>.next</span><br><span class="line">        <span class="keyword">var</span> prev <span class="operator">=</span> head</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> currentNode <span class="operator">=</span> current &#123;</span><br><span class="line">            <span class="keyword">guard</span> currentNode.value <span class="operator">!=</span> value <span class="keyword">else</span> &#123;</span><br><span class="line">                prev<span class="operator">?</span>.next <span class="operator">=</span> currentNode.next</span><br><span class="line">                current <span class="operator">=</span> prev<span class="operator">?</span>.next</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            prev <span class="operator">=</span> current</span><br><span class="line">            current <span class="operator">=</span> current<span class="operator">?</span>.next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tail <span class="operator">=</span> prev</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在时间复杂度上优化，所以一般都是2~3个临时变量（牺牲一点空间复杂度）。相当于让更多人协同做一件事情，肯定更快。但是如果是资源有限的时候，比如说雇人做事，总的成本不一定会减少。但是通常情况下，电脑的内存容量是既定的，而且够用的情况下，就要优化时间复杂度，不用吝惜内存。</p>
</blockquote>
<h3 id="第六章：栈"><a href="#第六章：栈" class="headerlink" title="第六章：栈"></a>第六章：栈</h3><p>栈无处不在。 以下是您要栈的一些常见示例：</p>
<ul>
<li>薄煎饼</li>
<li>书籍</li>
<li>纸张</li>
</ul>
<p>在概念上，栈数据结构与物理栈相同。 将项目添加到栈时，将其放在栈顶部。 从栈中删除项目时，始终会删除最顶层的项目。</p>
<h4 id="栈的操作"><a href="#栈的操作" class="headerlink" title="栈的操作"></a>栈的操作</h4><p>栈的操作只有两个：</p>
<ol>
<li>push：将元素添加到栈顶部。</li>
<li>pop：删除栈的顶部元素。</li>
</ol>
<p>这意味着您只能在数据结构的一侧添加或删除元素。在计算机科学中，栈被称为LIFO（后进先出）数据结构。最后推入的元素是第一个被弹出的元素。</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//泛型Element为存储的元素</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Stack</span>&lt;<span class="title class_">Element</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//内部为数组存储所有元素</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> storage: [<span class="type">Element</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">elements</span>: [<span class="type">Element</span>]) &#123;</span><br><span class="line">    storage <span class="operator">=</span> elements</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">push</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">Element</span>) &#123;</span><br><span class="line">    storage.append(element)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">pop</span>() -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> storage.popLast()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">peek</span>() -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> storage.last</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> peek() <span class="operator">==</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Stack</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> topDivider <span class="operator">=</span> <span class="string">&quot;----top----<span class="subst">\n</span>&quot;</span></span><br><span class="line">    <span class="keyword">let</span> bottomDivider <span class="operator">=</span> <span class="string">&quot;<span class="subst">\n</span>-----------&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> stackElements <span class="operator">=</span> storage</span><br><span class="line">      .map &#123; <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span> &#125;</span><br><span class="line">      .reversed()</span><br><span class="line">      .joined(separator: <span class="string">&quot;<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> topDivider <span class="operator">+</span> stackElements <span class="operator">+</span> bottomDivider</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Stack</span>: <span class="title class_">ExpressibleByArrayLiteral</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">arrayLiteral</span> <span class="params">elements</span>: <span class="type">Element</span>...) &#123;</span><br><span class="line">    storage <span class="operator">=</span> elements</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可能想知道是否可以为栈采用Swift集合协议。栈的目的是限制访问数据的方式的数量，并采用诸如Collection之类的协议将通过迭代器和下标公开所有元素来违背此目标。在这种情况下，少即是多！</p>
<h3 id="第七章：栈挑战"><a href="#第七章：栈挑战" class="headerlink" title="第七章：栈挑战"></a>第七章：栈挑战</h3><h4 id="逆序打印链表，但是不能用递归"><a href="#逆序打印链表，但是不能用递归" class="headerlink" title="逆序打印链表，但是不能用递归"></a>逆序打印链表，但是不能用递归</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list: <span class="type">LinkedList</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> list <span class="operator">=</span> <span class="type">LinkedList</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">  list.push(<span class="number">3</span>)</span><br><span class="line">  list.push(<span class="number">2</span>)</span><br><span class="line">  list.push(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span> list</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">printInReverse</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">list</span>: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;) &#123;</span><br><span class="line">  <span class="keyword">var</span> current <span class="operator">=</span> list.head</span><br><span class="line">  <span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">let</span> node <span class="operator">=</span> current &#123;</span><br><span class="line">    stack.push(node.value)</span><br><span class="line">    current <span class="operator">=</span> node.next</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">let</span> value <span class="operator">=</span> stack.pop() &#123;</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printInReverse(list)</span><br></pre></td></tr></table></figure>

<h4 id="检查括号的匹配"><a href="#检查括号的匹配" class="headerlink" title="检查括号的匹配"></a>检查括号的匹配</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> testString1 <span class="operator">=</span> <span class="string">&quot;h((e))llo(world)()&quot;</span></span><br><span class="line"><span class="keyword">var</span> testString2 <span class="operator">=</span> <span class="string">&quot;(hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">checkParentheses</span>(<span class="keyword">_</span> <span class="params">string</span>: <span class="type">String</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Character</span>&gt;()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> character <span class="keyword">in</span> string &#123;</span><br><span class="line">    <span class="keyword">if</span> character <span class="operator">==</span> <span class="string">&quot;(&quot;</span> &#123;</span><br><span class="line">      stack.push(character)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> character <span class="operator">==</span> <span class="string">&quot;)&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> stack.isEmpty &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        stack.pop()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack.isEmpty</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkParentheses(testString1)</span><br><span class="line">checkParentheses(testString2)</span><br></pre></td></tr></table></figure>

<h3 id="第八章：队列"><a href="#第八章：队列" class="headerlink" title="第八章：队列"></a>第八章：队列</h3><p>我们都熟悉排队，无论是买票还是排队打印。</p>
<p>队列使用FIFO或先进先出顺序，这意味着添加的第一个元素将始终是第一个被删除的元素。当您需要维护元素的顺序以便稍后处理时，队列很方便。</p>
<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>让我们先确定队列的协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">Queue</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Element</span></span><br><span class="line">  <span class="comment">///在队列后面插入一个元素。如果操作成功，则返回true。</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">enqueue</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">Element</span>) -&gt; <span class="type">Bool</span></span><br><span class="line">  <span class="comment">///删除队列前面的元素并将其返回。</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">dequeue</span>() -&gt; <span class="type">Element</span>?</span><br><span class="line">  <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> peek: <span class="type">Element</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在以下部分中，将以四种不同的方式创建队列：</p>
<ol>
<li>数组</li>
<li>双向列表</li>
<li>环形缓冲区</li>
<li>双栈</li>
</ol>
<h4 id="用数组来实现"><a href="#用数组来实现" class="headerlink" title="用数组来实现"></a>用数组来实现</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">QueueArray</span>&lt;<span class="title class_">T</span>&gt;: <span class="title class_">Queue</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> array: [<span class="type">T</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> array.isEmpty</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> peek: <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> array.first</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">enqueue</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    array.append(element)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">dequeue</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> isEmpty <span class="operator">?</span> <span class="literal">nil</span> : array.removeFirst()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueArray</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(describing: array)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">QueueArray</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">queue.enqueue(<span class="string">&quot;Ray&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Brian&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Eric&quot;</span>)</span><br><span class="line">queue</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue</span><br><span class="line">queue.peek</span><br></pre></td></tr></table></figure>

<h5 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://gewill.org/assets/image-20190912160423263.png" alt="image-20190912160423263"></h5><p>很明显只有<code>enqueue</code>是O(1)，其他都是O(n)。</p>
<h4 id="用双向链表来实现"><a href="#用双向链表来实现" class="headerlink" title="用双向链表来实现"></a>用双向链表来实现</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueueLinkedList</span>&lt;<span class="title class_">T</span>&gt;: <span class="title class_">Queue</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> list <span class="operator">=</span> <span class="type">DoublyLinkedList</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">enqueue</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    list.append(element)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">dequeue</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>list.isEmpty, <span class="keyword">let</span> element <span class="operator">=</span> list.first <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list.remove(element)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> peek: <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> list.first<span class="operator">?</span>.value</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> list.isEmpty</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueLinkedList</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(describing: list)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">QueueLinkedList</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">queue.enqueue(<span class="string">&quot;Ray&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Brian&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Eric&quot;</span>)</span><br><span class="line">queue</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue</span><br><span class="line">queue.peek</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - DoublyLinkedList</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;<span class="title class_">T</span>&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">T</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> next: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> previous: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Node</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(describing: value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoublyLinkedList</span>&lt;<span class="title class_">T</span>&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> head: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> tail: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> head <span class="operator">==</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> first: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;? &#123;</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newNode <span class="operator">=</span> <span class="type">Node</span>(value: value)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> tailNode <span class="operator">=</span> tail <span class="keyword">else</span> &#123;</span><br><span class="line">      head <span class="operator">=</span> newNode</span><br><span class="line">      tail <span class="operator">=</span> newNode</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    newNode.previous <span class="operator">=</span> tailNode</span><br><span class="line">    tailNode.next <span class="operator">=</span> newNode</span><br><span class="line">    tail <span class="operator">=</span> newNode</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="keyword">_</span> <span class="params">node</span>: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> prev <span class="operator">=</span> node.previous</span><br><span class="line">    <span class="keyword">let</span> next <span class="operator">=</span> node.next</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> prev <span class="operator">=</span> prev &#123;</span><br><span class="line">      prev.next <span class="operator">=</span> next</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      head <span class="operator">=</span> next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    next<span class="operator">?</span>.previous <span class="operator">=</span> prev</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> next <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">      tail <span class="operator">=</span> prev</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    node.previous <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    node.next <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> node.value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">DoublyLinkedList</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> string <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> current <span class="operator">=</span> head</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> node <span class="operator">=</span> current &#123;</span><br><span class="line">      string.append(<span class="string">&quot;<span class="subst">\(node.value)</span> -&gt; &quot;</span>)</span><br><span class="line">      current <span class="operator">=</span> node.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> string <span class="operator">+</span> <span class="string">&quot;end&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListIterator</span>&lt;<span class="title class_">T</span>&gt;: <span class="title class_">IteratorProtocol</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> current: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">init</span>(<span class="params">node</span>: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?) &#123;</span><br><span class="line">    current <span class="operator">=</span> node</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">next</span>() -&gt; <span class="type">Node</span>&lt;<span class="type">T</span>&gt;? &#123;</span><br><span class="line">    <span class="keyword">defer</span> &#123; current <span class="operator">=</span> current<span class="operator">?</span>.next &#125;</span><br><span class="line">    <span class="keyword">return</span> current</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">DoublyLinkedList</span>: <span class="title class_">Sequence</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">makeIterator</span>() -&gt; <span class="type">LinkedListIterator</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">LinkedListIterator</span>(node: head)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点<img src="https://gewill.org/assets/image-20190912161101034.png" alt="image-20190912161101034"></h5><p>出来空间复杂度是O(n)，其他的都是O(1)。</p>
<p>双向列表的主要弱点在表中并不明显。尽管有O(1)的性能，但它的开销很高。每个元素都必须有额外的存储空间用于前向和后向引用。而且，每次创建新元素时，都需要相对昂贵的动态分配。相比之下，数组进行批量分配，速度更快。</p>
<h4 id="用环形缓冲区来实现"><a href="#用环形缓冲区来实现" class="headerlink" title="用环形缓冲区来实现"></a>用环形缓冲区来实现</h4><p>环形缓冲区，也称为循环缓冲区，是固定大小的阵列。当最终没有更多项目需要删除时，这种数据结构战略性地包含在开头。</p>
<p>详见：[<a target="_blank" rel="noopener" href="https://github.com/raywenderlich/swift-algorithm-club/tree/master/Ring%20Buffer]">https://github.com/raywenderlich/swift-algorithm-club/tree/master/Ring%20Buffer]</a>(<a target="_blank" rel="noopener" href="https://github.com/raywenderlich/swift-algorithm-club/tree/master/Ring">https://github.com/raywenderlich/swift-algorithm-club/tree/master/Ring</a> Buffer)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">QueueRingBuffer</span>&lt;<span class="title class_">T</span>&gt;: <span class="title class_">Queue</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> ringBuffer: <span class="type">RingBuffer</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">count</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">    ringBuffer <span class="operator">=</span> <span class="type">RingBuffer</span>&lt;<span class="type">T</span>&gt;(count: count)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ringBuffer.isEmpty</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> peek: <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> ringBuffer.first</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">enqueue</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ringBuffer.write(element)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">dequeue</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> isEmpty <span class="operator">?</span> <span class="literal">nil</span> : ringBuffer.read()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueRingBuffer</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(describing: ringBuffer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">QueueRingBuffer</span>&lt;<span class="type">String</span>&gt;(count: <span class="number">10</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Ray&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Brian&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Eric&quot;</span>)</span><br><span class="line">queue</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue</span><br><span class="line">queue.peek</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - RingBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">RingBuffer</span>&lt;<span class="title class_">T</span>&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> array: [<span class="type">T</span>?]</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> readIndex <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> writeIndex <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">count</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">    array <span class="operator">=</span> <span class="type">Array</span>&lt;<span class="type">T</span>?&gt;(repeating: <span class="literal">nil</span>, count: count)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> first: <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> array[readIndex]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">write</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>isFull &#123;</span><br><span class="line">      array[writeIndex <span class="operator">%</span> array.count] <span class="operator">=</span> element</span><br><span class="line">      writeIndex <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">read</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>isEmpty &#123;</span><br><span class="line">      <span class="keyword">let</span> element <span class="operator">=</span> array[readIndex <span class="operator">%</span> array.count]</span><br><span class="line">      readIndex <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">return</span> element</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> availableSpaceForReading: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> writeIndex <span class="operator">-</span> readIndex</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> availableSpaceForReading <span class="operator">==</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> availableSpaceForWriting: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> array.count <span class="operator">-</span> availableSpaceForReading</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isFull: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> availableSpaceForWriting <span class="operator">==</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">RingBuffer</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> values <span class="operator">=</span> (<span class="number">0</span><span class="operator">..&lt;</span>availableSpaceForReading).map &#123;</span><br><span class="line">      <span class="type">String</span>(describing: array[(<span class="variable">$0</span> <span class="operator">+</span> readIndex) <span class="operator">%</span> array.count]<span class="operator">!</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;[&quot;</span> <span class="operator">+</span> values.joined(separator: <span class="string">&quot;, &quot;</span>) <span class="operator">+</span> <span class="string">&quot;]&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h5><p><img src="https://gewill.org/assets/image-20190912162139308.png" alt="image-20190912162139308"></p>
<p>基于环缓冲区的队列具有与链表实现相同的入队和出队时间复杂度。唯一的区别是空间复杂性。环形缓冲区具有固定大小，这意味着入队可能会失败。</p>
<h4 id="用双栈来实现"><a href="#用双栈来实现" class="headerlink" title="用双栈来实现"></a>用双栈来实现</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">QueueStack</span>&lt;<span class="title class_">T</span>&gt; : <span class="title class_">Queue</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> leftStack: [<span class="type">T</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> rightStack: [<span class="type">T</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> leftStack.isEmpty <span class="operator">&amp;&amp;</span> rightStack.isEmpty</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> peek: <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="operator">!</span>leftStack.isEmpty <span class="operator">?</span> leftStack.last : rightStack.first</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">enqueue</span>(<span class="keyword">_</span> <span class="params">element</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    rightStack.append(element)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">dequeue</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> leftStack.isEmpty &#123;</span><br><span class="line">      leftStack <span class="operator">=</span> rightStack.reversed()</span><br><span class="line">      rightStack.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> leftStack.popLast()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueStack</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> printList <span class="operator">=</span> leftStack.reversed() <span class="operator">+</span> rightStack</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(describing: printList)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">QueueStack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">queue.enqueue(<span class="string">&quot;Ray&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Brian&quot;</span>)</span><br><span class="line">queue.enqueue(<span class="string">&quot;Eric&quot;</span>)</span><br><span class="line">queue</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue</span><br><span class="line">queue.peek</span><br></pre></td></tr></table></figure>

<p>出队：<img src="https://gewill.org/assets/image-20190912162831309.png" alt="image-20190912162831309"></p>
<p>入队：</p>
<p>![image-20190912162918069](&#x2F;Users&#x2F;will&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20190912162918069.png)</p>
<h5 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h5><h5 id="image-20190912163001741-x2F-Users-x2F-will-x2F-Library-x2F-Application-Support-x2F-typora-user-images-x2F-image-20190912163001741-png"><a href="#image-20190912163001741-x2F-Users-x2F-will-x2F-Library-x2F-Application-Support-x2F-typora-user-images-x2F-image-20190912163001741-png" class="headerlink" title="![image-20190912163001741](&#x2F;Users&#x2F;will&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20190912163001741.png)"></a>![image-20190912163001741](&#x2F;Users&#x2F;will&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20190912163001741.png)</h5><p>与基于数组的实现相比，通过利用两个堆栈，您可以将<code>dequeue(_ :)</code>转换为分摊的O(1)操作。</p>
<p>此外，您的双栈实现是完全动态的，并且没有基于环形缓冲区的队列实现所具有的固定大小限制。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>队列采用FIFO策略，首先必须先删除添加的元素。</p>
</li>
<li><p>Enqueue将元素插入队列的后面。</p>
</li>
<li><p>Dequeue删除队列前面的元素。</p>
</li>
<li><p>数组中的元素在连续的内存块中布局，而链表中的元素更加分散，可能存在缓存未命中。</p>
</li>
<li><p>基于环路缓冲区队列的实现适用于具有固定大小的队列。</p>
</li>
<li><p>与其他数据结构相比，利用两个栈可以将出列<code>dequeue(_ :)</code>时间复杂度提高到摊销的O(1)操作。</p>
</li>
<li><p>双栈实现在空间复杂度方面击败了链表。</p>
</li>
</ul>
<h3 id="第九章：队列挑战"><a href="#第九章：队列挑战" class="headerlink" title="第九章：队列挑战"></a>第九章：队列挑战</h3><h4 id="解释栈和队列之间的区别"><a href="#解释栈和队列之间的区别" class="headerlink" title="解释栈和队列之间的区别"></a>解释栈和队列之间的区别</h4><p>为每个数据结构提供两个实际示例。</p>
<h4 id="画逐步图表"><a href="#画逐步图表" class="headerlink" title="画逐步图表"></a>画逐步图表</h4><p>演示四种实现时，每一步对队列的有影响。</p>
<p>如队列为：”SWIFT”</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">enqueue(<span class="string">&quot;R&quot;</span>) </span><br><span class="line">enqueue(<span class="string">&quot;O&quot;</span>) </span><br><span class="line">dequeue() </span><br><span class="line">enqueue(<span class="string">&quot;C&quot;</span>) </span><br><span class="line">dequeue() </span><br><span class="line">dequeue() </span><br><span class="line">enqueue(<span class="string">&quot;K&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="给队列添加next协议"><a href="#给队列添加next协议" class="headerlink" title="给队列添加next协议"></a>给队列添加<code>next</code>协议</h4><p>用来大富翁游戏，指派下一个玩家</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">BoardGameManager</span> &#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Player</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">nextPlayer</span>() -&gt; <span class="type">Player</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueArray</span>: <span class="title class_">BoardGameManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Player</span> <span class="operator">=</span> <span class="type">T</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">nextPlayer</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> person <span class="operator">=</span> dequeue() <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    enqueue(person)</span><br><span class="line">    <span class="keyword">return</span> person</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="逆序排列队列"><a href="#逆序排列队列" class="headerlink" title="逆序排列队列"></a>逆序排列队列</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">QueueArray</span> &#123;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">reversed</span>() -&gt; <span class="type">QueueArray</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> queue <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    <span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> element <span class="operator">=</span> queue.dequeue() &#123;</span><br><span class="line">      stack.push(element)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> element <span class="operator">=</span> stack.pop() &#123;</span><br><span class="line">      queue.enqueue(element)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/26/Advanced-Apple-Debugging-and-Reverse-Engineering-Notes-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/26/Advanced-Apple-Debugging-and-Reverse-Engineering-Notes-1/" class="post-title-link" itemprop="url">苹果调试和逆向工程进阶-笔记（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-06-26 10:32:44" itemprop="dateCreated datePublished" datetime="2019-06-26T10:32:44+08:00">2019-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>写这本书的目的</p>
<p>每个开发人员都应该研究调试代码的艺术。 但是，有些人会从本书中获得更多。 本书是为：</p>
<ol>
<li><p>希望更好地使用LLDB进行调试的开发人员</p>
</li>
<li><p>希望使用LLDB构建复杂调试命令的开发人员</p>
</li>
<li><p>希望深入了解Swift和Objective-C内部的开发人员</p>
</li>
<li><p>有兴趣了解：通过逆向工程，他们可以做些什么的开发人员</p>
</li>
<li><p>对现代主动逆向工程策略感兴趣的开发人员</p>
</li>
<li><p>希望在发现有关其计算机或软件问题的答案时有所帮助的开发人员</p>
</li>
</ol>
<p>自定义LLDB脚本repo:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/DerekSelander/LLDB">https://github.com/DerekSelander/LLDB</a></p>
<p>这些脚本将有助于您的调试&#x2F;逆向工程，并为您自己的LLDB脚本提供新颖的想法。</p>
<h2 id="第一节：开始LLDB命令"><a href="#第一节：开始LLDB命令" class="headerlink" title="第一节：开始LLDB命令"></a>第一节：开始LLDB命令</h2><p>到本节结束时，您将能够使用调试器来执行调试所需的大多数基本任务，以及创建自己的简单自定义命令</p>
<h3 id="第1章：入门"><a href="#第1章：入门" class="headerlink" title="第1章：入门"></a>第1章：入门</h3><p>想知道为什么命令是po？ po代表打印对象。 还有p，它只是打印RDI的内容。 po通常更有用，因为它提供了NSObject的描述或debugDescription方法（如果可用）。</p>
<p>如果您想将调试提升到一个新的水平，汇编（Assembly）是一项重要的技能。</p>
<p>它可以让您深入了解Apple的代码 - 即使您没有任何源代码可供阅读。 它将使您更好地了解Swift编译器团队如何使用Swift在Objective-C中跳出，并且它将使您更好地了解Apple设备上的一切是如何工作的。</p>
<p>如果可以，我将始终选择在调试器中使用Objective-C，因为使用Objective-C LLDB比使用Swift更稳定。</p>
<h3 id="第2章：Help和Apropos"><a href="#第2章：Help和Apropos" class="headerlink" title="第2章：Help和Apropos"></a>第2章：Help和Apropos</h3><p><code>help</code>将转储(dump)所有可用的命令，包括从〜&#x2F; .lldbinit加载的自定义命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) help breakpoint</span><br></pre></td></tr></table></figure>

<p><code>apropos</code>命令可以为您执行此操作;这有点像使用搜索引擎在网络上找到一些东西。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) apropos swift</span><br></pre></td></tr></table></figure>

<h3 id="第3章：使用LLDB-Attaching"><a href="#第3章：使用LLDB-Attaching" class="headerlink" title="第3章：使用LLDB Attaching"></a>第3章：使用LLDB Attaching</h3><p>LLDB“Attaching”的短语实际上有点误导。 名为debugserver(位于Xcode.app&#x2F;Contents&#x2F;SharedFrameworks&#x2F;LLDB.framework&#x2F;Resources&#x2F;)的程序负责附加(attaching)到目标进程。</p>
<p>如果它是远程进程，例如在远程设备上运行的iOS，watchOS或tvOS应用程序，则会在该远程设备上启动远程调试服务器。 LLDB的工作是启动，连接和协调调试服务器，以处理调试应用程序时的所有交互。</p>
<h4 id="附加到现有进程"><a href="#附加到现有进程" class="headerlink" title="附加到现有进程"></a>附加到现有进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lldb -n Xcode</span><br></pre></td></tr></table></figure>

<h4 id="附加到未来的进程"><a href="#附加到未来的进程" class="headerlink" title="附加到未来的进程"></a>附加到未来的进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lldb -n Finder -w</span><br></pre></td></tr></table></figure>

<h4 id="launch可选的参数"><a href="#launch可选的参数" class="headerlink" title="launch可选的参数"></a>launch可选的参数</h4><p>这告诉LLDB使用<code>/bin/ls</code>（文件列表命令）作为目标可执行文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lldb -f /bin/ls</span><br></pre></td></tr></table></figure>



<p>使用 process 的选项 <code>-w</code> 更改工作目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) process launch -w /Applications</span><br></pre></td></tr></table></figure>



<p>直接传递参数给<code>程序</code>，也就是<code>/bin/ls</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) process launch -- /Applications</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls /Applications</span><br></pre></td></tr></table></figure>



<p><code>-X</code>选项可扩展您提供的任何shell参数，例如代字号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) process launch -X true -- ~/Desktop</span><br></pre></td></tr></table></figure>

<p><code>run</code> 是 <code>process launch -X true —</code>的缩写，所以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run ~/Desktop</span><br></pre></td></tr></table></figure>



<p>stdin也有一个选项<code>-i</code>，用来处理标准的输入输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) target delete</span><br><span class="line">(lldb) target create /usr/bin/wc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;hello world&quot; &gt; /tmp/wc_input.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(lldb) process launch -i /tmp/wc_input.txt</span><br><span class="line">Process 24511 launched: &#x27;/usr/bin/wc&#x27; (x86_64)</span><br><span class="line">1 2 12 </span><br><span class="line">Process 24511 exited with status = 0 (0x00000000)</span><br></pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wc &lt; /tmp/wc_input.txt</span><br><span class="line"> 1  2 12</span><br></pre></td></tr></table></figure>

<h3 id="第4章：在代码中停止"><a href="#第4章：在代码中停止" class="headerlink" title="第4章：在代码中停止"></a>第4章：在代码中停止</h3><p>无论您是在技术堆栈中使用Swift，Objective-C，C ++，C还是完全不同的语言，您都需要学习如何创建断点。 可以轻松地在Xcode中单击侧面板以使用GUI创建断点，但LLDB控制台可以让您更好地控制断点。</p>
<h4 id="Signals（信号）"><a href="#Signals（信号）" class="headerlink" title="Signals（信号）"></a>Signals（信号）</h4><p>Unix信号是进程间通信的基本形式。</p>
<p>例如，其中一个信号SIGSTOP可用于保存状态并暂停执行进程，而其对应的SIGCONT则被发送到程序以恢复执行。调试器可以使用这两个信号暂停并继续执行程序。</p>
<h5 id="Xcode-断点"><a href="#Xcode-断点" class="headerlink" title="Xcode 断点"></a>Xcode 断点</h5><p>符号断点（Symbolic breakpoints）是Xcode的一个很好的调试功能。它们允许您在应用程序中的某个符号上设置断点。例如<code>[NSObject init]</code>，它引用NSObject实例的init方法。</p>
<p><img src="/../assets/xcode_breakpoints.png"></p>
<blockquote>
<p>您将学习如何在第10章“汇编，寄存器和调用约定”中正确使用和操作寄存器，但是现?在，只需知道<code> arg1</code>与​<code> $rdi</code>寄存器同义，并且可以被认为是持有实例的调用init时的类。</p>
</blockquote>
<p>还有Swift错误断点，它通过在swift_willThrow方法上创建断点来随时停止Swift抛出错误。如果您正在处理任何容易出错的API，这是一个很好的选择，因为它可以让您快速诊断情况，而不会对代码的正确性做出错误的假设。</p>
<h4 id="LLDB断点语法"><a href="#LLDB断点语法" class="headerlink" title="LLDB断点语法"></a>LLDB断点语法</h4><p><code>image</code>命令是一个很好的工具，可以帮助内省对设置断点至关重要的细节。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -n &quot;-[UIViewController viewDidLoad]&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn test</span><br></pre></td></tr></table></figure>

<h5 id="Objective-C-properties"><a href="#Objective-C-properties" class="headerlink" title="Objective-C properties"></a>Objective-C properties</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TestClass</span> : <span class="title">NSObject</span> </span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name; </span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -n &quot;-[TestClass name]&quot;</span><br></pre></td></tr></table></figure>

<h5 id="Objective-C-properties-and-dot-notation"><a href="#Objective-C-properties-and-dot-notation" class="headerlink" title="Objective-C properties and dot notation"></a>Objective-C properties and dot notation</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TestClass *a = [[TestClass alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Both equivalent for setters </span></span><br><span class="line">[a setName:<span class="string">@&quot;hello, world&quot;</span>]; </span><br><span class="line">a.name = <span class="string">@&quot;hello, world&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Both equivalent for getters </span></span><br><span class="line"><span class="built_in">NSString</span> *b; </span><br><span class="line">b = [a name]; <span class="comment">// b = @&quot;hello, world&quot; </span></span><br><span class="line">b = a.name; <span class="comment">// b = @&quot;hello, world&quot;</span></span><br></pre></td></tr></table></figure>

<p>重要的是要知道您是在处理Objective-C代码并尝试使用点表示法在setter和getter属性上创建断点。</p>
<h5 id="Swift-properties"><a href="#Swift-properties" class="headerlink" title="Swift properties"></a>Swift properties</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SwiftTestClass</span>: <span class="title class_">NSObject</span> &#123; </span><br><span class="line">	<span class="keyword">var</span> name: <span class="type">String</span>!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the LLDB console, type the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn Signals.SwiftTestClass.name.setter</span><br></pre></td></tr></table></figure>

<p>You’ll get output similar to below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 match found in /Users/derekselander/Library/Developer/Xcode/ DerivedData/Signals-atqcdyprrotlrvdanihoufkwzyqh/Build/Products/Debugiphonesimulator/Signals.app/Signals:</span><br><span class="line"></span><br><span class="line">Address: Signals[0x000000010000cc70] (Signals.__TEXT.__text + 44816)</span><br><span class="line"></span><br><span class="line">Summary: Signals`Signals.SwiftTestClass.name.setter : Swift.ImplicitlyUnwrappedOptional&lt;Swift.String&gt; at SwiftTestClass.swift: 28</span><br></pre></td></tr></table></figure>

<p>使用以下正则表达式查询同时搜索name属性的SwiftTestClass setter和getter：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn Signals.SwiftTestClass.name</span><br></pre></td></tr></table></figure>

<h4 id="创建断点"><a href="#创建断点" class="headerlink" title="创建断点"></a>创建断点</h4><p>有几种不同的方法可以创建断点。最基本的方法是只输入字母b，后跟断点名称。这在Objective-C和C中相当容易，因为名称简短且易于键入（例如 - [NSObject init]或 - [UIView setAlpha:]）。输入C ++和Swift非常棘手，因为编译器会将您的方法转换为具有相当长名称的符号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) b -[UIViewController viewDidLoad]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>与许多速记命令一样，b是另一个更长的LLDB命令的缩写。</p>
</blockquote>
<h5 id="正则表达式断点和范围"><a href="#正则表达式断点和范围" class="headerlink" title="正则表达式断点和范围"></a>正则表达式断点和范围</h5><p>rb命令将扩展到rbreak（假设您没有任何以“rb”开头的其他LLDB命令）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb SwiftTestClass.name.setter</span><br></pre></td></tr></table></figure>



<p>这将在包含短语name.setter的任何内容上生成断点:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb name\.setter	</span><br></pre></td></tr></table></figure>



<p>在UIViewController的每个Objective-C实例方法上创建一个断点:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb &#x27;\-\[UIViewController\ &#x27;</span><br></pre></td></tr></table></figure>



<p>删除所有断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint delete</span><br></pre></td></tr></table></figure>



<p>在断点中的UIViewController之后，这提供了带有一个或多个字母数字字符后跟空格的可选括号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb &#x27;\-\[UIViewController(\(\w+\))?\ &#x27;</span><br></pre></td></tr></table></figure>



<p>使用正则表达式断点可以使用单个表达式捕获各种断点。</p>
<p>您可以使用-f选项将断点的范围限制为特定文件。</p>
<p>如果您正在调试DetailViewController.swift，这将非常有用。它将在此文件中的所有属性getter &#x2F; setter，块&#x2F;闭包，扩展&#x2F;类别和函数&#x2F;方法上设置断点。 -f称为范围限制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb . -f DetailViewController.swift</span><br></pre></td></tr></table></figure>



<p>使用-s可以限制此共享库中设置断点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb . -s UIKit</span><br></pre></td></tr></table></figure>



<p>-o选项为此提供了解决方案。它创造了所谓的“一次性”断点。当这些断点命中时，断点将被删除。所以它只会打一次。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint delete </span><br><span class="line">(lldb) rb . -s UIKit -o</span><br></pre></td></tr></table></figure>

<h5 id="其他很酷的断点选项"><a href="#其他很酷的断点选项" class="headerlink" title="其他很酷的断点选项"></a>其他很酷的断点选项</h5><p>-L选项允许您按源代码的语言进行过滤。因此，如果您只想在Signals应用程序的Commons模块中使用Swift代码，则可以执行以下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint set -L swift -r . -s Commons</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这将在Commons模块中的每个Swift方法上设置断点。</p>
</blockquote>
<p>如果你想在Swift语句<code>if let</code>寻找一些有趣的东西，如果让它完全忘记你的应用程序在哪里，该怎么办？您可以使用源正则表达式断点来帮助确定感兴趣的位置！像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint set -A -p &quot;if let&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这将在包含<code>if let</code>的每个源代码位置创建一个断点。 -A选项表示搜索项目已知的所有源文件。</p>
</blockquote>
<p>如果想进一限制文件范围：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint set -p &quot;if let&quot; -f MasterViewController.swift -f DetailViewController.swift</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这将获取所有源文件（-A），但只过滤那些属于Signals可执行文件（使用-s Signals选项）的文件。</p>
</blockquote>
<p>再来一个很酷的断点选项示例？好的。每当viewDidLoad被命中时，将创建一个打印UIViewController的断点，但是将通过LLDB控制台而不是符号断点窗口来执行此操作。然后将这个断点导出到文件中，这样就可以通过使用断点读取和断点写入命令展现给同事。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(lldb) breakpoint delete //清理断点</span><br><span class="line">(lldb) breakpoint set -n &quot;-[UIViewController viewDidLoad]&quot; -C &quot;po $arg1&quot; -G1 // 打印所有符合条件的实例对象</span><br><span class="line">(lldb) breakpoint write -f /tmp/br.json //断点写入文件</span><br><span class="line">(lldb) platform shell cat /tmp/br.json //shell读取文件</span><br><span class="line">(lldb) breakpoint delete //清理断点</span><br><span class="line">(lldb) breakpoint read -f /tmp/br.json //还能从文件中导入断点</span><br></pre></td></tr></table></figure>

<h5 id="修改和移除断点"><a href="#修改和移除断点" class="headerlink" title="修改和移除断点"></a>修改和移除断点</h5><p>断点会从1开始分配ID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(lldb) b main</span><br><span class="line">(lldb) breakpoint list 1</span><br><span class="line">(lldb) breakpoint list 1 -b //简洁：没有位置（location）</span><br><span class="line">(lldb) breakpoint list 1 3 //多个</span><br><span class="line">(lldb) breakpoint list 1-3 //范围</span><br><span class="line">(lldb) breakpoint delete 1 //删除</span><br><span class="line">(lldb) breakpoint delete 1.1 //仅删除第一个子断点</span><br></pre></td></tr></table></figure>



<h3 id="第5章：表达式"><a href="#第5章：表达式" class="headerlink" title="第5章：表达式"></a>第5章：表达式</h3><h4 id="格式化-p-和-po"><a href="#格式化-p-和-po" class="headerlink" title="格式化 p 和 po"></a>格式化 p 和 po</h4><p>po通常用于Swift和Objective-C代码中以打印出感兴趣的项目。这可以是对象中的实例变量，对象的本地引用或寄存器，如本书前面所述。它甚至可以是一个任意的内存引用 - 只要该地址有一个对象！</p>
<p>po实际上是<code>expression -O --</code> 的简写表达式。 -O参数用于打印对象的描述。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(lldb) help po</span><br><span class="line">     Evaluate an expression on the current thread.  Displays any returned</span><br><span class="line">     value with formatting controlled by the type&#x27;s author.  Expects &#x27;raw&#x27;</span><br><span class="line">     input (see &#x27;help raw-input&#x27;.)</span><br><span class="line"></span><br><span class="line">Syntax: po &lt;expr&gt;</span><br><span class="line"></span><br><span class="line">Command Options Usage:</span><br><span class="line">  po &lt;expr&gt;</span><br><span class="line"></span><br><span class="line">&#x27;po&#x27; is an abbreviation for &#x27;expression -O  --&#x27;</span><br></pre></td></tr></table></figure>

<p>po经常被忽视的兄弟p,是另一个省略-O选项的缩写，<code>expression --</code> 。打印出的p的格式更依赖于LLDB类型系统。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(lldb) help p</span><br><span class="line">     Evaluate an expression on the current thread.  Displays any returned</span><br><span class="line">     value with LLDB&#x27;s default formatting.  Expects &#x27;raw&#x27; input (see &#x27;help</span><br><span class="line">     raw-input&#x27;.)</span><br><span class="line"></span><br><span class="line">Syntax: p &lt;expr&gt;</span><br><span class="line"></span><br><span class="line">Command Options Usage:</span><br><span class="line">  p &lt;expr&gt;</span><br><span class="line"></span><br><span class="line">&#x27;p&#x27; is an abbreviation for &#x27;expression --&#x27;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Yay! debugging &quot;</span> <span class="operator">+</span> <span class="keyword">super</span>.description </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> debugDescription: <span class="type">String</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;debugDescription: &quot;</span> <span class="operator">+</span> <span class="keyword">super</span>.debugDescription </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">   <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在viewDidLoad中添加Xcode断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po self</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugDescription: Yay! debugging &lt;Signals.MasterViewController: 0x7fb71fd04080&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Swift-和-Objective-C-调试上下（文contexts）"><a href="#Swift-和-Objective-C-调试上下（文contexts）" class="headerlink" title="Swift 和 Objective-C 调试上下（文contexts）"></a>Swift 和 Objective-C 调试上下（文contexts）</h4><p>重要的是要注意调试程序时有两个调试上下文：非Swift调试上下文和Swift上下文。默认情况下，当您停止使用Objective-C代码时，LLDB将使用非Swift（Objective-C）调试上下文，而如果您在Swift代码中停止，则LLDB将使用Swift上下文。听起来合乎逻辑，对吧？</p>
<p>但是你也可以指定上下文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) expression -l objc -O -- [UIApplication sharedApplication]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这里，您告诉LLDB使用Objective-C的objc语言。如有必要，您还可以使用objc + +作为Objective-C ++。</p>
</blockquote>
<h4 id="用户定义变量"><a href="#用户定义变量" class="headerlink" title="用户定义变量"></a>用户定义变量</h4><p>如前所述，LLDB将在打印对象时代表您自动创建局部变量。您也可以创建自己的变量。</p>
<p>但是记得名字前面加<code>$</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po id $test = [NSObject new] </span><br><span class="line">(lldb) po $test </span><br><span class="line">&lt;NSObject: 0x60000001d190&gt;</span><br><span class="line">(lldb) expression -l swift -O -- $test //切换至Swift上下文，同样可用</span><br><span class="line">&lt;NSObject: 0x60000001d190&gt;</span><br><span class="line">(lldb) expression -l swift -O -- $test.description //但是不能期待一切都正常</span><br><span class="line">error: &lt;EXPR&gt;:3:1: error: use of unresolved identifier &#x27;$test&#x27; $test.description ^~~~~</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这是一个正在积极开发的领域，Objective-C和Swift之间通过LLDB的桥梁可能会随着时间的推移而有所改善。</p>
</blockquote>
<p>在Xcoode创建符号断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Signals.MasterContainerViewController.viewDidLoad() -&gt; ()</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(lldb) p self</span><br><span class="line">(lldb) po $R0.title //$R0是上一步打印出来的self的变量的名字</span><br><span class="line">(lldb) expression -l swift -- $R0.title = &quot;new title&quot; //还可以修改</span><br></pre></td></tr></table></figure>

<p>通过键入continue或按Xcode中的播放按钮来恢复应用程序。就会发现标题已经更新为 ’new title‘</p>
<h5 id="类型格式化（Type-formatting）"><a href="#类型格式化（Type-formatting）" class="headerlink" title="类型格式化（Type formatting）"></a>类型格式化（Type formatting）</h5><p>LLDB的一个不错的选择是能够格式化基本数据类型的输出。这使得LLDB成为了解编译器如何格式化基本C类型的绝佳工具。当你正在探索汇编部分时，这是必须知道的，你将在本书后面做。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(lldb) expression -G x -- 10 //指定十进制格式化输出</span><br><span class="line">(lldb) p/x 10 //十进制</span><br><span class="line">(lldb) p/t 10 //二进制</span><br><span class="line">(lldb) p/d &#x27;D&#x27; //十进制</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-G &lt;gdb-format&gt; ( --gdb-format &lt;gdb-format&gt; )</span><br><span class="line">     Specify a format using a GDB format specifier string.</span><br></pre></td></tr></table></figure>

<p>输出格式的完整列表如下（取自<a target="_blank" rel="noopener" href="https://sourceware.org/gdb/">https://sourceware.org/gdb/</a> onlinedocs &#x2F; gdb &#x2F; Output-Formats.html）：</p>
<ul>
<li>x：十六进制</li>
<li>d：十进制</li>
<li>u：无符号十进制</li>
<li>o：八进制</li>
<li>t：二进制</li>
<li>a：地址</li>
<li>c：字符常量</li>
<li>f：浮点型</li>
<li>s：字符串</li>
</ul>
<p>如果这些格式不够，您可以使用LLDB的额外格式化程序，但您将无法使用GDB格式化语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) expression -f Y -- 1430672467</span><br><span class="line">(int) $0 = 53 54 46 55             STFU</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-f &lt;format&gt; ( --format &lt;format&gt; )</span><br><span class="line">     Specify a format to be used for display.</span><br></pre></td></tr></table></figure>

<p>LLDB具有以下格式化程序（摘自<a target="_blank" rel="noopener" href="http://lldb.llvm.org/varformats.html%EF%BC%89%EF%BC%9A">http://lldb.llvm.org/varformats.html）：</a></p>
<ul>
<li><p>B：布尔值</p>
</li>
<li><p>b：二进制</p>
</li>
<li><p>y：字节</p>
</li>
<li><p>Y：ASCII字节</p>
</li>
<li><p>c：字符</p>
</li>
<li><p>C：可打印字符</p>
</li>
<li><p>F：复杂的浮点型（包含实部和虚部）</p>
</li>
<li><p>s：c-string</p>
</li>
<li><p>i：十进制</p>
</li>
<li><p>E：枚举</p>
</li>
<li><p>x：十六进制</p>
</li>
<li><p>f：浮点型</p>
</li>
<li><p>o：八进制</p>
</li>
<li><p>O：MacOS OSType</p>
</li>
<li><p>U：UTF-16</p>
</li>
<li><p>u：无符号十进制</p>
</li>
<li><p>p：指针</p>
</li>
</ul>
<h3 id="第6章：线程，帧和步进（Thread-Frame-amp-Stepping-Around）"><a href="#第6章：线程，帧和步进（Thread-Frame-amp-Stepping-Around）" class="headerlink" title="第6章：线程，帧和步进（Thread, Frame &amp; Stepping Around）"></a>第6章：线程，帧和步进（Thread, Frame &amp; Stepping Around）</h3><p>您已经学习了如何创建断点，如何打印和修改值，以及如何在调试器中暂停时执行代码。但到目前为止，您已经处于高度干燥的状态，如何在调试器中移动并检查数据之外的数据。现在是时候了！</p>
<p>在本章中，您将学习如何在LLDB当前暂停时将调试器移入和移出功能。</p>
<p>这是一项关键技能，因为您经常需要在输入或退出代码片段时随时检查值。</p>
<h4 id="（栈的第一课）Stack-101"><a href="#（栈的第一课）Stack-101" class="headerlink" title="（栈的第一课）Stack 101"></a>（栈的第一课）Stack 101</h4><p>当计算机程序执行时，它将值存储在堆和栈中。两者都有其优点。作为高级调试器，您需要充分了解这些工作原理。现在，让我们简要介绍一下这个栈。</p>
<p>栈是LIFO（后进先出）队列，用于存储对当前正在执行的代码的引用。这种LIFO排序意味着最近添加的任何内容都会被删除。想想一栈盘子。在顶部添加一个盘子，它将是你首先取下的盘子。</p>
<p>栈指针指向栈的当前顶部。在板块类比中，栈指针指向顶板，告诉您从哪里取下一块板，或者在哪里放下一块板。</p>
<p><img src="/../assets/image-20190628093457893.png" alt="image-20190628093457893"></p>
<p>在此图中，高地址显示在顶部（0xFFFFFFFF），低地址显示在底部（0x00000000），显示栈将向下增长。</p>
<p>一些插图喜欢在底部具有高地址以与板类比匹配，因为栈将显示为向上增长。但是，我相信任何展示栈的图表都应显示从高地址向下增长，因为这会在以后讨论栈指针的偏移时引起较少的麻烦。</p>
<h4 id="检查栈的帧"><a href="#检查栈的帧" class="headerlink" title="检查栈的帧"></a>检查栈的帧</h4><p>这里我将使用 iPhone X Simulator。</p>
<p>添加断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Signals.MasterViewController.viewWillAppear(Swift.Bool) -&gt; ()</span><br></pre></td></tr></table></figure>

<p><img src="/../assets/image-20190628094640418.jpg" alt="image-20190628094640418"></p>
<p>在Debug Navigator面板中，将显示栈跟踪，显示栈帧列表，第一个是<code>viewWillAppear(_ :)</code>。接下来是Swift &#x2F; Objective-C桥接方法，<code>@objc MasterViewController.viewWillAppear(Bool) -&gt;():</code>。这个方法是自动生成的，所以Objective-C可以进入Swift代码。</p>
<p>之后，有一些来自UIKit的Objective-C代码栈帧。深入挖掘一下，你会看到一些属于CoreAnimation的C ++代码。更深入的是，你会看到一些方法都包含属于CoreFoundation的名称CFRunLoop。最后，最重要的是，main函数。</p>
<p>下面进入LLDB console：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) thread backtrace</span><br></pre></td></tr></table></figure>

<p>也可以使用<code>bt</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(lldb) help bt</span><br><span class="line">     Show the current thread&#x27;s call stack.  Any numeric argument displays at</span><br><span class="line">     most that many frames.  The argument &#x27;all&#x27; displays all threads.  Expects</span><br><span class="line">     &#x27;raw&#x27; input (see &#x27;help raw-input&#x27;.)</span><br><span class="line"></span><br><span class="line">Syntax: bt [&lt;digit&gt; | all]</span><br><span class="line"></span><br><span class="line">&#x27;bt&#x27; is an abbreviation for &#x27;_regexp-bt&#x27;</span><br><span class="line">(lldb) help thread backtrace</span><br><span class="line">     Show thread call stacks.  Defaults to the current thread, thread indexes</span><br><span class="line">     can be specified as arguments.</span><br><span class="line">     Use the thread-index &quot;all&quot; to see all threads.</span><br><span class="line">     Use the thread-index &quot;unique&quot; to see threads grouped by unique call stacks.</span><br><span class="line"></span><br><span class="line">Syntax: thread backtrace &lt;cmd-options&gt;</span><br><span class="line"></span><br><span class="line">Command Options Usage:</span><br><span class="line">  thread backtrace [-c &lt;count&gt;] [-s &lt;frame-index&gt;] [-e &lt;boolean&gt;]</span><br><span class="line"></span><br><span class="line">       -c &lt;count&gt; ( --count &lt;count&gt; )</span><br><span class="line">            How many frames to display (-1 for all)</span><br><span class="line"></span><br><span class="line">       -e &lt;boolean&gt; ( --extended &lt;boolean&gt; )</span><br><span class="line">            Show the extended backtrace, if available</span><br><span class="line"></span><br><span class="line">       -s &lt;frame-index&gt; ( --start &lt;frame-index&gt; )</span><br><span class="line">            Frame in which to start the backtrace</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(lldb) bt</span><br><span class="line">* thread #1, queue = &#x27;com.apple.main-thread&#x27;, stop reason = breakpoint 1.1</span><br><span class="line">  * frame #0: 0x0000000107044301 Signals`MasterViewController.viewWillAppear(animated=false, self=0x00007f9a26e0a670) at MasterViewController.swift:54:5</span><br><span class="line">    frame #1: 0x0000000107044993 Signals`@objc MasterViewController.viewWillAppear(_:) at &lt;compiler-generated&gt;:0</span><br><span class="line">    frame #2: 0x0000000110fc9437 UIKitCore`-[UIViewController _setViewAppearState:isAnimating:] + 687</span><br><span class="line">    frame #3: 0x0000000110fc9995 UIKitCore`__52-[UIViewController _setViewAppearState:isAnimating:]_block_invoke + 265</span><br><span class="line">    frame #4: 0x000000010957b33a CoreFoundation`-[__NSSingleObjectArrayI enumerateObjectsWithOptions:usingBlock:] + 58</span><br><span class="line">    frame #5: 0x0000000110fc9729 UIKitCore`-[UIViewController _setViewAppearState:isAnimating:] + 1441</span><br><span class="line">    frame #6: 0x0000000110fc9ba2 UIKitCore`-[UIViewController __viewWillAppear:] + 131</span><br><span class="line">    frame #7: 0x0000000110f275c9 UIKitCore`-[UINavigationController _startTransition:fromViewController:toViewController:] + 868</span><br><span class="line">    frame #8: 0x0000000110f283b5 UIKitCore`-[UINavigationController _startDeferredTransitionIfNeeded:] + 896</span><br><span class="line">    frame #9: 0x0000000110f296a7 UIKitCore`-[UINavigationController __viewWillLayoutSubviews] + 150</span><br><span class="line">    frame #10: 0x0000000110f0a38d UIKitCore`-[UILayoutContainerView layoutSubviews] + 217</span><br><span class="line">    frame #11: 0x0000000111a939c1 UIKitCore`-[UIView(CALayerDelegate) layoutSublayersOfLayer:] + 1417</span><br><span class="line">    frame #12: 0x000000010ea1feae QuartzCore`-[CALayer layoutSublayers] + 173</span><br><span class="line">    frame #13: 0x000000010ea24b88 QuartzCore`CA::Layer::layout_if_needed(CA::Transaction*) + 396</span><br><span class="line">    frame #14: 0x000000010ea30ee4 QuartzCore`CA::Layer::layout_and_display_if_needed(CA::Transaction*) + 72</span><br><span class="line">    frame #15: 0x000000010e9a03aa QuartzCore`CA::Context::commit_transaction(CA::Transaction*) + 328</span><br><span class="line">    frame #16: 0x000000010e9d7584 QuartzCore`CA::Transaction::commit() + 608</span><br><span class="line">    frame #17: 0x00000001115deccb UIKitCore`__34-[UIApplication _firstCommitBlock]_block_invoke_2 + 128</span><br><span class="line">    frame #18: 0x0000000109592aec CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__ + 12</span><br><span class="line">    frame #19: 0x00000001095922b0 CoreFoundation`__CFRunLoopDoBlocks + 336</span><br><span class="line">    frame #20: 0x000000010958cb34 CoreFoundation`__CFRunLoopRun + 1252</span><br><span class="line">    frame #21: 0x000000010958c302 CoreFoundation`CFRunLoopRunSpecific + 626</span><br><span class="line">    frame #22: 0x000000010e8e22fe GraphicsServices`GSEventRunModal + 65</span><br><span class="line">    frame #23: 0x00000001115c5ba2 UIKitCore`UIApplicationMain + 140</span><br><span class="line">    frame #24: 0x000000010704b88b Signals`main at AppDelegate.swift:32:7</span><br><span class="line">    frame #25: 0x000000010af06541 libdyld.dylib`start + 1</span><br><span class="line">(lldb) frame info</span><br><span class="line">frame #0: 0x0000000107044301 Signals`MasterViewController.viewWillAppear(animated=false, self=0x00007f9a26e0a670) at MasterViewController.swift:54:5</span><br></pre></td></tr></table></figure>

<p>如您所见，此输出与Debug Navigator中找到的内容相匹配。那么，如果您只是从Debug Navigator中看到所有内容，为什么这甚至很重要？好吧，使用LLDB控制台可以对您想要查看的信息进行细致的控制。此外，您将制作自定义LLDB脚本，其中这些命令将变得非常有用。知道Xcode从哪里获取信息也很好，对吧？</p>
<p>然后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) frame select 1</span><br><span class="line">frame #1: 0x0000000107044993 Signals`@objc MasterViewController.viewWillAppear(_:) at &lt;compiler-generated&gt;:0</span><br></pre></td></tr></table></figure>

<p>记下汇编中的绿线。在该行之前是负责执行<code>viewWillAppear(_:)</code>的<code>callq</code>指令，您在之前设置了断点。</p>
<p>不要让汇编太模糊你的眼睛。你还没有走出汇编树林……</p>
<h4 id="步进"><a href="#步进" class="headerlink" title="步进"></a>步进</h4><p>掌握LLDB时，您可以在程序暂停时执行的三个最重要的导航操作围绕着逐步执行程序。通过LLDB，您可以跳过（step over），单步执行（step in）或退出（step out）代码。</p>
<h5 id="跳过"><a href="#跳过" class="headerlink" title="跳过"></a>跳过</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) run //&#x27;run&#x27; is an abbreviation for &#x27;process launch -X true --&#x27;</span><br><span class="line">(lldb) next //&#x27;next&#x27; is an abbreviation for &#x27;thread step-over&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="单步执行"><a href="#单步执行" class="headerlink" title="单步执行"></a>单步执行</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) step //&#x27;step&#x27; is an abbreviation for &#x27;thread step-in&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) finish //&#x27;finish&#x27; is an abbreviation for &#x27;thread step-out&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>请记住，只需按Enter键，LLDB将执行您输入的最后一个命令。</p>
</blockquote>
<h5 id="Xcode-界面中步进"><a href="#Xcode-界面中步进" class="headerlink" title="Xcode 界面中步进"></a>Xcode 界面中步进</h5><p>虽然使用控制台可以获得更加精细的控制，但Xcode已经为LLDB控制台上方的按钮提供了这些选项。</p>
<h4 id="检查栈中的数据"><a href="#检查栈中的数据" class="headerlink" title="检查栈中的数据"></a>检查栈中的数据</h4><p><code>frame</code> 命令的一个非常有趣的选项是 <code>frame variable</code> 子命令。</p>
<p>此命令将获取可执行文件头中的调试符号信息（如果您的应用程序被剥离，则为dYSM …稍后会详细介绍）并转储该特定栈帧的信息。由于调试信息，frame variable命令可以使用适当的选项轻松告诉您函数中所有变量的范围以及程序中的任何全局变量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) frame variable</span><br><span class="line">(lldb) frame variable -F self //以平面格式打印结果</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-F ( --flat )</span><br><span class="line">      Display results in a flat format that uses expression paths for each variable or member.</span><br></pre></td></tr></table></figure>

<p><img src="/Users/will/git/blog/source/assets/image-20190701112507258.jpg" alt="image-20190701112507258"></p>
<blockquote>
<p>提供有关Apple私有API的ivars的更多信息，而不是Variables View。</p>
</blockquote>
<h3 id="第7章：镜像-Image"><a href="#第7章：镜像-Image" class="headerlink" title="第7章：镜像(Image)"></a>第7章：镜像(Image)</h3><p>现在是时候探索通过LLDB的权力找到感兴趣代码的最佳工具之一。在本章中，您将深入了解<code>image</code>命令。</p>
<p><code>image</code>命令是<code>target modules</code>子命令的别名。<code>image</code>命令专门查询 module 信息;也就是说，代码在进程中加载和执行。Module 可以包含许多东西，包括主要的可执行文件(main executables)，框架(framework)或插件(plugin)。但是，这些module中的大多数通常以动态库(dynamic libraries)的形式出现。动态库的示例包括适用于iOS的UIKit或适用于macOS的AppKit。</p>
<h4 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image list </span><br><span class="line">(lldb) image list Foundation</span><br><span class="line">[  0] FD4BF3C6-63C9-3A30-BEEA-D39F6F8EEB13 0x0000000107d70000 /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/Frameworks/Foundation.framework/Foundation </span><br></pre></td></tr></table></figure>

<p>这是一种有用的方法，可以找到有关所需module的信息。</p>
<p>让我们来探索这个输出。 那里有一些有趣的东西：</p>
<ol>
<li><p>首先打印module的UUID（FD4BF3C6-63C9-3A30-BEEA-D39F6F8EEB13）。UUID对于搜索符号信息和唯一标识Foundation module的版本非常重要。</p>
</li>
<li><p>在UUID之后是加载地址（0x0000000107d70000）。 这标识将Foundation  module加载到Signals可执行文件的进程空间中。</p>
</li>
<li><p>最后，您拥有module在磁盘上所在位置的完整路径。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image dump symtab UIKitCore -s address</span><br></pre></td></tr></table></figure>

<p>这将转储UIKitCore可用的所有符号表信息。由于<code>-s address</code>参数，此命令按私有UIKitCore模块中实现函数的地址对输出进行排序。</p>
<p>但是可读性不佳，需要另外一个命令来搜索：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -n &quot;-[UIViewController viewDidLoad]&quot;</span><br><span class="line">1 match found in /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore:</span><br><span class="line">        Address: UIKitCore[0x000000000034adf9] (UIKitCore.__TEXT.__text + 3443497)</span><br><span class="line">        Summary: UIKitCore`-[UIViewController viewDidLoad]</span><br></pre></td></tr></table></figure>

<p>这将转储与UIViewController的viewDidLoad实例方法相关的信息。</p>
<p>如果想用正则来模糊搜索：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn UIViewController</span><br></pre></td></tr></table></figure>

<p>但是这还不够，因为结果包含了<code>UIViewControllerBuiltinTransitionViewAnimator</code>，这并不是我们想要的，所改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn &#x27;\[UIViewController\ &#x27;</span><br><span class="line">(lldb) image lookup -rn \[UIViewController\s //等价的</span><br></pre></td></tr></table></figure>

<p>但是如果搜索Category，命名规则：<code>UIViewController(CategoryName)</code>，改进如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn &#x27;\[UIViewController\(\w+\)\ &#x27;</span><br></pre></td></tr></table></figure>

<p>当然这些都是参考正则表达式的规则，然后用在实际的需求中。</p>
<h5 id="寻找代码"><a href="#寻找代码" class="headerlink" title="寻找代码"></a>寻找代码</h5><p>您可以使用上面的<code>image lookup</code>命令找到UIViewController方法。您还使用它来寻找第4章“在代码中停止”中如何命名Swift属性setter和getter。</p>
<p>但是Block如何搜索呢？如下面例子</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_once(<span class="operator">&amp;</span>onceToken, <span class="operator">^</span>&#123;</span><br><span class="line">  sharedSignalHandler <span class="operator">=</span> [[<span class="type">UnixSignalHandler</span> alloc] initPrivate];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们先在Xcode添加断点，然后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(lldb) frame info</span><br><span class="line">frame #0: 0x00000001048e1250 Commons`__34+[UnixSignalHandler sharedHandler]_block_invoke(.block_descriptor=0x00000001048e8230) at UnixSignalHandler.m:72:28</span><br></pre></td></tr></table></figure>

<p>可以看到完整的函数名：<code> __34+[UnixSignalHandler sharedHandler]_block_invoke</code></p>
<p>让我们先试试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn _block_invoke</span><br></pre></td></tr></table></figure>

<p>结果太多，添加范围限制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn _block_invoke Commons</span><br></pre></td></tr></table></figure>

<p>现在创建断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lldb) rb appendSignal.*_block_invoke -s Commons</span><br></pre></td></tr></table></figure>

<p>之后我回到终端：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -SIGIO Signals</span><br></pre></td></tr></table></figure>

<p>就会触发刚刚创建的断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">2019-07-01 14:16:15.922561+0800 Signals[7583:429444] Appending new signal: SIGIO</span><br><span class="line">(lldb) frame variable</span><br><span class="line">(__block_literal_5 *) .block_descriptor = 0x0000600002f1d580</span><br><span class="line">(int) sig = &lt;read memory from 0x41 failed (0 of 4 bytes read)&gt;</span><br><span class="line"></span><br><span class="line">(siginfo_t *) siginfo = &lt;read memory from 0x39 failed (0 of 8 bytes read)&gt;</span><br><span class="line"></span><br><span class="line">(UnixSignalHandler *const) self = &lt;read memory from 0x31 failed (0 of 8 bytes read)&gt;</span><br><span class="line"></span><br><span class="line">(lldb) next</span><br><span class="line">(lldb) frame variable</span><br><span class="line">(__block_literal_5 *) .block_descriptor = 0x0000600002f1d580</span><br><span class="line">(int) sig = 23</span><br><span class="line">(siginfo_t *) siginfo = 0x00007ffeecdd9e78</span><br><span class="line">(UnixSignalHandler *) self = 0x0000600002f091c0</span><br><span class="line">(UnixSignal *) unixSignal = 0x0000000106ca4454</span><br></pre></td></tr></table></figure>

<p>您需要跳过一个语句，因此块执行了一些初始逻辑来设置函数，也称为函数序言（function prologue）。函数序言是与汇编相关的主题，您将在第II节中了解。</p>
<p>这实际上非常有趣。首先，您会看到一个block的对象，正在调用的。然后有sig和siginfo参数传递给Objective-C方法，在该方法中调用此块。这些如何传递到block中？</p>
<p>好吧，当创建一个block时，编译器足够聪明，可以确定它正在使用哪些参数。然后它创建一个将这些作为参数的函数。调用块时，调用此函数，并传入相关参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -t __block_literal_5</span><br><span class="line">Best match found in /Users/will/Library/Developer/Xcode/DerivedData/Signals-bgjklehkjddsnxcexztwhrufpsbn/Build/Products/Debug-iphonesimulator/Signals.app/Frameworks/Commons.framework/Commons:</span><br><span class="line">id = &#123;0x100000be1&#125;, name = &quot;__block_literal_5&quot;, byte-size = 52, decl = UnixSignalHandler.m:127, compiler_type = &quot;struct __block_literal_5 &#123;</span><br><span class="line">    void *__isa;</span><br><span class="line">    int __flags;</span><br><span class="line">    int __reserved;</span><br><span class="line">    void (*__FuncPtr)();</span><br><span class="line">    __block_descriptor_withcopydispose *__descriptor;</span><br><span class="line">    UnixSignalHandler *const self;</span><br><span class="line">    siginfo_t *siginfo;</span><br><span class="line">    int sig;</span><br><span class="line">&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>这是定义block的对象！</p>
<p>正如您所看到的，这几乎与头文件一样好，可以告诉您如何在block中导航内存。如果将内存中的引用转换为<code>__block_literal_5</code>类型，则可以轻松打印出block引用的所有变量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po ((__block_literal_5 *)0x0000600002f1d580)</span><br><span class="line">&lt;__NSMallocBlock__: 0x600002f1d580&gt;</span><br><span class="line">(lldb) p/x ((__block_literal_5 *)0x0000600002f1d580)-&gt;__FuncPtr</span><br><span class="line">(void (*)()) $1 = 0x0000000103143a80 (Commons`__38-[UnixSignalHandler appendSignal:sig:]_block_invoke_2 at UnixSignalHandler.m:127)</span><br><span class="line">(lldb) image lookup -a 0x0000000103143a80</span><br><span class="line">      Address: Commons[0x0000000000001a80] (Commons.__TEXT.__text + 2240)</span><br><span class="line">      Summary: Commons`__38-[UnixSignalHandler appendSignal:sig:]_block_invoke_2 at UnixSignalHandler.m:127</span><br><span class="line">(lldb) po ((__block_literal_5 *)0x0000600002f1d580)-&gt;sig //打印出传递给block的所有参数</span><br><span class="line">23</span><br><span class="line">(lldb) p *(__block_literal_5 *)0x0000600002f1d580 //可以使用p命令转储完整的结构并解除引用指针</span><br><span class="line">(__block_literal_5) $4 = &#123;</span><br><span class="line">  __isa = 0x0000000106d6e170</span><br><span class="line">  __flags = -1023410174</span><br><span class="line">  __reserved = 0</span><br><span class="line">  __FuncPtr = 0x0000000103143a80 (Commons`__38-[UnixSignalHandler appendSignal:sig:]_block_invoke_2 at UnixSignalHandler.m:127)</span><br><span class="line">  __descriptor = 0x000000010314a2c0</span><br><span class="line">  self = 0x0000600002f091c0</span><br><span class="line">  siginfo = 0x00007ffeecdd9e78</span><br><span class="line">  sig = 23</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="深入研究（Snooping-around）"><a href="#深入研究（Snooping-around）" class="headerlink" title="深入研究（Snooping around）"></a>深入研究（Snooping around）</h4><p>好的，您已经发现了如何以静态方式检查私有类的实例变量，但是该块内存地址太过诱人而无法置之不理。 尝试将其打印出来并使用动态分析进行探索。</p>
<p>直接打印block的内存地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po 0x0000600002f1d580</span><br><span class="line">&lt;__NSMallocBlock__: 0x600002f1d580&gt;</span><br><span class="line">(lldb) image lookup -rn __NSMallocBlock__ // 没有结果</span><br><span class="line">(lldb) po [__NSMallocBlock__ superclass]</span><br><span class="line">__NSMallocBlock</span><br><span class="line">(lldb) image lookup -rn __NSMallocBlock</span><br><span class="line">5 matches found in /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation:</span><br><span class="line">        Address: CoreFoundation[0x000000000018b600] (CoreFoundation.__TEXT.__text + 1614448)</span><br><span class="line">        Summary: CoreFoundation`-[__NSMallocBlock retain]        Address: CoreFoundation[0x000000000018b620] (CoreFoundation.__TEXT.__text + 1614480)</span><br><span class="line">        Summary: CoreFoundation`-[__NSMallocBlock release]        Address: CoreFoundation[0x000000000018b630] (CoreFoundation.__TEXT.__text + 1614496)</span><br><span class="line">        Summary: CoreFoundation`-[__NSMallocBlock retainCount]        Address: CoreFoundation[0x000000000018b640] (CoreFoundation.__TEXT.__text + 1614512)</span><br><span class="line">        Summary: CoreFoundation`-[__NSMallocBlock _tryRetain]        Address: CoreFoundation[0x000000000018b650] (CoreFoundation.__TEXT.__text + 1614528)</span><br><span class="line">        Summary: CoreFoundation`-[__NSMallocBlock _isDeallocating]</span><br><span class="line">        </span><br><span class="line">(lldb) po [__NSMallocBlock superclass]</span><br><span class="line">NSBlock</span><br><span class="line"></span><br><span class="line">(lldb) image lookup -rn &#x27;NSBlock\ &#x27;</span><br><span class="line">6 matches found in /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation:</span><br><span class="line">        Address: CoreFoundation[0x000000000018b4c0] (CoreFoundation.__TEXT.__text + 1614128)</span><br><span class="line">        Summary: CoreFoundation`+[NSBlock allocWithZone:]        Address: CoreFoundation[0x000000000018b4e0] (CoreFoundation.__TEXT.__text + 1614160)</span><br><span class="line">        Summary: CoreFoundation`+[NSBlock alloc]        Address: CoreFoundation[0x000000000018b500] (CoreFoundation.__TEXT.__text + 1614192)</span><br><span class="line">        Summary: CoreFoundation`-[NSBlock copy]        Address: CoreFoundation[0x000000000018b510] (CoreFoundation.__TEXT.__text + 1614208)</span><br><span class="line">        Summary: CoreFoundation`-[NSBlock copyWithZone:]        Address: CoreFoundation[0x000000000018b520] (CoreFoundation.__TEXT.__text + 1614224)</span><br><span class="line">        Summary: CoreFoundation`-[NSBlock invoke]        Address: CoreFoundation[0x000000000018b530] (CoreFoundation.__TEXT.__text + 1614240)</span><br><span class="line">        Summary: CoreFoundation`-[NSBlock performAfterDelay:]</span><br></pre></td></tr></table></figure>

<p>您现在将尝试在block上调用此方法。但是，当保留此block的引用释放其控制时，您不希望块消失，从而降低retainCount，并可能释放block。</p>
<p>有一种简单的方法来保持这个block - 只需 <code>retain</code> 它！在LLDB中键入以下内容，将地址替换为block的地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po id $block = (id)0x0000600002f1d580</span><br><span class="line">(lldb) po [$block retain]</span><br><span class="line">&lt;__NSMallocBlock__: 0x600002f1d580&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [$block invoke]</span><br><span class="line">2019-07-01 16:05:33.855039+0800 Signals[7583:452921] Appending new signal: SIGIO</span><br><span class="line"> nil</span><br></pre></td></tr></table></figure>

<p>这表明你已经再次调用了block！</p>
<p>这种用于探索公共和私有类，然后探索它们实现的方法的方法，是了解程序覆盖范围内的内容的好方法。稍后您将对方法使用相同的发现过程，然后分析这些方法执行的程序集，为您提供原始方法源代码的非常接近的近似值。</p>
<h5 id="Private-debugging-methods"><a href="#Private-debugging-methods" class="headerlink" title="Private debugging methods"></a>Private debugging methods</h5><p><code>image lookup</code> 命令可以很好地搜索私有方法以及您在Apple开发职业生涯中看到的公共方法。</p>
<p>但是，在调试自己的代码时，有一些隐藏的方法非常有用。</p>
<p>例如，以<code>_</code>开头的方法通常表示自己是一个私有（也可能是重要的！）方法。</p>
<p>让我们尝试在所有以下划线字符开头的模块中搜索任何Objective-C方法，并在其中包含单词“description”。</p>
<p>如果您在阅读此行代码时有些迷惑不解，强烈建议您仔细阅读 <a target="_blank" rel="noopener" href="https://docs.python.org/2/library/re.html">https://docs.python.org/2/library/re.html</a> 以了解正则表达式查询;从现在开始，它只会变得更加复杂。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(lldb) image lookup -rn (?i)\ _\w+description\] //不区分大小写</span><br><span class="line">(lldb) image lookup -rn NSObject\(IvarDescription\)</span><br><span class="line">(lldb) po [[UIApplication sharedApplication] _ivarDescription]</span><br><span class="line">(lldb) image lookup -rn &#x27;\[UIStatusBar\ set&#x27; //查找所以set开头方法</span><br><span class="line">(lldb) po (BOOL)[[UIStatusBar class] isSubclassOfClass:[UIView class]]</span><br></pre></td></tr></table></figure>

<p>通过地址调用对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po [[UIApplication sharedApplication] statusBar]</span><br><span class="line">&lt;UIStatusBar_Modern: 0x7f9965e03f00; frame = (0 0; 375 44); autoresize = W+BM; layer = &lt;CALayer: 0x6000025dd640&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x7f9965e03f00 setBackgroundColor:[UIColor purpleColor]]</span><br><span class="line">purpleColor</span><br></pre></td></tr></table></figure>

<blockquote>
<p>未完待续</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/14/SwiftUI-By-Example-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/14/SwiftUI-By-Example-Notes/" class="post-title-link" itemprop="url">SwiftUI By Example 笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-06-14 22:40:57" itemprop="dateCreated datePublished" datetime="2019-06-14T22:40:57+08:00">2019-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>原文为 <a target="_blank" rel="noopener" href="https://click.pg.mlsend.com/link/c/YT0xMTc1OTUxMzkxNzkzODc4OTYyJmM9djB0OCZlPTE5MjgmYj0yNTYyNzIyMDImZD1xMWs3eDlr.F1niXtzxMJPvGR0n5OkwVQKdeuMBcqaV_PH83g6F9CQ">@twostraws</a> 的 <a target="_blank" rel="noopener" href="https://click.pg.mlsend.com/link/c/YT0xMTc1OTUxMzkxNzkzODc4OTYyJmM9djB0OCZlPTE5MjgmYj0yNTYyNzIyMDYmZD12NmowZzZl.r3cdqNyvWJ5dIgoCiFs_1q8hUT3njlEH6fEv1rWAXGo">SwiftUI By Example</a>，就是简单记录一些主要内容。</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><strong>A brief explanation of the basics of SwiftUI</strong></p>
<h3 id="What-is-SwiftUI"><a href="#What-is-SwiftUI" class="headerlink" title="What is SwiftUI?"></a>What is SwiftUI?</h3><ol>
<li>声明式对比命令式，能够更好地处理不同状态的UI</li>
<li>跨平台：支持 iOS, macOS, tvOS, watchOS</li>
</ol>
<h3 id="SwiftUI-vs-Interface-Builder-and-storyboards"><a href="#SwiftUI-vs-Interface-Builder-and-storyboards" class="headerlink" title="SwiftUI vs Interface Builder and storyboards"></a>SwiftUI vs Interface Builder and storyboards</h3><ol>
<li>IB难以阅读和修改</li>
<li>IB难以看出修改了内容</li>
<li>IB和Swift交互不够友好，充满了Objective-C设计</li>
<li>SwiftUI是个仅支持Swift 的库，这样才可以充分利用Swift的特性</li>
</ol>
<p>Anyway, we’ll get onto exactly how SwiftUI works soon. For now, the least you need to know is that SwiftUI fixes many problems people had with the old Swift + Interface Builder approach:</p>
<ul>
<li>We no longer have to argue about programmatic or storyboard-based design, because SwiftUI gives us both at the same time.</li>
<li>We no longer have to worry about creating source control problems when committing user interface work, because code is much easier to read and manage than storyboard XML.</li>
<li>We no longer need to worry so much about stringly typed APIs – there are still some, but significantly fewer.</li>
<li>We no longer need to worry about calling functions that don’t exist, because our user interface gets checked by the Swift compiler.</li>
</ul>
<p>So, I hope you’ll agree there are lots of benefits to be had from moving to SwiftUI!</p>
<h3 id="Frequently-asked-questions-about-SwiftUI"><a href="#Frequently-asked-questions-about-SwiftUI" class="headerlink" title="Frequently asked questions about SwiftUI"></a>Frequently asked questions about SwiftUI</h3><h4 id="Does-SwiftUI-replace-UIKit"><a href="#Does-SwiftUI-replace-UIKit" class="headerlink" title="Does SwiftUI replace UIKit?"></a>Does SwiftUI replace UIKit?</h4><p>No. Many parts of SwiftUI directly build on top of existing UIKit components, such as UITableView. Of course, many other parts don’t – they are new controls rendered by SwiftUI and not UIKit.</p>
<p>But the point isn’t to what extent UIKit is involved. Instead, the point is that we don’t <em>care</em>. SwiftUI more or less completely masks UIKit’s behavior, so if you write your app for SwiftUI and Apple replaces UIKit with a singing elephant in two years you don’t have to care – as long as Apple makes the elephant compatible with the same methods and properties that UIKit exposed to SwiftUI, your code doesn’t change.</p>
<h4 id="Is-SwiftUI-fast"><a href="#Is-SwiftUI-fast" class="headerlink" title="Is SwiftUI fast?"></a>Is SwiftUI fast?</h4><p>SwiftUI is <em>screamingly</em> fast – in all my tests so far it seems to outpace UIKit. Having spoken to the team who made it I’m starting to get an idea why: first, they aggressively flatten their layer hierarchy so the system has to do less drawing, but second many operations bypass Core Animation entirely and go straight to Metal for extra speed.</p>
<p>So, yes: SwiftUI is incredibly fast, and all without us having to do any extra work.</p>
<h3 id="How-to-follow-this-quick-start-guide"><a href="#How-to-follow-this-quick-start-guide" class="headerlink" title="How to follow this quick start guide"></a>How to follow this quick start guide</h3><p>最好顺序阅读该教程</p>
<h3 id="Migrating-from-UIKit-to-SwiftUI"><a href="#Migrating-from-UIKit-to-SwiftUI" class="headerlink" title="Migrating from UIKit to SwiftUI"></a>Migrating from UIKit to SwiftUI</h3><p>如果你用过UIKit，不难发现SwiftUI就是把UI前缀去掉既是对应的组件。</p>
<p>Here’s a list to get you started, with UIKit class names followed by SwiftUI names:</p>
<ul>
<li><code>UITableView</code>: <code>List</code></li>
<li><code>UICollectionView</code>: No SwiftUI equivalent</li>
<li><code>UILabel</code>: <code>Text</code></li>
<li><code>UITextField</code>: <code>TextField</code></li>
<li><code>UITextField</code> with <code>isSecureTextEntry</code> set to true: <code>SecureField</code></li>
<li><code>UITextView</code>: No SwiftUI equivalent</li>
<li><code>UISwitch</code>: <code>Toggle</code></li>
<li><code>UISlider</code>: <code>Slider</code></li>
<li><code>UIButton</code>: <code>Button</code></li>
<li><code>UINavigationController</code>: <code>NavigationView</code></li>
<li><code>UIAlertController</code> with style <code>.alert</code>: <code>Alert</code></li>
<li><code>UIAlertController</code> with style <code>.actionSheet</code>: <code>ActionSheet</code></li>
<li><code>UIStackView</code> with horizontal axis: <code>HStack</code></li>
<li><code>UIStackView</code> with vertical axis: <code>VStack</code></li>
<li><code>UIImageView</code>: <code>Image</code></li>
<li><code>UISegmentedControl</code>: <code>SegmentedControl</code></li>
<li><code>UIStepper</code>: <code>Stepper</code></li>
<li><code>UIDatePicker</code>: <code>DatePicker</code></li>
<li><code>NSAttributedString</code>: Incompatible with SwiftUI; use <code>Text</code> instead.</li>
</ul>
<h2 id="Text-and-images"><a href="#Text-and-images" class="headerlink" title="Text and images"></a>Text and images</h2><p><strong>Getting started with basic controls</strong></p>
<h3 id="What’s-in-the-basic-template"><a href="#What’s-in-the-basic-template" class="headerlink" title="What’s in the basic template?"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/whats-in-the-basic-template">What’s in the basic template?</a></h3><p>SceneDelegate.swift is responsible for managing the way your app is shown.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(rootView: <span class="type">ContentView</span>())</span><br><span class="line"><span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">window.makeKeyAndVisible()</span><br></pre></td></tr></table></figure>

<p>Open ContentView.swift and let’s look at some actual SwiftUI code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span> : <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>

<p>First, notice how <code>ContentView</code> is a struct.</p>
<p>Second, <code>ContentView</code> conforms to the <code>View</code> protocol.</p>
<p>第三，<code>body</code>的返回类型是<code>some view</code>。 <code>some</code>关键字是Swift 5.1中的新关键字，是名为<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=DvHkeUxiwYY">opaque return types</a>的功能的一部分，在这种情况下，就是字面意思：”这将返回某种<code>View</code>，但SwiftUI不需要知道（或关心）什么。”</p>
<p>Finally, below <code>ContentView</code> is a similar-but-different struct called <code>ContentView_Previews</code>.</p>
<h3 id="How-to-create-static-labels-with-a-Text-view"><a href="#How-to-create-static-labels-with-a-Text-view" class="headerlink" title="How to create static labels with a Text view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-static-labels-with-a-text-view">How to create static labels with a Text view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    .lineLimit(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;This is an extremely long string that will never fit even the widest of Phones&quot;</span>)</span><br><span class="line">    .truncationMode(.middle)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-style-text-views-with-fonts-colors-line-spacing-and-more"><a href="#How-to-style-text-views-with-fonts-colors-line-spacing-and-more" class="headerlink" title="How to style text views with fonts, colors, line spacing, and more"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-style-text-views-with-fonts-colors-line-spacing-and-more">How to style text views with fonts, colors, line spacing, and more</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;This is an extremely long string that will never fit even the widest of Phones&quot;</span>)</span><br><span class="line">        .truncationMode(.middle)</span><br><span class="line">        .font(<span class="type">Font</span>.body)</span><br><span class="line">        .foregroundColor(<span class="type">Color</span>.green)</span><br><span class="line">        .background(<span class="type">Color</span>.gray)</span><br><span class="line">        .lineLimit(<span class="literal">nil</span>)</span><br><span class="line">        .lineSpacing(<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-format-text-inside-text-views"><a href="#How-to-format-text-inside-text-views" class="headerlink" title="How to format text inside text views"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-format-text-inside-text-views">How to format text inside text views</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> taskDateFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dueDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Task due date: <span class="subst">\(dueDate, formatter: <span class="keyword">Self</span>.taskDateFormat)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="How-to-draw-images-using-Image-views"><a href="#How-to-draw-images-using-Image-views" class="headerlink" title="How to draw images using Image views"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-draw-images-using-image-views">How to draw images using Image views</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(systemName: <span class="string">&quot;cloud.heavyrain.fill&quot;</span>)</span><br><span class="line">    .foregroundColor(.red)</span><br><span class="line">		.font(.largeTitle)</span><br></pre></td></tr></table></figure>



<h3 id="How-to-adjust-the-way-an-image-is-fitted-to-its-space"><a href="#How-to-adjust-the-way-an-image-is-fitted-to-its-space" class="headerlink" title="How to adjust the way an image is fitted to its space"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-adjust-the-way-an-image-is-fitted-to-its-space">How to adjust the way an image is fitted to its space</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">    .resizable()</span><br><span class="line">    .aspectRatio(contentMode: .fill)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-render-a-gradient"><a href="#How-to-render-a-gradient" class="headerlink" title="How to render a gradient"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-render-a-gradient">How to render a gradient</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .foregroundColor(.white)</span><br><span class="line">    .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .black]), startPoint: .top, endPoint: .bottom), cornerRadius: <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>支持更多颜色的渐变</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .foregroundColor(.white)</span><br><span class="line">    .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .red, .black]), startPoint: .leading, endPoint: .trailing), cornerRadius: <span class="number">0</span>)</span><br></pre></td></tr></table></figure>



<h3 id="How-to-display-solid-shapes"><a href="#How-to-display-solid-shapes" class="headerlink" title="How to display solid shapes"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-display-solid-shapes">How to display solid shapes</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Rectangle</span>()</span><br><span class="line">    .fill(<span class="type">Color</span>.red)</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-use-images-and-other-views-as-a-backgrounds"><a href="#How-to-use-images-and-other-views-as-a-backgrounds" class="headerlink" title="How to use images and other views as a backgrounds"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-use-images-and-other-views-as-a-backgrounds">How to use images and other views as a backgrounds</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">    .font(.largeTitle)</span><br><span class="line">    .background(</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">            .resizable()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>))</span><br></pre></td></tr></table></figure>

<h2 id="View-layout"><a href="#View-layout" class="headerlink" title="View layout"></a>View layout</h2><p><strong>Position views in a grid structure and more</strong></p>
<h3 id="How-to-create-stacks-using-VStack-and-HStack"><a href="#How-to-create-stacks-using-VStack-and-HStack" class="headerlink" title="How to create stacks using VStack and HStack"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-stacks-using-vstack-and-hstack">How to create stacks using VStack and HStack</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;SwiftUI&quot;</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;rocks&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-customize-stack-layouts-with-alignment-and-spacing"><a href="#How-to-customize-stack-layouts-with-alignment-and-spacing" class="headerlink" title="How to customize stack layouts with alignment and spacing"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-customize-stack-layouts-with-alignment-and-spacing">How to customize stack layouts with alignment and spacing</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;SwiftUI&quot;</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;rocks&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-control-spacing-around-individual-views-using-padding"><a href="#How-to-control-spacing-around-individual-views-using-padding" class="headerlink" title="How to control spacing around individual views using padding"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-control-spacing-around-individual-views-using-padding">How to control spacing around individual views using padding</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;SwiftUI&quot;</span>)</span><br><span class="line">    .padding(.bottom, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-layer-views-on-top-of-each-other-using-ZStack"><a href="#How-to-layer-views-on-top-of-each-other-using-ZStack" class="headerlink" title="How to layer views on top of each other using ZStack"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-layer-views-on-top-of-each-other-using-zstack">How to layer views on top of each other using ZStack</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ZStack</span> &#123;</span><br><span class="line">           <span class="type">Rectangle</span>()</span><br><span class="line">               .fill(<span class="type">Color</span>.red)</span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<h3 id="How-to-return-different-view-types"><a href="#How-to-return-different-view-types" class="headerlink" title="How to return different view types"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-return-different-view-types">How to return different view types</a></h3><p>第一种方案</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Group</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">Bool</span>.random() &#123;</span><br><span class="line">            <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Better luck next time&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二种方案</p>
<p>If you haven’t heard of this concept, it effectively forces Swift to forget about what specific type is inside the <code>AnyView</code>, allowing them to look like they are the same thing. This has a performance cost, though, so don’t use it often.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="type">AnyView</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="type">Bool</span>.random() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">Text</span>(<span class="string">&quot;Better luck next time&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="How-to-create-views-in-a-loop-using-ForEach"><a href="#How-to-create-views-in-a-loop-using-ForEach" class="headerlink" title="How to create views in a loop using ForEach"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-views-in-a-loop-using-foreach">How to create views in a loop using ForEach</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">    <span class="type">ForEach</span>((<span class="number">1</span><span class="operator">...</span><span class="number">10</span>).reversed()) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>…&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Ready or not, here I come!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> colors: [<span class="type">Color</span>] <span class="operator">=</span> [.red, .green, .blue]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(colors.identified(by: \.<span class="keyword">self</span>)) &#123; color <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(color.description.capitalized)</span><br><span class="line">                    .padding()</span><br><span class="line">                    .background(color)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-different-layouts-using-size-classes"><a href="#How-to-create-different-layouts-using-size-classes" class="headerlink" title="How to create different layouts using size classes"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-different-layouts-using-size-classes">How to create different layouts using size classes</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.horizontalSizeClass) <span class="keyword">var</span> horizontalSizeClass: <span class="type">UserInterfaceSizeClass</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> horizontalSizeClass <span class="operator">==</span> .compact &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Text</span>(<span class="string">&quot;Compact&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Text</span>(<span class="string">&quot;Regular&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-place-content-outside-the-safe-area"><a href="#How-to-place-content-outside-the-safe-area" class="headerlink" title="How to place content outside the safe area"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-place-content-outside-the-safe-area">How to place content outside the safe area</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    .frame(minWidth: <span class="number">0</span>, maxWidth: .infinity, minHeight: <span class="number">0</span>, maxHeight: .infinity)</span><br><span class="line">    .background(<span class="type">Color</span>.red)</span><br><span class="line">    .edgesIgnoringSafeArea(.all)</span><br></pre></td></tr></table></figure>

<h2 id="Reading-input"><a href="#Reading-input" class="headerlink" title="Reading input"></a>Reading input</h2><p><strong>Respond to interaction and control your program state</strong></p>
<h3 id="Working-with-state"><a href="#Working-with-state" class="headerlink" title="Working with state"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/working-with-state">Working with state</a></h3><p>SwiftUI solves this problem by removing state from our control. When we add properties to our views they are effectively inert – they have values, sure, but changing them doesn’t do anything. But if we added the special <code>@State</code> attribute before them, SwiftUI will automatically watch for changes and update any parts of our views that use that state.</p>
<h3 id="How-to-create-a-toggle-switch"><a href="#How-to-create-a-toggle-switch" class="headerlink" title="How to create a toggle switch"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-toggle-switch">How to create a toggle switch</a></h3><p>相反，我们应该定义一个<code>@State</code>布尔属性，用于存储切换的当前值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showGreeting <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$showGreeting</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show welcome message&quot;</span>)</span><br><span class="line">            &#125;.padding()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showGreeting &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-tappable-button"><a href="#How-to-create-a-tappable-button" class="headerlink" title="How to create a tappable button"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-tappable-button">How to create a tappable button</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showDetails <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                <span class="keyword">self</span>.showDetails.toggle()</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show details&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetails &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;You should follow me on Twitter: @twostraws&quot;</span>)</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .lineLimit(<span class="literal">nil</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-read-text-from-a-TextField"><a href="#How-to-read-text-from-a-TextField" class="headerlink" title="How to read text from a TextField"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-read-text-from-a-textfield">How to read text from a TextField</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> name: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Tim&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">TextField</span>(<span class="variable">$name</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, <span class="subst">\(name)</span>!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-add-a-border-to-a-TextField"><a href="#How-to-add-a-border-to-a-TextField" class="headerlink" title="How to add a border to a TextField"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-a-border-to-a-textfield">How to add a border to a TextField</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TextField</span>(<span class="variable">$yourBindingHere</span>)</span><br><span class="line">    .textFieldStyle(.roundedBorder)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-secure-text-fields-using-SecureField"><a href="#How-to-create-secure-text-fields-using-SecureField" class="headerlink" title="How to create secure text fields using SecureField"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-secure-text-fields-using-securefield">How to create secure text fields using SecureField</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> password: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">SecureField</span>(<span class="variable">$password</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;You entered: <span class="subst">\(password)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-Slider-and-read-values-from-it"><a href="#How-to-create-a-Slider-and-read-values-from-it" class="headerlink" title="How to create a Slider and read values from it"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-slider-and-read-values-from-it">How to create a Slider and read values from it</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> celsius: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Slider</span>(value: <span class="variable">$celsius</span>, from: <span class="operator">-</span><span class="number">100</span>, through: <span class="number">100</span>, by: <span class="number">0.1</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(celsius)</span> Celsius is <span class="subst">\(celsius <span class="operator">*</span> <span class="number">9</span> <span class="operator">/</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">32</span>)</span> Fahrenheit&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-date-picker-and-read-values-from-it"><a href="#How-to-create-a-date-picker-and-read-values-from-it" class="headerlink" title="How to create a date picker and read values from it"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-date-picker-and-read-values-from-it">How to create a date picker and read values from it</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> colors <span class="operator">=</span> [<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;Tartan&quot;</span>]</span><br><span class="line">   <span class="meta">@State</span> <span class="keyword">var</span> selectedColor <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">         <span class="type">Picker</span>(selection: <span class="variable">$selectedColor</span>, label: <span class="type">Text</span>(<span class="string">&quot;Please choose a color&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="number">0</span> <span class="operator">..&lt;</span> colors.count) &#123;</span><br><span class="line">               <span class="type">Text</span>(<span class="keyword">self</span>.colors[<span class="variable">$0</span>]).tag(<span class="variable">$0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="type">Text</span>(<span class="string">&quot;You selected: <span class="subst">\(colors[selectedColor])</span>&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-segmented-control-and-read-values-from-it"><a href="#How-to-create-a-segmented-control-and-read-values-from-it" class="headerlink" title="How to create a segmented control and read values from it"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-segmented-control-and-read-values-from-it">How to create a segmented control and read values from it</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> favoriteColor <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> colors <span class="operator">=</span> [<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">SegmentedControl</span>(selection: <span class="variable">$favoriteColor</span>) &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span>colors.count) &#123; index <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="keyword">self</span>.colors[index]).tag(index)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Value: <span class="subst">\(colors[favoriteColor])</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-read-tap-and-double-tap-gestures"><a href="#How-to-read-tap-and-double-tap-gestures" class="headerlink" title="How to read tap and double-tap gestures"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-read-tap-and-double-tap-gestures">How to read tap and double-tap gestures</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">    .tapAction(count: <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Double tapped!&quot;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-add-a-gesture-recognizer-to-a-view"><a href="#How-to-add-a-gesture-recognizer-to-a-view" class="headerlink" title="How to add a gesture recognizer to a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-a-gesture-recognizer-to-a-view">How to add a gesture recognizer to a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> scale: <span class="type">Length</span> <span class="operator">=</span> <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">            .scaleEffect(scale)</span><br><span class="line"></span><br><span class="line">            .gesture(</span><br><span class="line">                <span class="type">TapGesture</span>()</span><br><span class="line">                    .onEnded &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                        <span class="keyword">self</span>.scale <span class="operator">+=</span> <span class="number">0.1</span></span><br><span class="line">                    &#125;</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><p><strong>Create scrolling tables of data</strong></p>
<h3 id="Working-with-lists"><a href="#Working-with-lists" class="headerlink" title="Working with lists"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/working-with-lists">Working with lists</a></h3><p>SwiftUI’s <code>List</code> view is similar to <code>UITableView</code> in that it can show static or dynamic table view cells based on your needs.</p>
<h3 id="How-to-create-a-list-of-static-items"><a href="#How-to-create-a-list-of-static-items" class="headerlink" title="How to create a list of static items"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-list-of-static-items">How to create a list of static items</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RestaurantRow</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Restaurant: <span class="subst">\(name)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">RestaurantRow</span>(name: <span class="string">&quot;Joe&#x27;s Original&quot;</span>)</span><br><span class="line">            <span class="type">RestaurantRow</span>(name: <span class="string">&quot;The Real Joe&#x27;s Original&quot;</span>)</span><br><span class="line">            <span class="type">RestaurantRow</span>(name: <span class="string">&quot;Original Joe&#x27;s&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-list-of-dynamic-items"><a href="#How-to-create-a-list-of-dynamic-items" class="headerlink" title="How to create a list of dynamic items"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-list-of-dynamic-items">How to create a list of dynamic items</a></h3><p>In order to handle dynamic items, you must first tell SwiftUI how it can identify which item is which. This is done using the <code>Identifiable</code> protocol, which has only one requirement: some sort of <code>id</code> value that SwiftUI can use to see which item is which.</p>
<p>和<code>ForEach</code>一样，可以使用符合<code>Identifiable</code> 协议的Model</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Restaurant</span>: <span class="title class_">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RestaurantRow</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> restaurant: <span class="type">Restaurant</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Come and eat at <span class="subst">\(restaurant.name)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> first <span class="operator">=</span> <span class="type">Restaurant</span>(name: <span class="string">&quot;Joe&#x27;s Original&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> second <span class="operator">=</span> <span class="type">Restaurant</span>(name: <span class="string">&quot;The Real Joe&#x27;s Original&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> third <span class="operator">=</span> <span class="type">Restaurant</span>(name: <span class="string">&quot;Original Joe&#x27;s&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> restaurants <span class="operator">=</span> [first, second, third]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">List</span>(restaurants) &#123; restaurant <span class="keyword">in</span></span><br><span class="line">            <span class="type">RestaurantRow</span>(restaurant: restaurant)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// return List(restaurants, rowContent: RestaurantRow.init)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="How-to-add-sections-to-a-list"><a href="#How-to-add-sections-to-a-list" class="headerlink" title="How to add sections to a list"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-sections-to-a-list">How to add sections to a list</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Section</span>(header: <span class="type">Text</span>(<span class="string">&quot;Other tasks&quot;</span>), footer: <span class="type">Text</span>(<span class="string">&quot;End&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">TaskRow</span>()</span><br><span class="line">    <span class="type">TaskRow</span>()</span><br><span class="line">    <span class="type">TaskRow</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-make-a-grouped-list"><a href="#How-to-make-a-grouped-list" class="headerlink" title="How to make a grouped list"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-make-a-grouped-list">How to make a grouped list</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ExampleRow</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Example Row&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(header: <span class="type">Text</span>(<span class="string">&quot;Examples&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.listStyle(.grouped)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Working-with-implicit-stacking"><a href="#Working-with-implicit-stacking" class="headerlink" title="Working with implicit stacking"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/working-with-implicit-stacking">Working with implicit stacking</a></h3><p>What happens if you create a dynamic list and put more than one thing in each row? SwiftUI’s solution is simple, flexible, and gives us great behavior by default: it creates an implicit <code>HStack</code> to hold your items, so they automatically get laid out horizontally.</p>
<p>List 会隐式的创建一个<code>HStack</code> 封装所有元素到Row中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ExampleRow</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Example Row&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(header: <span class="type">Text</span>(<span class="string">&quot;Examples&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">                <span class="type">ExampleRow</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.listStyle(.grouped)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Containers"><a href="#Containers" class="headerlink" title="Containers"></a>Containers</h2><p><strong>Place your views inside a navigation controller</strong></p>
<h3 id="Working-with-containers"><a href="#Working-with-containers" class="headerlink" title="Working with containers"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/working-with-containers">Working with containers</a></h3><p>SwiftUI is designed to be composed right out of the box, which means you can place one view inside another as much as you need.</p>
<p>常见的容器有：  <code>NavigationView</code>, <code>TabbedView</code>, <code>Group</code></p>
<h3 id="How-to-embed-a-view-in-a-navigation-view"><a href="#How-to-embed-a-view-in-a-navigation-view" class="headerlink" title="How to embed a view in a navigation view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-embed-a-view-in-a-navigation-view">How to embed a view in a navigation view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NavigationView</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;SwiftUI&quot;</span>)</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Welcome&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-add-bar-items-to-a-navigation-view"><a href="#How-to-add-bar-items-to-a-navigation-view" class="headerlink" title="How to add bar items to a navigation view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-bar-items-to-a-navigation-view">How to add bar items to a navigation view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;SwiftUI&quot;</span>)</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Welcome&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing:</span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Help tapped!&quot;</span>)</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Help&quot;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-group-views-together"><a href="#How-to-group-views-together" class="headerlink" title="How to group views together"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-group-views-together">How to group views together</a></h3><p><code>Stack</code> 不能超过10个元素</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Line&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Alerts-and-action-sheets"><a href="#Alerts-and-action-sheets" class="headerlink" title="Alerts and action sheets"></a>Alerts and action sheets</h2><p><strong>Show modal notifications when something happens</strong></p>
<h3 id="Working-with-presentations"><a href="#Working-with-presentations" class="headerlink" title="Working with presentations"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/working-with-presentations">Working with presentations</a></h3><p>SwiftUI’s declarative approach to programming means that we don’t create and present alert and action sheets in the same way as we did in UIKit. Instead, we define the conditions in which they should be shown, tell it what they should look like, then leave it to figure the rest out for itself.</p>
<h3 id="How-to-show-an-alert"><a href="#How-to-show-an-alert" class="headerlink" title="How to show an alert"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-show-an-alert">How to show an alert</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingAlert <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.showingAlert <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Show Alert&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .presentation(<span class="variable">$showingAlert</span>) &#123;</span><br><span class="line">            <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;Important message&quot;</span>), message: <span class="type">Text</span>(<span class="string">&quot;Wear sunscreen&quot;</span>), dismissButton: .default(<span class="type">Text</span>(<span class="string">&quot;Got it!&quot;</span>)))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-add-actions-to-alert-buttons"><a href="#How-to-add-actions-to-alert-buttons" class="headerlink" title="How to add actions to alert buttons"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-actions-to-alert-buttons">How to add actions to alert buttons</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingAlert <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.showingAlert <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Show Alert&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">            .presentation(<span class="variable">$showingAlert</span>) &#123;</span><br><span class="line">                <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;Are you sure you want to delete this?&quot;</span>), message: <span class="type">Text</span>(<span class="string">&quot;There is no undo&quot;</span>), primaryButton: .destructive(<span class="type">Text</span>(<span class="string">&quot;Delete&quot;</span>)) &#123;</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Deleting...&quot;</span>)</span><br><span class="line">                &#125;, secondaryButton: .cancel())</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-show-an-action-sheet"><a href="#How-to-show-an-action-sheet" class="headerlink" title="How to show an action sheet"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-show-an-action-sheet">How to show an action sheet</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingSheet <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sheet: <span class="type">ActionSheet</span> &#123;</span><br><span class="line">        <span class="type">ActionSheet</span>(title: <span class="type">Text</span>(<span class="string">&quot;Action&quot;</span>), message: <span class="type">Text</span>(<span class="string">&quot;Quote mark&quot;</span>), buttons: [.default(<span class="type">Text</span>(<span class="string">&quot;Woo&quot;</span>), onTrigger: &#123;</span><br><span class="line">            <span class="keyword">self</span>.showingSheet <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        &#125;)])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.showingSheet <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Woo&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">            .presentation(showingSheet <span class="operator">?</span> sheet : <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Presenting-views"><a href="#Presenting-views" class="headerlink" title="Presenting views"></a>Presenting views</h2><p><strong>Move your user from one view to another</strong></p>
<h3 id="How-to-push-a-new-view-using-NavigationButton"><a href="#How-to-push-a-new-view-using-NavigationButton" class="headerlink" title="How to push a new view using NavigationButton"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-push-a-new-view-using-navigationbutton">How to push a new view using NavigationButton</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Detail&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">NavigationButton</span>(destination: <span class="type">DetailView</span>()) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Click&quot;</span>)</span><br><span class="line">            &#125;.navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Navigation&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-push-a-new-view-when-a-list-row-is-tapped"><a href="#How-to-push-a-new-view-when-a-list-row-is-tapped" class="headerlink" title="How to push a new view when a list row is tapped"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-push-a-new-view-when-a-list-row-is-tapped">How to push a new view when a list row is tapped</a></h3><p>SwiftUI doesn’t have a direct equivalent of the <code>didSelectRowAt</code> method of <code>UITableView</code>, but it doesn’t need one because we can combine <code>NavigationButton</code>with a list row and get the behavior for free.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Restaurant</span>: <span class="title class_">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RestaurantRow</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> restaurant: <span class="type">Restaurant</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(restaurant.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RestaurantView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> restaurant: <span class="type">Restaurant</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Come and eat at <span class="subst">\(restaurant.name)</span>&quot;</span>)</span><br><span class="line">            .font(.largeTitle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> first <span class="operator">=</span> <span class="type">Restaurant</span>(name: <span class="string">&quot;Joe&#x27;s Original&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> restaurants <span class="operator">=</span> [first]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(restaurants) &#123; restaurant <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationButton</span>(destination: <span class="type">RestaurantView</span>(restaurant: restaurant)) &#123;</span><br><span class="line">                    <span class="type">RestaurantRow</span>(restaurant: restaurant)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;.navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Select a restaurant&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="How-to-present-a-new-view-using-PresentationButton"><a href="#How-to-present-a-new-view-using-PresentationButton" class="headerlink" title="How to present a new view using PresentationButton"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-present-a-new-view-using-presentationbutton">How to present a new view using PresentationButton</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Detail&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PresentationButton</span>(<span class="type">Text</span>(<span class="string">&quot;Click to show&quot;</span>), destination: <span class="type">DetailView</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Transforming-views"><a href="#Transforming-views" class="headerlink" title="Transforming views"></a>Transforming views</h2><p><strong>Clip, size, scale, spin, and more</strong></p>
<h3 id="How-to-give-a-view-a-custom-frame"><a href="#How-to-give-a-view-a-custom-frame" class="headerlink" title="How to give a view a custom frame"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-give-a-view-a-custom-frame">How to give a view a custom frame</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Button tapped&quot;</span>)</span><br><span class="line">&#125;) &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Welcome&quot;</span>)</span><br><span class="line">        .frame(minWidth: <span class="number">0</span>, maxWidth: <span class="number">200</span>, minHeight: <span class="number">0</span>, maxHeight: <span class="number">200</span>)</span><br><span class="line">        .font(.largeTitle)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Text</span>(<span class="string">&quot;Please log in&quot;</span>)</span><br><span class="line">.frame(minWidth: <span class="number">0</span>, maxWidth: .infinity, minHeight: <span class="number">0</span>, maxHeight: .infinity)</span><br><span class="line">    .font(.largeTitle)</span><br><span class="line">    .foregroundColor(.white)</span><br><span class="line">    .background(<span class="type">Color</span>.red)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-adjust-the-position-of-a-view"><a href="#How-to-adjust-the-position-of-a-view" class="headerlink" title="How to adjust the position of a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-adjust-the-position-of-a-view">How to adjust the position of a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Home&quot;</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Options&quot;</span>)</span><br><span class="line">        .offset(y: <span class="number">15</span>)</span><br><span class="line">        .padding(.bottom, <span class="number">15</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Help&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-color-the-padding-around-a-view"><a href="#How-to-color-the-padding-around-a-view" class="headerlink" title="How to color the padding around a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-color-the-padding-around-a-view">How to color the padding around a view</a></h3><p>Padding 的先后顺序影响结果，因为代码是顺序执行的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">    .background(<span class="type">Color</span>.black)</span><br><span class="line">    .foregroundColor(.white)</span><br><span class="line">    .padding()</span><br><span class="line"></span><br><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.black)</span><br><span class="line">    .foregroundColor(.white)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-stack-modifiers-to-create-more-advanced-effects"><a href="#How-to-stack-modifiers-to-create-more-advanced-effects" class="headerlink" title="How to stack modifiers to create more advanced effects"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-stack-modifiers-to-create-more-advanced-effects">How to stack modifiers to create more advanced effects</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Forecast: Sun&quot;</span>)</span><br><span class="line">    .font(.largeTitle)</span><br><span class="line">    .foregroundColor(.white)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.red)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.orange)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.yellow)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-draw-a-border-around-a-view"><a href="#How-to-draw-a-border-around-a-view" class="headerlink" title="How to draw a border around a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-draw-a-border-around-a-view">How to draw a border around a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .border(<span class="type">Color</span>.red, width: <span class="number">4</span>, cornerRadius: <span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-draw-a-shadow-around-a-view"><a href="#How-to-draw-a-shadow-around-a-view" class="headerlink" title="How to draw a shadow around a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-draw-a-shadow-around-a-view">How to draw a shadow around a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hacking with Swift&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .border(<span class="type">Color</span>.red, width: <span class="number">4</span>)</span><br><span class="line">    .shadow(color: .red, radius: <span class="number">5</span>, x: <span class="number">20</span>, y: <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-clip-a-view-so-only-part-is-visible"><a href="#How-to-clip-a-view-so-only-part-is-visible" class="headerlink" title="How to clip a view so only part is visible"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-clip-a-view-so-only-part-is-visible">How to clip a view so only part is visible</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Button tapped&quot;</span>)</span><br><span class="line">&#125;) &#123;</span><br><span class="line">    <span class="type">Image</span>(systemName: <span class="string">&quot;bolt.fill&quot;</span>)</span><br><span class="line">        .foregroundColor(.white)</span><br><span class="line">        .padding()</span><br><span class="line">        .background(<span class="type">Color</span>.green)</span><br><span class="line">        .clipShape(<span class="type">Circle</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-rotate-a-view"><a href="#How-to-rotate-a-view" class="headerlink" title="How to rotate a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-rotate-a-view">How to rotate a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> rotation: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Slider</span>(value: <span class="variable">$rotation</span>, from: <span class="number">0.0</span>, through: <span class="number">360.0</span>, by: <span class="number">1.0</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Up we go&quot;</span>)</span><br><span class="line">                .rotationEffect(.degrees(rotation))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-rotate-a-view-in-3D"><a href="#How-to-rotate-a-view-in-3D" class="headerlink" title="How to rotate a view in 3D"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-rotate-a-view-in-3d">How to rotate a view in 3D</a></h3><p>SwiftUI’s <code>rotation3DEffect()</code> modifier lets us rotate views in 3D space to create beautiful effects in almost no code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;EPISODE LLVM&quot;</span>)</span><br><span class="line">    .font(.largeTitle)</span><br><span class="line">    .foregroundColor(.yellow)</span><br><span class="line">    .rotation3DEffect(.degrees(<span class="number">45</span>), axis: (x: <span class="number">1</span>, y: <span class="number">0</span>, z: <span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<h3 id="How-to-scale-a-view-up-or-down"><a href="#How-to-scale-a-view-up-or-down" class="headerlink" title="How to scale a view up or down"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-scale-a-view-up-or-down">How to scale a view up or down</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Up we go&quot;</span>)</span><br><span class="line">    .scaleEffect(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-round-the-corners-of-a-view"><a href="#How-to-round-the-corners-of-a-view" class="headerlink" title="How to round the corners of a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-round-the-corners-of-a-view">How to round the corners of a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Round Me&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.red)</span><br><span class="line">    .cornerRadius(<span class="number">25</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-adjust-the-opacity-of-a-view"><a href="#How-to-adjust-the-opacity-of-a-view" class="headerlink" title="How to adjust the opacity of a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-adjust-the-opacity-of-a-view">How to adjust the opacity of a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Now you see me&quot;</span>)</span><br><span class="line">    .padding()</span><br><span class="line">    .background(<span class="type">Color</span>.red)</span><br><span class="line">    .opacity(<span class="number">0.3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-adjust-the-accent-color-of-a-view"><a href="#How-to-adjust-the-accent-color-of-a-view" class="headerlink" title="How to adjust the accent color of a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-adjust-the-accent-color-of-a-view">How to adjust the accent color of a view</a></h3><p>iOS uses tint colors to give apps a coordinated theme, and the same functionality is available in SwiftUI under the name <em>accent colors</em>.</p>
<h3 id="How-to-mask-one-view-with-another"><a href="#How-to-mask-one-view-with-another" class="headerlink" title="How to mask one view with another"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-mask-one-view-with-another">How to mask one view with another</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(<span class="string">&quot;stripes&quot;</span>)</span><br><span class="line">    .resizable()</span><br><span class="line">    .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">    .mask(<span class="type">Text</span>(<span class="string">&quot;SWIFT!&quot;</span>)</span><br><span class="line">        .font(<span class="type">Font</span>.system(size: <span class="number">72</span>).weight(.black)))</span><br></pre></td></tr></table></figure>

<h3 id="How-to-blur-a-view"><a href="#How-to-blur-a-view" class="headerlink" title="How to blur a view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-blur-a-view">How to blur a view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Welcome to my SwiftUI app&quot;</span>)</span><br><span class="line">    .blur(radius: <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-blend-views-together"><a href="#How-to-blend-views-together" class="headerlink" title="How to blend views together"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-blend-views-together">How to blend views together</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ZStack</span> &#123;</span><br><span class="line">    <span class="type">Image</span>(<span class="string">&quot;paul-hudson&quot;</span>)</span><br><span class="line">    <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>)</span><br><span class="line">        .blendMode(.multiply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-adjust-views-by-tinting-and-desaturating-and-more"><a href="#How-to-adjust-views-by-tinting-and-desaturating-and-more" class="headerlink" title="How to adjust views by tinting, and desaturating, and more"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-adjust-views-by-tinting-and-desaturating-and-more">How to adjust views by tinting, and desaturating, and more</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(<span class="string">&quot;paul-hudson&quot;</span>)</span><br><span class="line">    .contrast(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h2><p><strong>Bring your views to life with movement</strong></p>
<h3 id="How-to-create-a-basic-animation"><a href="#How-to-create-a-basic-animation" class="headerlink" title="How to create a basic animation"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-basic-animation">How to create a basic animation</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> angle: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> borderThickness: <span class="type">Length</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.angle <span class="operator">+=</span> <span class="number">45</span></span><br><span class="line">            <span class="keyword">self</span>.borderThickness <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Tap here&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: borderThickness)</span><br><span class="line">                .rotationEffect(.degrees(angle))</span><br><span class="line">                .animation(.basic())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-a-spring-animation"><a href="#How-to-create-a-spring-animation" class="headerlink" title="How to create a spring animation"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-spring-animation">How to create a spring animation</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> angle: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.angle <span class="operator">+=</span> <span class="number">45</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Tap here&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                .rotationEffect(.degrees(angle))</span><br><span class="line">                .animation(.spring())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-an-explicit-animation"><a href="#How-to-create-an-explicit-animation" class="headerlink" title="How to create an explicit animation"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-an-explicit-animation">How to create an explicit animation</a></h3><p>Explicit animations are often helpful because they cause every affected view to animation, not just those that have implicit animations attached. For example, if view A has to make room for view B as part of the animation, but only view B has an animation attached, then view A will jump to its new position without animating unless you use explicit animations.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> opacity: <span class="type">Double</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            withAnimation &#123;</span><br><span class="line">                <span class="keyword">self</span>.opacity <span class="operator">-=</span> <span class="number">0.2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Tap here&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                .opacity(opacity)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-add-and-remove-views-with-a-transition"><a href="#How-to-add-and-remove-views-with-a-transition" class="headerlink" title="How to add and remove views with a transition"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-and-remove-views-with-a-transition">How to add and remove views with a transition</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showDetails <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                withAnimation &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetails.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Tap to show details&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetails &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Details go here.&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By default, SwiftUI uses a fade animation to insert or remove views, but you can change that if you want by attaching a <code>transition()</code> modifier to a view.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Details go here.&quot;</span>)</span><br><span class="line">    .transition(.move(edge: .bottom))</span><br></pre></td></tr></table></figure>

<h3 id="How-to-combine-transitions"><a href="#How-to-combine-transitions" class="headerlink" title="How to combine transitions"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-combine-transitions">How to combine transitions</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Details go here.&quot;</span>).transition(<span class="type">AnyTransition</span>.opacity.combined(with: .slide))</span><br></pre></td></tr></table></figure>

<p>或者使用拓展来封装常用的过渡效果</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndScale: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="type">AnyTransition</span>.move(edge: .bottom).combined(with: .scale())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="type">Text</span>(<span class="string">&quot;Details go here.&quot;</span>).transition(.moveAndScale)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-asymmetric-transitions"><a href="#How-to-create-asymmetric-transitions" class="headerlink" title="How to create asymmetric transitions"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-asymmetric-transitions">How to create asymmetric transitions</a></h3><p>SwiftUI lets us specify one transition when adding a view and another when removing it, all done using the <code>asymmetric()</code> transition type.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Details go here.&quot;</span>).transition(.asymmetric(insertion: .move(edge: .leading), removal: .move(edge: .bottom)))</span><br></pre></td></tr></table></figure>

<h2 id="Composing-views"><a href="#Composing-views" class="headerlink" title="Composing views"></a>Composing views</h2><p><strong>Make your UI structure easier to understand</strong></p>
<h3 id="How-to-create-and-compose-custom-views"><a href="#How-to-create-and-compose-custom-views" class="headerlink" title="How to create and compose custom views"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-and-compose-custom-views">How to create and compose custom views</a></h3><p>都是基于数据驱动UI，所以每一级封装都是传Model：<code>User</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> jobTitle: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> emailAddress: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> profilePicture: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfilePicture</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(imageName)</span><br><span class="line">            .resizable()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmailAddress</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> address: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;envelope&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(address)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UserDetails</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> user: <span class="type">User</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(user.name)</span><br><span class="line">                .font(.largeTitle)</span><br><span class="line">                .foregroundColor(.primary)</span><br><span class="line">            <span class="type">Text</span>(user.jobTitle)</span><br><span class="line">                .foregroundColor(.secondary)</span><br><span class="line">            <span class="type">EmailAddress</span>(address: user.emailAddress)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UserView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> user: <span class="type">User</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ProfilePicture</span>(imageName: user.profilePicture)</span><br><span class="line">            <span class="type">UserDetails</span>(user: user)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> user <span class="operator">=</span> <span class="type">User</span>(name: <span class="string">&quot;Paul Hudson&quot;</span>, jobTitle: <span class="string">&quot;Editor, Hacking with Swift&quot;</span>, emailAddress: <span class="string">&quot;paul@hackingwithswift.com&quot;</span>, profilePicture: <span class="string">&quot;paul-hudson&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">UserView</span>(user: user)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-combine-text-views-together"><a href="#How-to-combine-text-views-together" class="headerlink" title="How to combine text views together"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-combine-text-views-together">How to combine text views together</a></h3><p>这样子拼接文本很方便</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;SwiftUI &quot;</span>)</span><br><span class="line">        .font(.largeTitle)</span><br><span class="line">    <span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;is &quot;</span>)</span><br><span class="line">        .font(.headline)</span><br><span class="line">    <span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;awesome&quot;</span>)</span><br><span class="line">        .font(.footnote)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是有个修改器不适合拼接如：<code>foregroundColor</code></p>
<p>这时候就需要换成能够使用<code>+</code>的修改器，如<code>color</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;SwiftUI &quot;</span>)</span><br><span class="line">    .color(.red)</span><br><span class="line"><span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;is &quot;</span>)</span><br><span class="line">    .color(.orange)</span><br><span class="line"><span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;awesome&quot;</span>)</span><br><span class="line">    .color(.blue)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-store-views-as-properties"><a href="#How-to-store-views-as-properties" class="headerlink" title="How to store views as properties"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-store-views-as-properties">How to store views as properties</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> title <span class="operator">=</span> <span class="type">Text</span>(<span class="string">&quot;Paul Hudson&quot;</span>)</span><br><span class="line">        .font(.largeTitle)</span><br><span class="line">    <span class="keyword">let</span> subtitle <span class="operator">=</span> <span class="type">Text</span>(<span class="string">&quot;Author&quot;</span>)</span><br><span class="line">        .foregroundColor(.secondary)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            title</span><br><span class="line">            .color(.red)</span><br><span class="line">            subtitle</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-create-custom-modifiers"><a href="#How-to-create-custom-modifiers" class="headerlink" title="How to create custom modifiers"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-custom-modifiers">How to create custom modifiers</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PrimaryLabel</span>: <span class="title class_">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content</span><br><span class="line">            .padding()</span><br><span class="line">            .background(<span class="type">Color</span>.red)</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">            .font(.largeTitle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello, SwiftUI&quot;</span>)</span><br><span class="line">            .modifier(<span class="type">PrimaryLabel</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Tooling"><a href="#Tooling" class="headerlink" title="Tooling"></a>Tooling</h2><p><strong>Build better apps with help from Xcode</strong></p>
<h3 id="How-to-preview-your-layout-at-different-Dynamic-Type-sizes"><a href="#How-to-preview-your-layout-at-different-Dynamic-Type-sizes" class="headerlink" title="How to preview your layout at different Dynamic Type sizes"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-preview-your-layout-at-different-dynamic-type-sizes">How to preview your layout at different Dynamic Type sizes</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span> : <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">Group</span> &#123;</span><br><span class="line">         <span class="type">ContentView</span>()</span><br><span class="line">            .environment(\.colorScheme, .dark)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>

<h3 id="How-to-preview-your-layout-in-light-and-dark-mode"><a href="#How-to-preview-your-layout-in-light-and-dark-mode" class="headerlink" title="How to preview your layout in light and dark mode"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-preview-your-layout-in-light-and-dark-mode">How to preview your layout in light and dark mode</a></h3><p>If you want to see both light and dark mode side by side, place multiple previews in a group, like this:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span> : <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">Group</span> &#123;</span><br><span class="line">         <span class="type">ContentView</span>()</span><br><span class="line">            .environment(\.colorScheme, .light)</span><br><span class="line"></span><br><span class="line">         <span class="type">ContentView</span>()</span><br><span class="line">            .environment(\.colorScheme, .dark)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>

<h3 id="How-to-preview-your-layout-in-different-devices"><a href="#How-to-preview-your-layout-in-different-devices" class="headerlink" title="How to preview your layout in different devices"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-preview-your-layout-in-different-devices">How to preview your layout in different devices</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ContentView</span>()</span><br><span class="line">    .previewDevice(<span class="type">PreviewDevice</span>(rawValue: <span class="string">&quot;iPhone SE&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="How-to-preview-your-layout-in-a-navigation-view"><a href="#How-to-preview-your-layout-in-a-navigation-view" class="headerlink" title="How to preview your layout in a navigation view"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-preview-your-layout-in-a-navigation-view">How to preview your layout in a navigation view</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">         .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Welcome&quot;</span>))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span> : <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">NavigationView</span> &#123;</span><br><span class="line">         <span class="type">ContentView</span>()</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>

<h3 id="How-to-use-Instruments-to-profile-your-SwiftUI-code-and-identify-slow-layouts"><a href="#How-to-use-Instruments-to-profile-your-SwiftUI-code-and-identify-slow-layouts" class="headerlink" title="How to use Instruments to profile your SwiftUI code and identify slow layouts"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts">How to use Instruments to profile your SwiftUI code and identify slow layouts</a></h3><p>示例代码</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FrequentUpdater</span>: <span class="title class_">BindableObject</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> didChange <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   <span class="keyword">var</span> timer: <span class="type">Timer</span>?</span><br><span class="line"></span><br><span class="line">   <span class="keyword">init</span>() &#123;</span><br><span class="line">      timer <span class="operator">=</span> <span class="type">Timer</span>.scheduledTimer(</span><br><span class="line">         withTimeInterval: <span class="number">0.01</span>,</span><br><span class="line">         repeats: <span class="literal">true</span></span><br><span class="line">      ) &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">         <span class="keyword">self</span>.didChange.send(())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">   <span class="meta">@ObjectBinding</span> <span class="keyword">var</span> updater <span class="operator">=</span> <span class="type">FrequentUpdater</span>()</span><br><span class="line">   <span class="meta">@State</span> <span class="keyword">var</span> tapCount <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">         <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(UUID().uuidString)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">         <span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.tapCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">         &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Tap count: <span class="subst">\(tapCount)</span>&quot;</span>)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="检测我们的代码"><a href="#检测我们的代码" class="headerlink" title="检测我们的代码"></a>检测我们的代码</h4><p>默认情况下，SwiftUI工具告诉我们各种各样的事情：</p>
<p>1.在此期间创建了多少视图以及创建它们需要多长时间（“View Body”）<br>2.视图的属性是什么以及它们如何随时间变化（“View Properties”）<br>3.发生了多少次Core Animation提交（“Core Animation Commits”）<br>4.每个函数调用的确切时间（“Time Profiler”）</p>
<p><img src="https://www.hackingwithswift.com/img/quick-start/swiftui/profiling-1.jpg"></p>
<h4 id="监视body调用"><a href="#监视body调用" class="headerlink" title="监视body调用"></a>监视<code>body</code>调用</h4><p>如果您选择<code>View Body</code>轨道 - 这是instrument列表中的第一行 - 您应该能够看到乐器将结果分解为SwiftUI和您的项目，前者是原始类型，如文本视图和按钮，以及后者包含您的自定义视图类型。在我们的例子中，这意味着“ContentView”应该出现在自定义视图中，因为这是我们视图的名称。</p>
<p>现在，您在这里看不到的是您的代码与SwiftUI视图的完美一对一映射，因为SwiftUI积极地折叠其视图层次结构以尽可能少地完成工作。所以，不要指望在代码中看到任何VStack创建 - 这个应用程序实际上是免费的。</p>
<p>在这个屏幕上，重要的数字是计数和平均持续时间 - 每件事创建的次数，以及花费的时间。因为这是一个压力测试你应该看到非常高的数字，但我们的布局是微不足道的，所以平均持续时间可能是几十微秒。</p>
<p><img src="https://www.hackingwithswift.com/img/quick-start/swiftui/profiling-2.jpg" alt="img"></p>
<h4 id="跟踪状态（state）变化"><a href="#跟踪状态（state）变化" class="headerlink" title="跟踪状态（state）变化"></a>跟踪状态（state）变化</h4><p>接下来，选择“View Properties”轨道，这是仪器列表中的第二行。这将显示所有视图的所有属性，包括其当前值和所有先前值。</p>
<p>我们的示例应用程序有一个按钮，通过在数字中添加一个来更改其标签，并且在此工具中可见 - 请查看视图类型ContentView和属性类型<code>State </code>。</p>
<p>可悲的是，Instruments还没有（还能）向我们展示那里的确切属性名称，如果你跟踪了几个整数状态，这可能会更加令人困惑。然而，它确实有一个不同的技巧：在记录窗口的顶部是一个标记当前视图位置的箭头，如果你拖动它，你会看到应用程序状态随时间的变化 - 每次你点击按钮，你会看到状态整数上升一个，你可以前进和后退来看它发生。</p>
<p>这可以释放巨大的能力，因为它可以让我们直接看到状态变化导致慢速重绘或其他工作 - 这几乎就像是在时间机器中，您可以在运行期间的每个点检查应用程序的确切状态。</p>
<p><img src="https://www.hackingwithswift.com/img/quick-start/swiftui/profiling-3.jpg" alt="img"></p>
<h4 id="识别慢速绘图"><a href="#识别慢速绘图" class="headerlink" title="识别慢速绘图"></a>识别慢速绘图</h4><p>虽然SwiftUI能够直接调用Metal以提高性能，但大多数情况下它更喜欢使用Core Animation进行渲染。这意味着我们会自动从Instruments获取内置的Core Animation分析工具，包括检测昂贵提交（expensive commits）的能力。</p>
<p>当多个更改放在一个组中时，Core Animation的效果最佳，称为<code>transaction</code>。我们在一个事务中有效地堆叠了一系列工作，然后要求CA继续渲染工作 - 称为<em>提交</em>事务。</p>
<p>因此，当Instruments向我们展示昂贵的Core Animation提交时，它真正向我们展示的是SwiftUI因为更新而被迫重绘屏幕上的像素的次数。理论上，这应该只在我们的应用程序的实际状态导致不同的视图层次结构时发生，因为SwiftUI应该能够将我们的<code>body</code>属性的新输出与先前的输出进行比较。</p>
<p><img src="https://www.hackingwithswift.com/img/quick-start/swiftui/profiling-4.jpg" alt="img"></p>
<h4 id="寻找缓慢的函数调用"><a href="#寻找缓慢的函数调用" class="headerlink" title="寻找缓慢的函数调用"></a>寻找缓慢的函数调用</h4><p>Time Profiler，它向我们展示了在代码的每个部分花费了多少时间。这与乐器中的常规时间分析器完全相同，但如果您之前没有尝试过，那么您至少需要知道：</p>
<ol>
<li><p>右侧的扩展详细信息窗口默认显示最重的堆栈跟踪，这是运行时间最长的代码段。明亮的代码（白色或黑色，取决于您的macOS配色方案）是您编写的代码;昏暗代码（灰色）是系统库代码。</p>
</li>
<li><p>在左侧，您可以看到创建的所有线程，以及公开指示器，让您深入了解它们调用的函数以及这些函数调用的函数等。大多数工作将在“start”内部进行。</p>
</li>
<li><p>为避免混乱，您可能需要单击底部的“调用树”按钮，然后选择“隐藏系统库”。这只会显示您编写的代码，但是如果您的问题是您使用的系统库很糟糕，这可能没有帮助。</p>
</li>
<li><p>要直接了解具体细节，您还可以单击“调用树”并选择“反转调用树”以翻转事物，以便叶子功能（树末端的功能）显示在顶部，现在可以向下钻取公开指示器（向上钻取？）到调用它们的函数。</p>
<p><img src="https://www.hackingwithswift.com/img/quick-start/swiftui/profiling-5.jpg"></p>
</li>
</ol>
<h4 id="最后一些提示"><a href="#最后一些提示" class="headerlink" title="最后一些提示"></a>最后一些提示</h4><p>在您收取配置自己的代码之前，有一些事情需要注意：</p>
<ol>
<li>在检查应用程序性能的一小部分时，您应该单击并拖动相关范围，以便仅查看该应用程序部分的统计信息。这使您可以专注于特定操作的性能，例如响应按下按钮。</li>
<li>即使你在仪器中看到纯色条，它们只是从远处看起来那样 - 你可以通过按住Cmd并按 - 和+来查看更多细节</li>
<li>要获得最准确的数字，请始终在真实设备上进行配置。</li>
<li>如果要通过分析代码进行更改，请始终一次进行一次更改。如果你进行两次更改，可能会使你的性能提高20％而另一种会降低10％，但是将它们合在一起意味着你可能会认为它们整体性能提高了10％。</li>
<li>Instruments在release模式下运行您的代码，从而实现Swift的所有优化。这也会影响您添加到代码中的任何调试标志，因此请小心。</li>
</ol>
<h2 id="What-now"><a href="#What-now" class="headerlink" title="What now?"></a>What now?</h2><p><strong>How to continue learning SwiftUI after the basics</strong></p>
<h3 id="SwiftUI-tips-and-tricks"><a href="#SwiftUI-tips-and-tricks" class="headerlink" title="SwiftUI tips and tricks"></a><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/swiftui/swiftui-tips-and-tricks">SwiftUI tips and tricks</a></h3><p>SwiftUI拥有强大的标题功能，但也有许多较小的提示和技巧可以帮助您编写更好的应用程序。</p>
<h4 id="State-设为私有"><a href="#State-设为私有" class="headerlink" title="@State 设为私有"></a>@State 设为私有</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> score <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="具有常量绑定的原型"><a href="#具有常量绑定的原型" class="headerlink" title="具有常量绑定的原型"></a>具有常量绑定的原型</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TextField</span>(.constant(<span class="string">&quot;Hello&quot;</span>))</span><br><span class="line">    .textFieldStyle(.roundedBorder)</span><br></pre></td></tr></table></figure>

<h4 id="使用语义颜色"><a href="#使用语义颜色" class="headerlink" title="使用语义颜色"></a>使用语义颜色</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Color</span>.red</span><br></pre></td></tr></table></figure>

<h4 id="依靠自适应填充"><a href="#依靠自适应填充" class="headerlink" title="依靠自适应填充"></a>依靠自适应填充</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Row 1&quot;</span>)</span><br><span class="line">    .padding(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h4 id="合并文本视图"><a href="#合并文本视图" class="headerlink" title="合并文本视图"></a>合并文本视图</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Colored &quot;</span>)</span><br><span class="line">            .color(.red)</span><br><span class="line">        <span class="operator">+</span></span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;SwifUI &quot;</span>)</span><br><span class="line">                .color(.green)</span><br><span class="line">        <span class="operator">+</span></span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Text&quot;</span>)</span><br><span class="line">            .color(.blue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="如何使print-工作"><a href="#如何使print-工作" class="headerlink" title="如何使print()工作"></a>如何使<code>print()</code>工作</h4><p>右键单击预览画布（preview canvas）中的播放按钮，然后选择“调试预览（Debug Preview）”。</p>
<h4 id="依靠隐式HStack"><a href="#依靠隐式HStack" class="headerlink" title="依靠隐式HStack"></a>依靠隐式<code>HStack</code></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> imageNames <span class="operator">=</span> [<span class="string">&quot;paul-hudson&quot;</span>, <span class="string">&quot;swiftui&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(imageNames.identified(by: \.<span class="keyword">self</span>)) &#123; image <span class="keyword">in</span></span><br><span class="line">            <span class="type">Image</span>(image).resizable().frame(width: <span class="number">40</span>)</span><br><span class="line">            <span class="type">Text</span>(image)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="分割大视图"><a href="#分割大视图" class="headerlink" title="分割大视图"></a>分割大视图</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> users <span class="operator">=</span> [<span class="string">&quot;Paul Hudson&quot;</span>, <span class="string">&quot;Taylor Swift&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(users.identified(by: \.<span class="keyword">self</span>)) &#123; user <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationButton</span>(destination: <span class="type">Text</span>(<span class="string">&quot;Detail View&quot;</span>)) &#123;</span><br><span class="line">                    <span class="type">Image</span>(<span class="string">&quot;example-image&quot;</span>).resizable().frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;Johnny Appleseed&quot;</span>).font(.headline)</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;Occupation: Programmer&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;.navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Users&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更好的预览"><a href="#更好的预览" class="headerlink" title="更好的预览"></a>更好的预览</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span> : <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">                .environment(\.sizeCategory, .accessibilityExtraExtraExtraLarge)</span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">                .environment(\.colorScheme, .dark)</span><br><span class="line">            <span class="type">NavigationView</span> &#123;</span><br><span class="line">                <span class="type">ContentView</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>

<h4 id="创建自定义修改器"><a href="#创建自定义修改器" class="headerlink" title="创建自定义修改器"></a>创建自定义修改器</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PrimaryLabel</span>: <span class="title class_">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content</span><br><span class="line">            .padding()</span><br><span class="line">            .background(<span class="type">Color</span>.black)</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">            .font(.largeTitle)</span><br><span class="line">            .cornerRadius(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">            .modifier(<span class="type">PrimaryLabel</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="动画变化很容易"><a href="#动画变化很容易" class="headerlink" title="动画变化很容易"></a>动画变化很容易</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingWelcome <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$showingWelcome</span>.animation(.spring())) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Toggle label&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showingWelcome &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/17/Hackintosh-Installation-with-MSI-Z390-and-i9-9900K/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/17/Hackintosh-Installation-with-MSI-Z390-and-i9-9900K/" class="post-title-link" itemprop="url">黑苹果安装记录 MSI Z390 和 i9-9900K</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-03-17 23:12:36" itemprop="dateCreated datePublished" datetime="2019-03-17T23:12:36+08:00">2019-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>微星 MSI Z390 GAMING PRO CARBON AC 华硕 Vega64 黑苹果</p>
<h2 id="机器配置"><a href="#机器配置" class="headerlink" title="机器配置"></a>机器配置</h2><p>主板：<a target="_blank" rel="noopener" href="https://www.msi.com/Motherboard/MPG-Z390-GAMING-PRO-CARBON-AC">微星 MSI MPG Z390 GAMING PRO CARBON AC</a></p>
<p>CPU：<a target="_blank" rel="noopener" href="https://ark.intel.com/content/www/us/en/ark/products/186605/intel-core-i9-9900k-processor-16m-cache-up-to-5-00-ghz.html">Intel i9 9900K</a></p>
<p>内存：Avexir DDR4 2400</p>
<p>显卡：<a target="_blank" rel="noopener" href="https://www.asus.com/us/Graphics-Cards/AREZ-STRIX-RXVEGA64-O8G-GAMING/">华硕 ASUS AREZ-STRIX-RXVEGA64-O8G-GAMING</a></p>
<p>电源：<a target="_blank" rel="noopener" href="https://www.evga.com/products/product.aspx?pn=120-GP-0750-X1">EVGA SuperNOVA 750 G+</a></p>
<p>散热：<a target="_blank" rel="noopener" href="http://www.coolermaster.com/cooling/cpu-liquid-cooler/masterliquid-ml240r-rgb/">MASTERLIQUID ML240R RGB</a></p>
<p>固态：三星 970 EVO 500G</p>
<p>板载声卡：ALC S1220A</p>
<p>板载有线网卡：Intel I219V7</p>
<p>显示器：戴尔 P2715Q 4K显示器</p>
<p>机箱：<a target="_blank" rel="noopener" href="http://www.phanteks.com/Enthoo-Evolv-ATX-TemperedGlass.html">追风者 PK-515ETG</a></p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p><strong>重要提示：已降 BIOS 至 <a target="_blank" rel="noopener" href="https://www.msi.com/Motherboard/support/MPG-Z390-GAMING-PRO-CARBON-AC">Version 7B17v10</a>，不在卡 no nvram variable。</strong></p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.daliansky.net/macOS-Mojave-10.14.3-18D42-official-version-with-Clover-4859-original-image.html">【黑果小兵】<strong>macOS Mojave 10.14.3 18D42</strong> 正式版 <strong>with Clover 4859</strong>原版镜像</a></li>
<li>执行：<strong>300</strong>系列主板请于<strong>drivers64UEFI</strong>目录中移除<strong>AptioMemoryFix-64.efi</strong>添加<strong>OsxAptioFix2Drv-free2000.efi</strong>该驱动位于**&#x2F;EFI&#x2F;CLOVER&#x2F;drivers-off<strong>目录下。顺利进入</strong>macOS**安装界面</li>
<li>系统后序安装和复制 <strong>EFI</strong> 到硬盘教程：<a target="_blank" rel="noopener" href="https://blog.daliansky.net/Lenovo-Xiaoxin-Air-13-macOS-Mojave-installation-tutorial.html">联想小新<strong>Air 13</strong>安装黑苹果兼<strong>macOS Mojave</strong>安装教程</a></li>
<li>进入系统设置页面前：卡在 <strong>AppleUSBHostResources panic</strong>。解决方案是<strong>boot</strong> 添加 <strong>safe mode</strong></li>
<li>合并 <strong>Windows</strong> 和 <strong>Clover</strong> 引导</li>
<li>完善驱动</li>
<li>结束</li>
</ol>
<h2 id="附图"><a href="#附图" class="headerlink" title="附图"></a>附图</h2><h2 id="Hackintosh-i9-2019-03-15-https-gewill-org-assets-Hackintosh-i9-2019-03-15-png-总结"><a href="#Hackintosh-i9-2019-03-15-https-gewill-org-assets-Hackintosh-i9-2019-03-15-png-总结" class="headerlink" title="![Hackintosh-i9 2019-03-15](https://gewill.org/assets/Hackintosh-i9 2019-03-15.png)总结"></a>![Hackintosh-i9 2019-03-15](<a target="_blank" rel="noopener" href="https://gewill.org/assets/Hackintosh-i9">https://gewill.org/assets/Hackintosh-i9</a> 2019-03-15.png)总结</h2><ol>
<li>小兵教程很好用。</li>
<li>就是一直卡在 BIOS 部分，所以无论做什么努力的都没有效果。所以购买主板一定要看 tonymacx86.com 的 <a target="_blank" rel="noopener" href="https://www.tonymacx86.com/buyersguide/building-a-customac-hackintosh-the-ultimate-buyers-guide/">Buyer’s Guide</a> 和网友的成功贴。我只之前微星 Z170A M3 安装黑苹果成功，就想当然的买了微星的这块主板。活生生的因为 BIOS 问题，至少1个月的安装时间浪费了。</li>
<li>买主板别买带无解的无线网卡，明明可以省200块，去买同系列的微星 MPG Z390 GAMING PRO CARBON。然后去买免驱的无线蓝牙网卡：Broadcom 94360CD。</li>
</ol>
<h2 id="EFI"><a href="#EFI" class="headerlink" title="EFI"></a>EFI</h2><p>EFI已上传 <a target="_blank" rel="noopener" href="https://github.com/gewill/Hackintosh-Installation-with-MSI-Z390-and-i9-9900K">https://github.com/gewill/Hackintosh-Installation-with-MSI-Z390-and-i9-9900K</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/10/25/Add-sh-in-fastlane-to-slim-HyphenateSDK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/10/25/Add-sh-in-fastlane-to-slim-HyphenateSDK/" class="post-title-link" itemprop="url">fastlane添加sh来给环信SDK瘦身</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-10-25 14:32:32" itemprop="dateCreated datePublished" datetime="2018-10-25T14:32:32+08:00">2018-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h2><p>由于环信将 i386 x86_64 armv7 arm64 几个平台都合并到了一起，所以使用动态库上传appstore时需要将i386 x86_64两个平台删除后，才能正常提交审核。</p>
<p>所以我们使用 fastlane sh 在打包<code>gym</code> 时前后分别将 x86 的移除<code>remove86framework</code>和添加<code>add86framework</code> 。这样就可以继续使用 fastlane 一键打包。</p>
<blockquote>
<p>如果出错，使用 pod 删除并重新安装完整版的环信 SDK。</p>
</blockquote>
<h2 id="Fastfile"><a href="#Fastfile" class="headerlink" title="Fastfile"></a>Fastfile</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">desc <span class="string">&quot;Deploy a new version to the App Store&quot;</span></span><br><span class="line">  lane <span class="symbol">:release</span> <span class="keyword">do</span></span><br><span class="line">    remove86framework</span><br><span class="line">    gym</span><br><span class="line">    add86framework  </span><br><span class="line">    deliver(<span class="symbol">force:</span> <span class="literal">true</span>)</span><br><span class="line">    <span class="comment"># frameit</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">desc <span class="string">&quot;Remove x86 framework&quot;</span></span><br><span class="line">  lane <span class="symbol">:remove86framework</span> <span class="keyword">do</span></span><br><span class="line">    sh(<span class="string">%(</span></span><br><span class="line"><span class="string">      cd ../Pods/HyphenateLite/iOS_Pods_IMSDK*</span></span><br><span class="line"><span class="string">      pwd</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      if [ ! -d &quot;./bak&quot; ]; then  </span></span><br><span class="line"><span class="string">        mkdir ./bak</span></span><br><span class="line"><span class="string">      fi</span></span><br><span class="line"><span class="string">      if [ -d &quot;./bak/HyphenateLite.framework&quot; ]; then  </span></span><br><span class="line"><span class="string">        rm -rf ./bak/HyphenateLite.framework</span></span><br><span class="line"><span class="string">      fi</span></span><br><span class="line"><span class="string">      cp -r HyphenateLite.framework ./bak</span></span><br><span class="line"><span class="string">      lipo HyphenateLite.framework/HyphenateLite -thin armv7 -output HyphenateLite_armv7</span></span><br><span class="line"><span class="string">      lipo HyphenateLite.framework/HyphenateLite -thin arm64 -output HyphenateLite_arm64</span></span><br><span class="line"><span class="string">      lipo -create HyphenateLite_armv7 HyphenateLite_arm64 -output HyphenateLite</span></span><br><span class="line"><span class="string">      mv HyphenateLite HyphenateLite.framework/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    )</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  desc <span class="string">&quot;Add x86 framework back&quot;</span></span><br><span class="line">  lane <span class="symbol">:add86framework</span> <span class="keyword">do</span></span><br><span class="line">    sh(<span class="string">%(</span></span><br><span class="line"><span class="string">      cd ../Pods/HyphenateLite/iOS_Pods_IMSDK*</span></span><br><span class="line"><span class="string">      pwd</span></span><br><span class="line"><span class="string">      if [ -d &quot;./HyphenateLite.framework&quot; ]; then  </span></span><br><span class="line"><span class="string">        rm -rf ./HyphenateLite.framework</span></span><br><span class="line"><span class="string">      fi</span></span><br><span class="line"><span class="string">      cp -r ./bak/HyphenateLite.framework HyphenateLite.framework</span></span><br><span class="line"><span class="string">    )</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol>
<li>环信：<a target="_blank" rel="noopener" href="http://docs.easemob.com/im/300iosclientintegration/20iossdkimport#%E9%9B%86%E6%88%90%E5%8A%A8%E6%80%81%E5%BA%93%E4%B8%8A%E4%BC%A0appstore">http://docs.easemob.com/im/300iosclientintegration/20iossdkimport#%E9%9B%86%E6%88%90%E5%8A%A8%E6%80%81%E5%BA%93%E4%B8%8A%E4%BC%A0appstore</a> </li>
<li>fastlane sh 文档：<a target="_blank" rel="noopener" href="https://docs.fastlane.tools/actions/sh/">https://docs.fastlane.tools/actions/sh/</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/08/01/RxSwift-%E2%85%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/08/01/RxSwift-%E2%85%A3/" class="post-title-link" itemprop="url">RxSwift Ⅳ：RxSwift 和 RxCocoa 进阶</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-08-01 22:02:03" itemprop="dateCreated datePublished" datetime="2018-08-01T22:02:03+08:00">2018-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一旦你开始编写完整的应用程序与 RxSwift 和 RxCocoa, 你也需要照顾更多的中间主题比简单地观察事件和处理他们与 Rx。</p>
<p>在一个完整的生产质量应用程序中, 您需要构建一个错误处理策略, 执行更高级的多线程处理, 创建一个坚实的测试套件等等。</p>
<p>在这部分, 你将通过学习四个挑战性的章节, 这将解除您的 Rx 从一个菜鸟级的状态到一个实战经验的战士。</p>
<h2 id="第十四章：错误处理实践"><a href="#第十四章：错误处理实践" class="headerlink" title="第十四章：错误处理实践"></a>第十四章：错误处理实践</h2><p>生活将是美好的, 如果我们生活在一个完美的世界, 但不幸的事情往往不像预期的那样去。即使是最好的 RxSwift 开发人员也不能避免遇到错误, 因此他们需要知道如何优雅和高效地处理它们。在本章中, 您将学习如何处理错误, 如何通过重试来管理错误恢复, 或者只是向整个宇宙投降, 让错误继续。</p>
<h3 id="管理错误"><a href="#管理错误" class="headerlink" title="管理错误"></a>管理错误</h3><p>常见错误类型：网络连接失败、无效的输入和API错误或者HTTP错误。</p>
<p>在 RxSwift 中, 错误处理是框架的一部分, 可以通过两种方式进行处理:    </p>
<ul>
<li><strong>Catch</strong>: 从错误中恢复并使用默认值。   </li>
<li><strong>Retry</strong>: 重试有限 (或无限制) 次数。</li>
</ul>
<p>本章项目的起始版本没有任何实际的错误处理。所有错误都是用一个返回虚拟版本的 <code>catchErrorJustReturn</code> 捕获的。这听起来像是一个方便的解决方案, 但是在 RxSwift 中有更好的处理方法。在任何一流的应用程序中, 都应该有一个一致的、信息错误处理方法。</p>
<h4 id="抛出错误"><a href="#抛出错误" class="headerlink" title="抛出错误"></a>抛出错误</h4><p>一个好的起点是处理 RxCocoa 错误，它包装底层 Apple 框架返回的系统错误。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">data</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">Data</span>&gt; &#123;<span class="operator">...</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">200</span> <span class="operator">..&lt;</span> <span class="number">300</span> <span class="operator">~=</span> response.statusCode &#123; </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="type">RxCocoaURLError</span>.httpRequestFailed(response: response, data: data) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用-catch-处理错误"><a href="#用-catch-处理错误" class="headerlink" title="用 catch 处理错误"></a>用 catch 处理错误</h3><p>在解释如何抛出错误之后, 是时候看看如何处理错误了。最基本的方法是使用 catch。catch 的工作方式很像在Swift 中的 <code>do-try-catch</code> 流程。执行可观察的操作, 如果出现错误, 则返回包装错误的事件。</p>
<p>在 RxSwift 中有两个主要的运算符来捕获错误。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">catchError</span>(<span class="keyword">_</span> <span class="params">handler</span>:) -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="keyword">Self</span>.<span class="type">E</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">catchErrorJustReturn</span>(<span class="keyword">_</span> <span class="params">element</span>:) -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="keyword">Self</span>.<span class="type">E</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="一个常见的陷阱"><a href="#一个常见的陷阱" class="headerlink" title="一个常见的陷阱"></a>一个常见的陷阱</h4><p>链式调用时候，一个错误就会导致整个订阅以错误结束。有的时候我们想知道错误的仅有一步细节，如 HTTP 404 错误，属于 API 返回错误的具体信息的约定，就需要移除 <code>.catchErrorJustReturn(ApiController.Weather.empty)</code> 来避免出现不期望的错误事件发射。</p>
<h3 id="捕捉错误"><a href="#捕捉错误" class="headerlink" title="捕捉错误"></a>捕捉错误</h3><p>我们先定义一个属性来缓存天气数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cache <span class="operator">=</span> [<span class="type">String</span>: <span class="type">Weather</span>]()</span><br></pre></td></tr></table></figure>

<p>再把输入框的序列改为：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> textSearch <span class="operator">=</span> searchInput.flatMap &#123; text <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> <span class="type">ApiController</span>.shared.currentWeather(city: text <span class="operator">??</span> <span class="string">&quot;Error&quot;</span>)</span><br><span class="line">    .do(onNext: &#123; data <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> text <span class="operator">=</span> text &#123;</span><br><span class="line">        <span class="keyword">self</span>.cache[text] <span class="operator">=</span> data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, onError: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] e <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf <span class="operator">=</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        strongSelf.showError(error: e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .retryWhen(retryHandler)</span><br><span class="line">    .catchError &#123; error <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> text <span class="operator">=</span> text, <span class="keyword">let</span> cachedData <span class="operator">=</span> <span class="keyword">self</span>.cache[text] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.just(cachedData)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.just(<span class="type">ApiController</span>.<span class="type">Weather</span>.empty)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="错误的重试机制"><a href="#错误的重试机制" class="headerlink" title="错误的重试机制"></a>错误的重试机制</h3><p>关于重试上面已经设计到了 <code>.retryWhen(retryHandler)</code>，具体处理实现如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> retryHandler: (<span class="type">Observable</span>&lt;<span class="type">Error</span>&gt;) -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> &#123; e <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> e.enumerated().flatMap &#123; (attempt, error) -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> attempt <span class="operator">&gt;=</span> maxAttempts <span class="operator">-</span> <span class="number">1</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Observable</span>.error(error)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> casted <span class="operator">=</span> error <span class="keyword">as?</span> <span class="type">ApiController</span>.<span class="type">ApiError</span>, casted <span class="operator">==</span> .invalidKey &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">ApiController</span>.shared.apiKey.filter &#123;<span class="variable">$0</span> <span class="operator">!=</span> <span class="string">&quot;&quot;</span>&#125;.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;== retrying after <span class="subst">\(attempt <span class="operator">+</span> <span class="number">1</span>)</span> seconds ==&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.timer(<span class="type">Double</span>(attempt <span class="operator">+</span> <span class="number">1</span>), scheduler: 				<span class="type">MainScheduler</span>.instance).take(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者简化版：<code>.retry(3)</code></p>
<h3 id="自定义错误"><a href="#自定义错误" class="headerlink" title="自定义错误"></a>自定义错误</h3><p>创建自定义错误遵循一般的 Swift 原则, 所以没有一个好的 Swift 程序员不会知道, 但它仍然是好的, 看看如何处理错误和创建定制的操作符。</p>
<h4 id="创建自定义错误"><a href="#创建自定义错误" class="headerlink" title="创建自定义错误"></a>创建自定义错误</h4><p>先定义错误枚举，然后在结果过滤中抛出定义的错误即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ApiError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> cityNotFound</span><br><span class="line">  <span class="keyword">case</span> serverFailure</span><br><span class="line">  <span class="keyword">case</span> invalidKey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> session.rx.response(request: request).map() &#123; response, data <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">if</span> <span class="number">200</span> <span class="operator">..&lt;</span> <span class="number">300</span> <span class="operator">~=</span> response.statusCode &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">JSON</span>(data: data)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> response.statusCode <span class="operator">==</span> <span class="number">401</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">ApiError</span>.invalidKey</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">400</span> <span class="operator">..&lt;</span> <span class="number">500</span> <span class="operator">~=</span> response.statusCode &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">ApiError</span>.cityNotFound</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">ApiError</span>.serverFailure</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>订阅者可以根据实际场景把错误展示给用户，这部分和 Swift 中自定义错误一致，就不展开讲了。</p>
<h3 id="错误处理进阶"><a href="#错误处理进阶" class="headerlink" title="错误处理进阶"></a>错误处理进阶</h3><p>比如处理API 中 401 类型，需要提示用户授权失败，需要重新登录或授权。本例中需要是指API Key 失效，需要用户填写新的有效的API Key。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> response.statusCode <span class="operator">==</span> <span class="number">401</span> &#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="type">ApiError</span>.invalidKey</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="Materialize-和-dematerialize"><a href="#Materialize-和-dematerialize" class="headerlink" title="Materialize 和 dematerialize"></a>Materialize 和 dematerialize</h4><p>materialize 和 dematerialize 通常一起使用, 并且有能力完全打破原始可观察的合同。当没有其他选择来处理特定的情况时, 请小心地使用它们, 并且只有在必要的时候。</p>
<p>常见的应用是：进行日志记录</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">observableToLog.materialize()</span><br><span class="line">	.do(onNext: &#123; (event) <span class="keyword">in</span> </span><br><span class="line">		myAdvancedLogEvent(event) </span><br><span class="line">     &#125;)</span><br><span class="line">	.dematerialize()</span><br></pre></td></tr></table></figure>

<h2 id="第十五章：介绍调度程序"><a href="#第十五章：介绍调度程序" class="headerlink" title="第十五章：介绍调度程序"></a>第十五章：介绍调度程序</h2><p>到目前为止，您已经设法使用调度程序，同时避免任何有关它们如何处理线程或并发的解释。 在前面的章节中，您使用了隐式使用某种并发&#x2F;线程级别的方法，例如<code>buffer</code>，<code>delaySubscription</code>或<code>interval</code>运算符。</p>
<p>您可能感觉调度程序有一些神奇的东西，但在您了解调度程序之前，您还需要了解那些<code>observeOn</code>函数的全部内容。</p>
<p>本章将介绍调度程序背后的美观，在这里您将了解为什么Rx抽象如此强大以及为什么使用异步编程远比使用锁或队列更省心。</p>
<h3 id="调度程序到底是什么？"><a href="#调度程序到底是什么？" class="headerlink" title="调度程序到底是什么？"></a>调度程序到底是什么？</h3><p>在你着手学习时调度程序, 了解他们是什么和他们不是什么是很重要的。总而言之, 调度程序是一个过程发生的上下文。此上下文可以是线程、调度队列或类似的实体, 甚至是在 OperationQueueScheduler 内部使用的 NSOperation。</p>
<p>下图是个好的例子：</p>
<p><img src="https://gewill.org/assets/schedulerExample.png" alt="schedulerExample"></p>
<p>在此图中，具有缓存运算符的概念。 observable向服务器发出请求并检索一些数据。此数据由名为cache的自定义运算符处理，该运算符将数据存储在某处。 在此之后，数据被传递给不同调度程序中的所有订阅者，很可能是位于主线程之上的MainScheduler，使得UI的更新成为可能。</p>
<h4 id="揭开调度程序"><a href="#揭开调度程序" class="headerlink" title="揭开调度程序"></a>揭开调度程序</h4><p>调度程序虽然工作方式和GCD类似，却不是等价的。</p>
<p>要记住的重要一点是, 调度程序不是线程, 并且它们没有与线程的一对一关系。始终检查计划程序执行操作的上下文, 而不是线程。在本章的后面部分, 您将遇到一些好的例子来帮助您理解这一点。</p>
<h3 id="设置项目"><a href="#设置项目" class="headerlink" title="设置项目"></a>设置项目</h3><p>编写两个函数打印当前调度程序所在线程。</p>
<h3 id="切换调度程序"><a href="#切换调度程序" class="headerlink" title="切换调度程序"></a>切换调度程序</h3><p>Rx 中最重要的事情之一是随时切换调度程序的能力, 没有任何限制, 除了内部进程生成事件所强加的约束之外。</p>
<p><code>fruit</code> 是在主线程上生成的, 但是将它移动到后台线程是很好的。要在后台线程中创建 <code>fruit</code> , 必须使用 <code>subscribeOn</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fruit <span class="operator">=</span> <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; observer <span class="keyword">in</span></span><br><span class="line">  observer.onNext(<span class="string">&quot;[apple]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">2</span>)</span><br><span class="line">  observer.onNext(<span class="string">&quot;[pineapple]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">2</span>)</span><br><span class="line">  observer.onNext(<span class="string">&quot;[strawberry]&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fruit</span><br><span class="line">  .subscribeOn(globalScheduler)</span><br><span class="line">  .dump()</span><br><span class="line">  .observeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">  .dumpingSubscription()</span><br><span class="line">  .disposed(by: bag)</span><br></pre></td></tr></table></figure>

<p>观察是 Rx 的三基本概念之一。它涉及实体生成事件, 以及这些事件的观察者。在这种情况下, 在对应 <code>subscribeOn</code> 的情况下, 操作符 <code>observeOn</code> 改变了观察发生的调度程序。</p>
<p>这是一个非常常见的模式。您使用后台进程从服务器检索数据并处理接收的数据, 只切换到 MainScheduler 处理 <code>ﬁnal</code> 事件并在用户界面中显示数据。</p>
<h3 id="陷阱"><a href="#陷阱" class="headerlink" title="陷阱"></a>陷阱</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> globalScheduler <span class="operator">=</span> <span class="type">ConcurrentDispatchQueueScheduler</span>(queue: <span class="type">DispatchQueue</span>.global())</span><br><span class="line"><span class="keyword">let</span> bag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"><span class="keyword">let</span> animal <span class="operator">=</span> <span class="type">BehaviorSubject</span>(value: <span class="string">&quot;[dog]&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animalsThread <span class="operator">=</span> <span class="type">Thread</span>() &#123;</span><br><span class="line">  sleep(<span class="number">3</span>)</span><br><span class="line">  animal.onNext(<span class="string">&quot;[cat]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">3</span>)</span><br><span class="line">  animal.onNext(<span class="string">&quot;[tiger]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">3</span>)</span><br><span class="line">  animal.onNext(<span class="string">&quot;[fox]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">3</span>)</span><br><span class="line">  animal.onNext(<span class="string">&quot;[leopard]&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">animalsThread.name <span class="operator">=</span> <span class="string">&quot;Animals Thread&quot;</span></span><br><span class="line">animalsThread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">animal.subscribeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">  .dump()</span><br><span class="line">  .observeOn(globalScheduler)</span><br><span class="line">  .dumpingSubscription()</span><br><span class="line">  .disposed(by:bag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">RunLoop</span>.main.run(until: <span class="type">Date</span>(timeIntervalSinceNow: <span class="number">13</span>))</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">00s | [D] [dog] received on Main Thread</span><br><span class="line">00s | [S] [dog] received on Anonymous Thread</span><br><span class="line">03s | [D] [cat] received on Animals Thread</span><br><span class="line">03s | [S] [cat] received on Anonymous Thread</span><br><span class="line">06s | [D] [tiger] received on Animals Thread</span><br><span class="line">06s | [S] [tiger] received on Anonymous Thread</span><br><span class="line">09s | [D] [fox] received on Animals Thread</span><br><span class="line">09s | [S] [fox] received on Anonymous Thread</span><br><span class="line">12s | [D] [leopard] received on Animals Thread</span><br><span class="line">12s | [S] [leopard] received on Anonymous Thread</span><br></pre></td></tr></table></figure>

<p>结果出人意料，并没有如愿发生在主线程上。这是一个常见的和危险的陷阱, 它来自于在默认情况下认为 Rx 是异步的或多线程的，但这不是事实。</p>
<p>Rx 和一般抽象是自由线程的;在处理数据时, 没有发生魔术般的线程切换。如果不指定其他的线程, 则始终在原始线程上执行计算。</p>
<blockquote>
<p>任何线程切换都是在程序员使用运算符 <code>subscribeOn</code> 和 <code>observeOn</code> 的显式请求之后发生的。</p>
</blockquote>
<p>认为 Rx 做一些线程处理默认会陷入一个常见的陷阱。上面发生的事情是对 Subject 的误用。原始计算在指定的线程上发生, 并且这些事件使用 <code>Thread() &#123; ... &#125;</code> 在该线程中被推入。由于 Subject 的性质, Rx 没有能力切换原始的计算调度程序, 并移动到另一个线程, 因为没有直接控制的 Subject 被推出。</p>
<p>但是下面的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> globalScheduler <span class="operator">=</span> <span class="type">ConcurrentDispatchQueueScheduler</span>(queue: <span class="type">DispatchQueue</span>.global())</span><br><span class="line"><span class="keyword">let</span> bag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"><span class="keyword">let</span> animal <span class="operator">=</span> <span class="type">BehaviorSubject</span>(value: <span class="string">&quot;[dog]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fruit <span class="operator">=</span> <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; observer <span class="keyword">in</span></span><br><span class="line">  observer.onNext(<span class="string">&quot;[apple]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">2</span>)</span><br><span class="line">  observer.onNext(<span class="string">&quot;[pineapple]&quot;</span>)</span><br><span class="line">  sleep(<span class="number">2</span>)</span><br><span class="line">  observer.onNext(<span class="string">&quot;[strawberry]&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fruit.subscribeOn(globalScheduler)</span><br><span class="line">  .dump()</span><br><span class="line">  .observeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">  .dumpingSubscription()</span><br><span class="line">  .disposed(by:bag)</span><br><span class="line"></span><br><span class="line"><span class="type">RunLoop</span>.main.run(until: <span class="type">Date</span>(timeIntervalSinceNow: <span class="number">13</span>))</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00s | [D] [apple] received on Anonymous Thread</span><br><span class="line">00s | [S] [apple] received on Main Thread</span><br><span class="line">02s | [D] [pineapple] received on Anonymous Thread</span><br><span class="line">02s | [S] [pineapple] received on Main Thread</span><br><span class="line">04s | [D] [strawberry] received on Anonymous Thread</span><br><span class="line">04s | [S] [strawberry] received on Main Thread</span><br></pre></td></tr></table></figure>

<p>为什么这适用于fruit 线程呢？ 这是因为使用<code>Observable.create</code>可以让Rx控制Thread块内部发生的事情，这样你就可以更加精确地定制线程处理。<br>这种意想不到的结果通常被称为“冷和热”可观测问题。<br>在上面的例子中，你正在处理热观察。 observable在订阅期间没有任何副作用，但它确实有自己的上下文，其中生成事件并且RxSwift无法控制它（即，它运行自己的Thread）。<br>相反，冷观察不会在任何观察者订阅之前产生任何元素。 这实际上意味着它没有自己的上下文，直到订阅时，它创建一些上下文并开始生成元素。</p>
<h4 id="热-vs-冷"><a href="#热-vs-冷" class="headerlink" title="热 vs 冷"></a>热 vs 冷</h4><p>上面的部分谈到了冷热观测量的话题。冷热观测量的话题是相当固执己见的, 产生了很多争论, 所以让我们简单在这里看看。这个概念可以归结为一个非常简单的问题:</p>
<p><img src="https://gewill.org//assets/HotVSCold.png" alt="HotVSCold"></p>
<p>一些副作用的例子是：</p>
<ul>
<li>向服务器发送请求</li>
<li>编辑本地数据库</li>
<li>写入文件系统</li>
<li>发射火箭</li>
</ul>
<h2 id="最佳实践和内置调度程序"><a href="#最佳实践和内置调度程序" class="headerlink" title="最佳实践和内置调度程序"></a>最佳实践和内置调度程序</h2><p>调度程序是一个非平凡的主题, 因此它们会为最常见的用例提供一些最佳实践。在本节中, 您将获得串行和并发调度程序的快速介绍, 了解它们如何处理数据并查看哪种类型对特定上下文更有效。</p>
<h4 id="串行与并发调度程序"><a href="#串行与并发调度程序" class="headerlink" title="串行与并发调度程序"></a>串行与并发调度程序</h4><p>虑到调度程序只是一个上下文, 它可以是任何东西 (调度队列、线程、自定义上下文), 并且所有转换序列的运算符都需要保留隐式保证, 因此需要确保您使用的是正确的计划程序。</p>
<ul>
<li><p>如果您使用的是串行调度程序, Rx 将按顺序进行计算。对于串行调度队列, 调度程序还可以在底层执行自己的优化。</p>
</li>
<li><p>在并发计划程序中, Rx 将尝试同时运行代码, 但 <code>observeOn</code> 和 <code>subscribeOn</code> 将保留执行任务所需的顺序, 并确保订阅代码在正确的计划程序上结束。</p>
<h4 id="MainScheduler"><a href="#MainScheduler" class="headerlink" title="MainScheduler"></a>MainScheduler</h4></li>
</ul>
<p>MainScheduler 位于主线程的顶端。此计划程序用于处理用户界面上的更改并执行其他高优先级任务。作为在 iOS、tvOS 或 macOS 上开发应用程序的一般做法, 不应使用此计划程序执行长时间运行的任务, 因此应避免诸如服务器请求或其他繁重任务之类的事情。</p>
<p>MainScheduler 还用于在使用单位和更多特定的（如：Driver）执行所有计算。如前一章所述, Driver 确保始终在 MainScheduler 中执行计算, 以使您能够将数据直接绑定到应用程序的用户界面。</p>
<h4 id="SerialDispatchQueueScheduler"><a href="#SerialDispatchQueueScheduler" class="headerlink" title="SerialDispatchQueueScheduler"></a>SerialDispatchQueueScheduler</h4><p>SerialDispatchQueueScheduler 负责在串行 DispatchQueue 。这个调度程序在使用 <code>observeOn</code> 时，有很多优化的优势。</p>
<p>你可以使用此计划程序来处理以串行方式更好地安排的后台作业。例如, 如果应用程序与服务器的单个路径 (如Firebase 或 GraphQL 应用程序) 进行对话, 则可能需要避免调度多个同时请求, 这会给接收端造成太大的压力。这个调度程序是你绝对想要的, 像串行任务队列一样先进。</p>
<h4 id="ConcurrentDispatchQueueScheduler"><a href="#ConcurrentDispatchQueueScheduler" class="headerlink" title="ConcurrentDispatchQueueScheduler"></a>ConcurrentDispatchQueueScheduler</h4><p>ConcurrentDispatchQueueScheduler 与 SerialDispatchQueueScheduler类似，负责在DispatchQueue上抽象工作。 主要区别在于，调度程序使用并行队列而不是串行队列。</p>
<p>此类调度程序在使用 <code>observeOn</code> 时没有进行优化, 因此在决定使用哪种调度程序时, 请记住说明这一点。</p>
<p>对于需要同时结束的多个长时间运行的任务，并发的调度程序可能是一个不错的选择。 将多个可观察对象与阻塞运算符组合在一起，以便在准备好时将所有结果组合在一起，可以防止串行调度程序以最佳状态执行。 相反，并发调度程序可以执行多个并发任务并优化结果的收集。</p>
<h4 id="OperationQueueScheduler"><a href="#OperationQueueScheduler" class="headerlink" title="OperationQueueScheduler"></a>OperationQueueScheduler</h4><p>OperationQueueScheduler类似于ConcurrentDispatchQueueScheduler，但不是通过DispatchQueue抽象工作，它在NSOperationQueue上执行工作。 有时你需要对正在运行的并发作业进行更多控制，而对于并发DispatchQueue则无法做到这一点。</p>
<p>如果需要调整最大并发作业数，则这是作业的调度程序。 您可以定义<code>maxConcurrentOperationCount</code>来限制并发操作的数量以满足您的应用程序的需要。</p>
<h4 id="TestScheduler"><a href="#TestScheduler" class="headerlink" title="TestScheduler"></a>TestScheduler</h4><p>TestScheduler是一种特殊的野兽。 它仅用于测试，因此尽量不要在生产代码中使用此调度程序。 这种特殊的调度程序简化了操作员测试; 它是RxTest库的一部分。 您将在关于测试的专用章节中了解如何使用此调度程序，但是让我们快速浏览一下，因为您正在进行调度程序的全程浏览。</p>
<h2 id="第十六章：使用-RxTest-进行测试"><a href="#第十六章：使用-RxTest-进行测试" class="headerlink" title="第十六章：使用 RxTest 进行测试"></a>第十六章：使用 RxTest 进行测试</h2><p>本章将向您介绍 RxTest, 以及以后的 RxBlocking, 通过编写针对多个 RxSwift 操作的测试, 还可以编写针对生产 RxSwift 代码的测试。</p>
<p>本章例子是：一个将Hex颜色值转换为RGB值的应用。架构是MVVM。</p>
<h3 id="使用-RxTest-测试操作符"><a href="#使用-RxTest-测试操作符" class="headerlink" title="使用 RxTest 测试操作符"></a>使用 RxTest 测试操作符</h3><p> RxTest 是 RxSwift 外一个独立的库。它是托管在 RxSwift 仓库, 但需要一个单独的 pod 安装和导入。RxTest 为测试 RxSwift 代码提供了许多有用的补充, 如 TestScheduler, 它是一个虚拟时间计划程序, 它使你可以对测试的时间线性操作进行粒状控制, 并且包括 <code>next(_:_:)</code>, <code>completed(_:_:)</code> 和 <code>error(_:_:)</code> 在测试中 speciﬁed 时间启用将这些事件添加到观测量中。它还增加了热和冷的观测量, 你可以想到的热和冷三明治。当然, 不是真的三明治。</p>
<h4 id="热和冷的序列是什么？"><a href="#热和冷的序列是什么？" class="headerlink" title="热和冷的序列是什么？"></a>热和冷的序列是什么？</h4><p>RxSwift 很长的时间来简化和简化你的 Rx 代码, 并且有热和冷的序列的区别, 当它涉及到观测量, 在 RxSwift 可以被认为是可观测的特征而不是具体的类型。</p>
<p><strong>热序列：</strong></p>
<ul>
<li>使用资源，无论是否有订阅者。</li>
<li>生成元素，无论是否有订阅者。</li>
<li>主要用于有状态类型，如变量。</li>
</ul>
<p><strong>冷序列：</strong></p>
<ul>
<li>仅在订阅时消耗资源。</li>
<li>仅在有订阅者时才生成元素。</li>
<li>主要用于网络等异步操作。</li>
</ul>
<p>下面是 <code>amb</code> 的测试用例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">testAmb</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observer <span class="operator">=</span> scheduler.createObserver(<span class="type">String</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observableA <span class="operator">=</span> scheduler.createHotObservable([</span><br><span class="line">        next(<span class="number">100</span>, <span class="string">&quot;a&quot;</span>),</span><br><span class="line">        next(<span class="number">110</span>, <span class="string">&quot;b&quot;</span>),</span><br><span class="line">        next(<span class="number">300</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observableB <span class="operator">=</span> scheduler.createHotObservable([</span><br><span class="line">        next(<span class="number">90</span>, <span class="string">&quot;1&quot;</span>),</span><br><span class="line">        next(<span class="number">200</span>, <span class="string">&quot;2&quot;</span>),</span><br><span class="line">        next(<span class="number">300</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> ambObservable <span class="operator">=</span> observableA.amb(observableB)</span><br><span class="line"></span><br><span class="line">    scheduler.scheduleAt(<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.subscription <span class="operator">=</span> ambObservable.subscribe(observer)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scheduler.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> results <span class="operator">=</span> observer.events.map &#123;</span><br><span class="line">        <span class="variable">$0</span>.value.element<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">XCTAssertEqual</span>(results, [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面是同步测试，如果想测试异步错误，最简单地是使用 <code>RxBlocking</code>。</p>
<h4 id="使用-RxBlocking"><a href="#使用-RxBlocking" class="headerlink" title="使用 RxBlocking"></a>使用 RxBlocking</h4><p>RxBlocking 是另一个库, 寄存在 RxSwift 仓库。它的主要目的是通过它的 <code>toBlocking(timeout:)</code> 方法将 <code>observable</code> 转换为 <code>BlockingObservable</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">testToArray</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> scheduler <span class="operator">=</span> <span class="type">ConcurrentDispatchQueueScheduler</span>(qos: .default)</span><br><span class="line">    <span class="keyword">let</span> toArrayObservable <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>).subscribeOn(scheduler)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(<span class="keyword">try!</span> toArrayObservable.toBlocking().toArray(), [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">testToArrayMaterialized</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> scheduler <span class="operator">=</span> <span class="type">ConcurrentDispatchQueueScheduler</span>(qos: .default)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> toArrayObservable <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>).subscribeOn(scheduler)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> toArrayObservable</span><br><span class="line">        .toBlocking()</span><br><span class="line">        .materialize()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .completed(elements: <span class="keyword">let</span> elements):</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(elements, [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">    <span class="keyword">case</span> .failed(<span class="keyword">_</span>, error: <span class="keyword">let</span> error):</span><br><span class="line">        <span class="type">XCTFail</span>(error.localizedDescription)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试-RxSwift-生产代码"><a href="#测试-RxSwift-生产代码" class="headerlink" title="测试 RxSwift 生产代码"></a>测试 RxSwift 生产代码</h3><p>下面例子是测试MVVM中VM层：</p>
<p>使用 <code>toBlocking</code>  很方便编写异步测试。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxCocoa</span><br><span class="line"><span class="keyword">import</span> RxTest</span><br><span class="line"><span class="keyword">@testable</span> <span class="keyword">import</span> Testing</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestingViewModel</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span>!</span><br><span class="line">    <span class="keyword">var</span> scheduler: <span class="type">ConcurrentDispatchQueueScheduler</span>!</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">setUp</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.setUp()</span><br><span class="line"></span><br><span class="line">        viewModel <span class="operator">=</span> <span class="type">ViewModel</span>()</span><br><span class="line">        scheduler <span class="operator">=</span> <span class="type">ConcurrentDispatchQueueScheduler</span>(qos: .default)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testColorIsRedWhenHexStringIsFF0000_async</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> expect <span class="operator">=</span> expectation(description: <span class="keyword">#function</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> expectedColor <span class="operator">=</span> <span class="type">UIColor</span>(red: <span class="number">1.0</span>, green: <span class="number">0.0</span>, blue: <span class="number">0.0</span>, alpha: <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> result: <span class="type">UIColor</span>!</span><br><span class="line"></span><br><span class="line">        viewModel.color.asObservable()</span><br><span class="line">            .skip(<span class="number">1</span>)</span><br><span class="line">            .subscribe(onNext: &#123;</span><br><span class="line">                result <span class="operator">=</span> <span class="variable">$0</span></span><br><span class="line">                expect.fulfill()</span><br><span class="line">            &#125;)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">        viewModel.hexString.value <span class="operator">=</span> <span class="string">&quot;#ff0000&quot;</span></span><br><span class="line"></span><br><span class="line">        waitForExpectations(timeout: <span class="number">1.0</span>) &#123; error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> error <span class="operator">==</span> <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">XCTFail</span>(error<span class="operator">!</span>.localizedDescription)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">XCTAssertEqual</span>(expectedColor, result)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testColorIsRedWhenHexStringIsFF0000</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> colorObservable <span class="operator">=</span> viewModel.color.asObservable().subscribeOn(scheduler)</span><br><span class="line"></span><br><span class="line">        viewModel.hexString.value <span class="operator">=</span> <span class="string">&quot;#ff0000&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try</span> colorObservable.toBlocking(timeout: <span class="number">1.0</span>).first() <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">XCTAssertEqual</span>(result, .red)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testRgbIs010WhenHexStringIs00FF00</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rgbObservable <span class="operator">=</span> viewModel.rgb.asObservable().subscribeOn(scheduler)</span><br><span class="line"></span><br><span class="line">        viewModel.hexString.value <span class="operator">=</span> <span class="string">&quot;#00ff00&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try!</span> rgbObservable.toBlocking().first()<span class="operator">!</span></span><br><span class="line"></span><br><span class="line">        <span class="type">XCTAssertEqual</span>(<span class="number">0</span> <span class="operator">*</span> <span class="number">255</span>, result.<span class="number">0</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(<span class="number">1</span> <span class="operator">*</span> <span class="number">255</span>, result.<span class="number">1</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(<span class="number">0</span> <span class="operator">*</span> <span class="number">255</span>, result.<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testColorNameIsRayWenderlichGreenWhenHexStringIs006636</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> colorNameObservable <span class="operator">=</span> viewModel.colorName.asObservable().subscribeOn(scheduler)</span><br><span class="line"></span><br><span class="line">        viewModel.hexString.value <span class="operator">=</span> <span class="string">&quot;#006636&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">XCTAssertEqual</span>(<span class="keyword">try!</span> colorNameObservable.toBlocking().first()<span class="operator">!</span>, <span class="string">&quot;rayWenderlichGreen&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第十七章：创建自定义响应式拓展"><a href="#第十七章：创建自定义响应式拓展" class="headerlink" title="第十七章：创建自定义响应式拓展"></a>第十七章：创建自定义响应式拓展</h2><p>在学习了RxSwift和RxCocoa，以及如何编写测试，这里我们将学习如何给Apple和第三方库编写RxSwift的拓展。本章例子是给NSURLSession编写拓展，来实现网络请求、缓存。但却是一个教学实例，如果生产项目可以有很多网络库可以直接使用，如RxAlamofire、RxMoya等。</p>
<h3 id="如何创建拓展"><a href="#如何创建拓展" class="headerlink" title="如何创建拓展"></a>如何创建拓展</h3><p>创建一个Cocoa或库的拓展不是一个简单的任务。你会发现这个过程可能很棘手，你的解决方案在继续之前可能需要一些前期思考。</p>
<p>这里我们将学习如何拓展URLSession，加上Rx的命名空间。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Reactive</span> <span class="title class_">where</span> <span class="title class_">Base</span>: <span class="title class_">URLSession</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">response</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;(<span class="type">HTTPURLResponse</span>, <span class="type">Data</span>)&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></span><br><span class="line">      <span class="comment">// content goes here</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> task <span class="operator">=</span> <span class="keyword">self</span>.base.dataTask(with: request) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> response <span class="operator">=</span> response, <span class="keyword">let</span> data <span class="operator">=</span> data <span class="keyword">else</span> &#123;</span><br><span class="line">          observer.on(.error(error <span class="operator">??</span> <span class="type">RxURLSessionError</span>.unknown))</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span> <span class="keyword">else</span> &#123;</span><br><span class="line">          observer.on(.error(<span class="type">RxURLSessionError</span>.invalidResponse(response: response)))</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        observer.onNext((httpResponse, data))</span><br><span class="line">        observer.on(.completed)</span><br><span class="line">      &#125;</span><br><span class="line">      task.resume()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="type">Disposables</span>.create(with: task.cancel)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">data</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">Data</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span> request.url<span class="operator">?</span>.absoluteString, <span class="keyword">let</span> data <span class="operator">=</span> internalCache[url] &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Observable</span>.just(data)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> response(request: request).cache().map &#123; (response, data) -&gt; <span class="type">Data</span> <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> <span class="number">200</span> <span class="operator">..&lt;</span> <span class="number">300</span> <span class="operator">~=</span> response.statusCode &#123;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">RxURLSessionError</span>.requestFailed(response: response, data: data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">string</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> data(request: request).map &#123; d <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">String</span>(data: d, encoding: .utf8) <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">json</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">JSON</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> data(request: request).map &#123; d <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">JSON</span>(data: d)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">image</span>(<span class="params">request</span>: <span class="type">URLRequest</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">UIImage</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> data(request: request).map &#123; d <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">UIImage</span>(data: d) <span class="operator">??</span> <span class="type">UIImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何创建自定义运算符"><a href="#如何创建自定义运算符" class="headerlink" title="如何创建自定义运算符"></a>如何创建自定义运算符</h3><p>这里我们演示如何使用运算符进行缓存网络请求结果（HTTPURLResponse、Data）的序列，简单起见使用字典。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> internalCache <span class="operator">=</span> [<span class="type">String</span>: <span class="type">Data</span>]()</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">ObservableType</span> <span class="title class_">where</span> <span class="title class_">E</span> == (<span class="title class_">HTTPURLResponse</span>, <span class="title class_">Data</span>) &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">cache</span>() -&gt; <span class="type">Observable</span>&lt;<span class="type">E</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.do(onNext: &#123; (response, data) <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span> response.url<span class="operator">?</span>.absoluteString, <span class="number">200</span> <span class="operator">..&lt;</span> <span class="number">300</span> <span class="operator">~=</span> response.statusCode &#123;</span><br><span class="line">        internalCache[url] <span class="operator">=</span> data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何使用封装的拓展"><a href="#如何使用封装的拓展" class="headerlink" title="如何使用封装的拓展"></a>如何使用封装的拓展</h3><p>在cell中更具给定url下载gif并显示出来。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">downloadAndDisplay</span>(<span class="params">gif</span> <span class="params">stringUrl</span>: <span class="type">String</span>) &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: stringUrl) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">  activityIndicator.startAnimating()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> s <span class="operator">=</span> <span class="type">URLSession</span>.shared.rx.data(request: request)</span><br><span class="line">    .observeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">    .subscribe(onNext: &#123; imageData <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>.gifImageView.animate(withGIFData: imageData)</span><br><span class="line">      <span class="keyword">self</span>.activityIndicator.stopAnimating()</span><br><span class="line">    &#125;)</span><br><span class="line">  disposable.setDisposable(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试封装的拓展"><a href="#测试封装的拓展" class="headerlink" title="测试封装的拓展"></a>测试封装的拓展</h3><p>这里我们使用RxNimble来辅助我们编写测试。RxNimble 使测试更容易编写, 并有助于代码更简明。</p>
<p>RxBlocking版本：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try!</span> observable.toBlocking().first()</span><br><span class="line">expect(result) <span class="operator">==</span> <span class="number">42</span></span><br></pre></td></tr></table></figure>

<p>RxNimble版本：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(observable).first <span class="operator">==</span> <span class="number">42</span></span><br></pre></td></tr></table></figure>

<p>完整测试代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxBlocking</span><br><span class="line"><span class="keyword">import</span> Nimble</span><br><span class="line"><span class="keyword">import</span> RxNimble</span><br><span class="line"><span class="keyword">import</span> OHHTTPStubs</span><br><span class="line"><span class="keyword">import</span> SwiftyJSON</span><br><span class="line"></span><br><span class="line"><span class="keyword">@testable</span> <span class="keyword">import</span> iGif</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">iGifTests</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> obj <span class="operator">=</span> [<span class="string">&quot;array&quot;</span>:[<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span>], <span class="string">&quot;foo&quot;</span>:<span class="string">&quot;bar&quot;</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="keyword">Any</span>]</span><br><span class="line">  <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">&quot;http://raywenderlich.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">  <span class="keyword">let</span> errorRequest <span class="operator">=</span> <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">&quot;http://rw.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">setUp</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.setUp()</span><br><span class="line">    <span class="comment">// Put setup code here. This method is called before the invocation of each test method in the class.</span></span><br><span class="line">    stub(condition: isHost(<span class="string">&quot;raywenderlich.com&quot;</span>)) &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">OHHTTPStubsResponse</span>(jsonObject: <span class="keyword">self</span>.obj, statusCode: <span class="number">200</span>, headers: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stub(condition: isHost(<span class="string">&quot;rw.com&quot;</span>)) &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">OHHTTPStubsResponse</span>(error: <span class="type">RxURLSessionError</span>.unknown)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tearDown</span>() &#123;</span><br><span class="line">    <span class="comment">// Put teardown code here. This method is called after the invocation of each test method in the class.</span></span><br><span class="line">    <span class="keyword">super</span>.tearDown()</span><br><span class="line">    <span class="type">OHHTTPStubs</span>.removeAllStubs()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">testData</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">URLSession</span>.shared.rx.data(request: <span class="keyword">self</span>.request)</span><br><span class="line">    expect(observable.toBlocking().firstOrNil()).toNot(beNil())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">testString</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">URLSession</span>.shared.rx.string(request: <span class="keyword">self</span>.request)</span><br><span class="line">    <span class="keyword">let</span> string <span class="operator">=</span> <span class="string">&quot;&#123;<span class="subst">\&quot;</span>array<span class="subst">\&quot;</span>:[<span class="subst">\&quot;</span>foo<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>bar<span class="subst">\&quot;</span>],<span class="subst">\&quot;</span>foo<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>bar<span class="subst">\&quot;</span>&#125;&quot;</span></span><br><span class="line">    expect(observable.toBlocking().firstOrNil()) <span class="operator">==</span> string</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">testJSON</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">URLSession</span>.shared.rx.json(request: <span class="keyword">self</span>.request)</span><br><span class="line">    <span class="keyword">let</span> string <span class="operator">=</span> <span class="string">&quot;&#123;<span class="subst">\&quot;</span>array<span class="subst">\&quot;</span>:[<span class="subst">\&quot;</span>foo<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>bar<span class="subst">\&quot;</span>],<span class="subst">\&quot;</span>foo<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>bar<span class="subst">\&quot;</span>&#125;&quot;</span></span><br><span class="line">    <span class="keyword">let</span> json <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">JSON</span>(data: string.data(using: .utf8)<span class="operator">!</span>)</span><br><span class="line">    expect(observable.toBlocking().firstOrNil()) <span class="operator">==</span> json</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">testError</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> erroredCorrectly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">URLSession</span>.shared.rx.json(request: <span class="keyword">self</span>.errorRequest)</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> observable.toBlocking().first()</span><br><span class="line">      <span class="built_in">assertionFailure</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="type">RxURLSessionError</span>.unknown) &#123;</span><br><span class="line">      erroredCorrectly <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="built_in">assertionFailure</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    expect(erroredCorrectly) <span class="operator">==</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">BlockingObservable</span> &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">firstOrNil</span>() -&gt; <span class="type">E</span>? &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">try</span> first()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用封装"><a href="#常用封装" class="headerlink" title="常用封装"></a>常用封装</h3><p>RxSwift社区非常活跃，并且已经有很多扩展和封装。 一些基于Apple组件，而另一些则基于许多iOS和macOS项目中广泛使用的第三方库。<br>你可以在 <a target="_blank" rel="noopener" href="http://community.rxswift.org/">http://community.rxswift.org</a> 找到最新的封装列表。</p>
<p>下面几个常用的封装：</p>
<ul>
<li>RxDataSources</li>
<li>RxAlamofire</li>
<li>RxBluetoothKit</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>关于何时需要抽象，没有真正明确的规则，但建议如果框架满足以下一个或多个条件，则应用此策略：</p>
<ul>
<li>使用带有完成和失败信息的回调</li>
<li>使用大量委托异步返回信息</li>
<li>需要与应用程序的其他RxSwift部分进行互操作</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/08/01/RxSwift-%E2%85%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/08/01/RxSwift-%E2%85%A2/" class="post-title-link" itemprop="url">RxSwift Ⅲ：iOS 应用程序与 RxCocoa</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-08-01 22:01:54" itemprop="dateCreated datePublished" datetime="2018-08-01T22:01:54+08:00">2018-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>由于Rx是一个多平台框架，因此它不会对您的Rx驱动的应用程序运行的设备做出任何假设。 RxSwift严格遵循RxPython，RxRuby，RxJS和所有其他平台所遵循的通用API设计，因此它不包含任何特定功能或与UIKit或Cocoa的集成，以帮助您开发iOS或macOS。</p>
<p>RxCocoa是一个独立的库（尽管它与RxSwift捆绑在一起），它允许您使用许多预构建的功能来更好地与UIKit和Cocoa集成。</p>
<p>RxCocoa将为您提供开箱即用的类来进行反应式网络，对用户交互作出反应，将数据模型绑定到UI控件等等。</p>
<h2 id="第十二章：开始学习-RxCocoa"><a href="#第十二章：开始学习-RxCocoa" class="headerlink" title="第十二章：开始学习 RxCocoa"></a>第十二章：开始学习 RxCocoa</h2><p>更新天气信息界面，根据API获取的数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApiController</span>.shared.currentWeather(city: <span class="string">&quot;RxSwift&quot;</span>)</span><br><span class="line">      .observeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">      .subscribe(onNext: &#123; data <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>.tempLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(data.temperature)</span>° C&quot;</span></span><br><span class="line">        <span class="keyword">self</span>.iconLabel.text <span class="operator">=</span> data.icon</span><br><span class="line">        <span class="keyword">self</span>.humidityLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(data.humidity)</span>%&quot;</span></span><br><span class="line">        <span class="keyword">self</span>.cityNameLabel.text <span class="operator">=</span> data.cityName</span><br><span class="line">      &#125;)</span><br><span class="line">      .disposed(by:bag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> search <span class="operator">=</span> searchCityName.rx.controlEvent(.editingDidEndOnExit).asObservable()</span><br><span class="line">      .map &#123; <span class="keyword">self</span>.searchCityName.text &#125;</span><br><span class="line">      .filter &#123; (<span class="variable">$0</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span>).characters.count <span class="operator">&gt;</span> <span class="number">0</span> &#125;</span><br><span class="line">      .flatMapLatest &#123; text <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">ApiController</span>.shared.currentWeather(city: text <span class="operator">??</span> <span class="string">&quot;Error&quot;</span>)</span><br><span class="line">          .catchErrorJustReturn(<span class="type">ApiController</span>.<span class="type">Weather</span>.empty)</span><br><span class="line">      &#125;</span><br><span class="line">      .asDriver(onErrorJustReturn: <span class="type">ApiController</span>.<span class="type">Weather</span>.empty)</span><br><span class="line"></span><br><span class="line">    search.map &#123; <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>.temperature)</span>° C&quot;</span> &#125;</span><br><span class="line">      .drive(tempLabel.rx.text)</span><br><span class="line">      .disposed(by:bag)</span><br><span class="line"></span><br><span class="line">    search.map &#123; <span class="variable">$0</span>.icon &#125;</span><br><span class="line">      .drive(iconLabel.rx.text)</span><br><span class="line">      .disposed(by:bag)</span><br><span class="line"></span><br><span class="line">    search.map &#123; <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>.humidity)</span>%&quot;</span> &#125;</span><br><span class="line">      .drive(humidityLabel.rx.text)</span><br><span class="line">      .disposed(by:bag)</span><br><span class="line"></span><br><span class="line">    search.map &#123; <span class="variable">$0</span>.cityName &#125;</span><br><span class="line">      .drive(cityNameLabel.rx.text)</span><br><span class="line">      .disposed(by:bag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="第十三章：RxCocoa-中级"><a href="#第十三章：RxCocoa-中级" class="headerlink" title="第十三章：RxCocoa 中级"></a>第十三章：RxCocoa 中级</h2><p>添加搜索框支持</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">  style()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> searchInput <span class="operator">=</span> searchCityName.rx.controlEvent(.editingDidEndOnExit).asObservable()</span><br><span class="line">    .map &#123; <span class="keyword">self</span>.searchCityName.text &#125;</span><br><span class="line">    .filter &#123; (<span class="variable">$0</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span>).count <span class="operator">&gt;</span> <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> textSearch <span class="operator">=</span> searchInput.flatMap &#123; text <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">ApiController</span>.shared.currentWeather(city: text <span class="operator">??</span> <span class="string">&quot;Error&quot;</span>)</span><br><span class="line">      .catchErrorJustReturn(<span class="type">ApiController</span>.<span class="type">Weather</span>.dummy)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> mapInput <span class="operator">=</span> mapView.rx.regionDidChangeAnimated</span><br><span class="line">    .skip(<span class="number">1</span>)</span><br><span class="line">    .map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="keyword">self</span>.mapView.centerCoordinate &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> mapSearch <span class="operator">=</span> mapInput.flatMap &#123; coordinate <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">ApiController</span>.shared.currentWeather(lat: coordinate.latitude, lon: coordinate.longitude)</span><br><span class="line">      .catchErrorJustReturn(<span class="type">ApiController</span>.<span class="type">Weather</span>.dummy)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> currentLocation <span class="operator">=</span> locationManager.rx.didUpdateLocations</span><br><span class="line">    .map &#123; locations <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> locations[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    .filter &#123; location <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> location.horizontalAccuracy <span class="operator">&lt;</span> kCLLocationAccuracyHundredMeters</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> geoInput <span class="operator">=</span> geoLocationButton.rx.tap.asObservable()</span><br><span class="line">    .do(onNext: &#123;</span><br><span class="line">      <span class="keyword">self</span>.locationManager.requestWhenInUseAuthorization()</span><br><span class="line">      <span class="keyword">self</span>.locationManager.startUpdatingLocation()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> geoLocation <span class="operator">=</span> geoInput.flatMap &#123;</span><br><span class="line">    <span class="keyword">return</span> currentLocation.take(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> geoSearch <span class="operator">=</span> geoLocation.flatMap &#123; location <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">ApiController</span>.shared.currentWeather(lat: location.coordinate.latitude, lon: location.coordinate.longitude)</span><br><span class="line">      .catchErrorJustReturn(<span class="type">ApiController</span>.<span class="type">Weather</span>.dummy)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> search <span class="operator">=</span> <span class="type">Observable</span>.from([geoSearch, textSearch, mapSearch])</span><br><span class="line">  .merge()</span><br><span class="line">  .asDriver(onErrorJustReturn: <span class="type">ApiController</span>.<span class="type">Weather</span>.dummy)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> running <span class="operator">=</span> <span class="type">Observable</span>.from([searchInput.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="literal">true</span> &#125;,</span><br><span class="line">                                 geoInput.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="literal">true</span> &#125;,</span><br><span class="line">                                 mapInput.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="literal">true</span>&#125;,</span><br><span class="line">                                 search.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="literal">false</span> &#125;.asObservable()])</span><br><span class="line">  .merge()</span><br><span class="line">  .startWith(<span class="literal">true</span>)</span><br><span class="line">  .asDriver(onErrorJustReturn: <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  running</span><br><span class="line">    .skip(<span class="number">1</span>)</span><br><span class="line">    .drive(activityIndicator.rx.isAnimating)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line">  </span><br><span class="line">  running</span><br><span class="line">    .drive(tempLabel.rx.isHidden)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  running</span><br><span class="line">    .drive(iconLabel.rx.isHidden)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  running</span><br><span class="line">    .drive(humidityLabel.rx.isHidden)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  running</span><br><span class="line">    .drive(cityNameLabel.rx.isHidden)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line">  </span><br><span class="line">  search.map &#123; <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>.temperature)</span>° C&quot;</span> &#125;</span><br><span class="line">    .drive(tempLabel.rx.text)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  search.map &#123; <span class="variable">$0</span>.icon &#125;</span><br><span class="line">    .drive(iconLabel.rx.text)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  search.map &#123; <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>.humidity)</span>%&quot;</span> &#125;</span><br><span class="line">    .drive(humidityLabel.rx.text)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  search.map &#123; <span class="variable">$0</span>.cityName &#125;</span><br><span class="line">    .drive(cityNameLabel.rx.text)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  locationManager.rx.didUpdateLocations</span><br><span class="line">    .subscribe(onNext: &#123; locations <span class="keyword">in</span></span><br><span class="line">      <span class="built_in">print</span>(locations)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  mapButton.rx.tap</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">      <span class="keyword">self</span>.mapView.isHidden <span class="operator">=</span> <span class="operator">!</span><span class="keyword">self</span>.mapView.isHidden</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  mapView.rx.setDelegate(<span class="keyword">self</span>)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  search.map &#123; [<span class="variable">$0</span>.overlay()] &#125;</span><br><span class="line">    .drive(mapView.rx.overlays)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/08/01/RxSwift-%E2%85%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/08/01/RxSwift-%E2%85%A1/" class="post-title-link" itemprop="url">RxSwift Ⅱ：操作符和最佳实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-08-01 21:57:49" itemprop="dateCreated datePublished" datetime="2018-08-01T21:57:49+08:00">2018-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="第五章：Filtering-Operator"><a href="#第五章：Filtering-Operator" class="headerlink" title="第五章：Filtering Operator"></a>第五章：Filtering Operator</h2><h3 id="Ignoring"><a href="#Ignoring" class="headerlink" title="Ignoring"></a>Ignoring</h3><p>忽略所有event，转化为一个 Comletable。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">ignoreElements</span>() -&gt; <span class="type">Completable</span></span><br></pre></td></tr></table></figure>

<p>仅发射指定index的event，其余都忽略。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">elementAt</span>(<span class="keyword">_</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;</span><br></pre></td></tr></table></figure>

<p>或者直接使用 <code>.filter</code> ，是 RxSwift 对 Swift 标准库中 <code>.filter</code> 对应版本。具体用法很简单，和 Swift 版一样。</p>
<h3 id="Skipping"><a href="#Skipping" class="headerlink" title="Skipping"></a>Skipping</h3><p><code>.skip(n) 即可跳过前</code> n 个 event。</p>
<p><code>.skipWhile</code> 跳过符合条件的 event，但是遇到不符合条件的 event 后，不再跳过该 event 以及后面的event。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Observable</span>.of(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    .skipWhile &#123; integer <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(integer)</span> skipWhile&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> integer <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2 skipWhile</span><br><span class="line">2 skipWhile</span><br><span class="line">3 skipWhile</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<p><code>.skipUntil(trigger)</code> 持续跳过直到另一个Observable生成元素。</p>
<h3 id="Taking"><a href="#Taking" class="headerlink" title="Taking"></a>Taking</h3><p>Taking 和 Skipping 是相反的。</p>
<p><code>.take(n)</code> 只发射前 n 个 event 。</p>
<p><code>.takeWhile &#123; &#125;</code>  放射符合条件的event，直到遇到不符合条件的元素，不再发射。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="type">Observable</span>.of(<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line">    .enumerated()</span><br><span class="line">    .takeWhile &#123; index, integer <span class="keyword">in</span></span><br><span class="line">        integer <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> index <span class="operator">&lt;</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; <span class="variable">$0</span>.element &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">2</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<p><code>.takeUntil(trigger)</code>  类似的，持续发射，直到另一个Observable生成元素，后面不再发射。</p>
<h3 id="Distinct"><a href="#Distinct" class="headerlink" title="Distinct"></a>Distinct</h3><p><code>.distinctUntilChanged()</code> 只发射不同于前一个的元素。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Observable</span>.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>)</span><br><span class="line">    .distinctUntilChanged()</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

<p> Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">B</span><br><span class="line">A</span><br></pre></td></tr></table></figure>

<p><code>distinctUntilChanged(_:)</code> 对阻止重复发射不符合 <code>Equatable</code> 类型的元素时很有用。因为你可以控制前后两个元素是否相等。</p>
<h2 id="第六章：Filtering-实践"><a href="#第六章：Filtering-实践" class="headerlink" title="第六章：Filtering 实践"></a>第六章：Filtering 实践</h2><p>上一章介绍了RxSwift中函数式编程的观念。操作符操作一个Observable，输出一个心得Observable。得益于此，我么可以链式调用操作符。</p>
<h3 id="改进-Combinestagram-项目"><a href="#改进-Combinestagram-项目" class="headerlink" title="改进 Combinestagram 项目"></a>改进 Combinestagram 项目</h3><p>就是把上一章的 filtering 操作符应用在项目中。</p>
<h3 id="基于时间的操作符"><a href="#基于时间的操作符" class="headerlink" title="基于时间的操作符"></a>基于时间的操作符</h3><p>基于时间的操作符使用 <strong>Scheduler</strong> 。</p>
<p><code>take(_:scheduler:)</code> 是一个过滤操作符，和 <code>take(1)</code> 和 <code>takeWhile(...)</code> 类似。</p>
<p>只会发送指定时间段内的元素。一旦时间点过了，就会发送 <code>.complete</code> 事件。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">errorMessage</span>() &#123;</span><br><span class="line">  alert(title: <span class="string">&quot;No access to Camera Roll&quot;</span>,</span><br><span class="line">        text: <span class="string">&quot;You can grant access to Combinestagram from the Settings app&quot;</span>)</span><br><span class="line">    .asObservable()</span><br><span class="line">    .take(<span class="number">5.0</span>, scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">    .subscribe(onCompleted: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span><span class="operator">?</span>.dismiss(animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">      <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">self</span><span class="operator">?</span>.navigationController<span class="operator">?</span>.popViewController(animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以下是一些合适使用 <code>throttle</code> 的场景：</p>
<ul>
<li>搜索输入框的订阅，然后发送当前文本内容的API请求。通过 <code>throttle</code> , 你可以让用户快速输入，同时仅在用户完成输入时才你的向服务器发送请求。</li>
<li>当用户点击按钮来展示一个 modal view controller 时，你可以阻止双击以及展示两次 modal view controller。通过 <code>throttle</code> 点击事件，可以现实只接收最后一次点击事件，不论用户双击或三击。</li>
<li>如果你只关心用户拖动手势时停留的地方。你可以使用 <code>throttle</code> 当前触摸位置，只考虑那些停止改变的位置的元素。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">images.asObservable()</span><br><span class="line">    .throttle(<span class="number">0.5</span>, scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] photos <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> preview <span class="operator">=</span> <span class="keyword">self</span><span class="operator">?</span>.imagePreview <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      preview.image <span class="operator">=</span> <span class="type">UIImage</span>.collage(images: photos,</span><br><span class="line">                                      size: preview.frame.size)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br></pre></td></tr></table></figure>

<h2 id="第七章：Transforming-Operator"><a href="#第七章：Transforming-Operator" class="headerlink" title="第七章：Transforming Operator"></a>第七章：Transforming Operator</h2><p>当你决定学习 RxSwift，或许会觉得它是深奥的库。也许让你想起来当初学习 iOS 或者 Swift 的时候。但学习到第七章你应该意识到 RxSwift 并非魔法。它是精心构建的API，能让极大地提升效率和简化代码。学到这里你应该会感觉不错。</p>
<p>本章你将学习运算符中最重要的一类：transforming 运算符。你将一直使用 transforming，准备Observable数据以供订阅者使用。需要强调的是，RxSwift 中的 transforming 运算符与 Swift 标准库之间有相似之处 ，如 <code>map (_:)</code> 和 <code>flatMap (_:)</code> 。 </p>
<h3 id="Transforming-元素"><a href="#Transforming-元素" class="headerlink" title="Transforming 元素"></a>Transforming 元素</h3><p>将可观察到的单个元素转换为所有这些元素的数组的一种简便方法是使用 <code>toArray</code>。<img src="https://gewill.org/assets/toArray.jpg" alt="toArray"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"><span class="type">Observable</span>.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line">  .toArray()</span><br><span class="line">  .subscribe(onNext: &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

<p><code>map</code> 可将每个元素进行 transforming 。<img src="https://gewill.org/assets/map.jpg" alt="map"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"><span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">NumberFormatter</span>()</span><br><span class="line">formatter.numberStyle <span class="operator">=</span> .spellOut</span><br><span class="line"></span><br><span class="line"><span class="type">Observable</span>&lt;<span class="type">NSNumber</span>&gt;.of(<span class="number">123</span>, <span class="number">4</span>, <span class="number">56</span>)</span><br><span class="line">    .map &#123;</span><br><span class="line">        formatter.string(from: <span class="variable">$0</span>) <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">    .enumerated()</span><br><span class="line">    .map &#123; index, integer <span class="keyword">in</span></span><br><span class="line">        index <span class="operator">&gt;</span> <span class="number">2</span> <span class="operator">?</span> integer <span class="operator">*</span> <span class="number">2</span> : integer</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>



<h3 id="Transforming-内部-Observable"><a href="#Transforming-内部-Observable" class="headerlink" title="Transforming 内部 Observable"></a>Transforming 内部 Observable</h3><p>RxSwift 包含 <code>flatMap</code> 系列中的几个运算符, 允许你深入Observable,处理其Observable类型的属性。<img src="https://gewill.org/assets/flatMap.jpg" alt="flatMap"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> score: <span class="type">BehaviorSubject</span>&lt;<span class="type">Int</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ryan <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">80</span>))</span><br><span class="line"><span class="keyword">let</span> charlotte <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">Student</span>&gt;()</span><br><span class="line"></span><br><span class="line">student</span><br><span class="line">    .flatMap &#123;</span><br><span class="line">        <span class="variable">$0</span>.score</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">student.onNext(ryan)</span><br><span class="line">ryan.score.onNext(<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">student.onNext(charlotte)</span><br><span class="line">ryan.score.onNext(<span class="number">95</span>)</span><br><span class="line"></span><br><span class="line">charlotte.score.onNext(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<p>What makes</p>
<p>flatMapLatest different is that it will automatically switch to the latest observable and</p>
<p>unsubscribe from the the previous one.</p>
<p><code>flatMapLatest</code> 和 <code>flatMap</code> 略有不同之处是它会自动切换到最后一个 Observable，注销订阅之前的 Observable。</p>
<p><img src="https://gewill.org/assets/flatMapLatest.jpg" alt="flatMapLatest"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ryan <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">80</span>))</span><br><span class="line"><span class="keyword">let</span> charlotte <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">Student</span>&gt;()</span><br><span class="line"></span><br><span class="line">student</span><br><span class="line">    .flatMapLatest &#123;</span><br><span class="line">        <span class="variable">$0</span>.score</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">student.onNext(ryan)</span><br><span class="line"></span><br><span class="line">ryan.score.onNext(<span class="number">85</span>)</span><br><span class="line"></span><br><span class="line">student.onNext(charlotte)</span><br><span class="line"></span><br><span class="line">ryan.score.onNext(<span class="number">95</span>)</span><br><span class="line"></span><br><span class="line">charlotte.score.onNext(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only one thing to point out here that’s different from the previous example of flatMap:</span></span><br><span class="line"><span class="comment">// Changing ryan’s score here will have no effect. It will not be printed out. This is because flatMapLatest has already switched to the latest observable, for charlotte.</span></span><br></pre></td></tr></table></figure>



<h3 id="观察事件"><a href="#观察事件" class="headerlink" title="观察事件"></a>观察事件</h3><p>使用具体化运算符 <code>materialize</code>, 可以将 Observable 发射的每个事件包装成 Observable。比如下面的例子中 <code>$0.score.materialize()</code>  将 <code>BehaviorSubject&lt;Int&gt;</code> 封装为  <code>Observable&lt;Event&lt;Int&gt;&gt;</code> 。这样的话，我的就可以自己处理 .error 和 .complete 事件，而不终结该 Observable 。</p>
<p>对应的我们再使用 <code>.dematerialize()</code>  转回 <code>Observable&lt;Int&gt;</code> ，即可正常订阅。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> anError</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ryan <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">80</span>))</span><br><span class="line"><span class="keyword">let</span> charlotte <span class="operator">=</span> <span class="type">Student</span>(score: <span class="type">BehaviorSubject</span>(value: <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> student: <span class="type">BehaviorSubject</span>&lt;<span class="type">Student</span>&gt; <span class="operator">=</span> <span class="type">BehaviorSubject</span>(value: ryan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> studentScore: <span class="type">Observable</span>&lt;<span class="type">Event</span>&lt;<span class="type">Int</span>&gt;&gt; <span class="operator">=</span> student</span><br><span class="line">    .flatMapLatest &#123;</span><br><span class="line">        <span class="variable">$0</span>.score.materialize()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">studentScore</span><br><span class="line">    .filter &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="variable">$0</span>.error <span class="operator">==</span> <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="variable">$0</span>.error<span class="operator">!</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    .dematerialize()</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;subscribe: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">ryan.score.onNext(<span class="number">85</span>)</span><br><span class="line">ryan.score.onError(<span class="type">MyError</span>.anError)</span><br><span class="line">ryan.score.onNext(<span class="number">90</span>)</span><br><span class="line">student.onNext(charlotte)</span><br></pre></td></tr></table></figure>

<p>Console 输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subscribe: 80</span><br><span class="line">subscribe: 85</span><br><span class="line">anError</span><br><span class="line">subscribe: 100</span><br></pre></td></tr></table></figure>

<h2 id="第八章：Transforming-实践"><a href="#第八章：Transforming-实践" class="headerlink" title="第八章：Transforming 实践"></a>第八章：Transforming 实践</h2><p>在上一章中学习了 RxSwift 的主要功能，包括：map 和 flatMap 。</p>
<h3 id="开始-GitFeed-项目"><a href="#开始-GitFeed-项目" class="headerlink" title="开始 GitFeed 项目"></a>开始 GitFeed 项目</h3><p>本章中要处理的项目将显示 GitHub 仓库的动态, 如所有最新的 like, fork 和 comment.。</p>
<p>该项目将有两个不同的故事情节:</p>
<ul>
<li>主要的情节是要接触到 GitHub 的 JSON API, 接收 JSON 响应, 并最终将其转换为对象集合.    </li>
<li>次要将提取的对象保存到磁盘并在 “新” 活动列表之前的表中显示它们。从服务器获取事件。</li>
</ul>
<h3 id="网络获取数据"><a href="#网络获取数据" class="headerlink" title="网络获取数据"></a>网络获取数据</h3><p>我们将会将 URLSession 添加个响应式拓展。</p>
<p><img src="https://gewill.org/assets/CocoaAPIToRxAPI.jpeg" alt="CocoaAPIToRxAPI"></p>
<p>具体就是把网络API的请求和响应分别封装起来：</p>
<p>其中 <code>share(replay:, scope:)</code> ，可以避免 <code>URLSession.rx.response(request:)</code> 因过早 .complete 造成订阅时重新发送网络请求。原理就是封装多个 Observable 的元素为一个新的 Observable，并指定缓冲区最大元素数量，生命周期。定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">share</span>(<span class="params">replay</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="keyword">default</span>, <span class="params">scope</span>: <span class="type">SubjectLifetimeScope</span> <span class="operator">=</span> <span class="keyword">default</span>)</span><br></pre></td></tr></table></figure>

<p>代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchEvents</span>(<span class="params">repo</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    	<span class="comment">// 1. 使用 map 构造一个请求</span></span><br><span class="line">        <span class="keyword">let</span> response <span class="operator">=</span> <span class="type">Observable</span>.from([repo])</span><br><span class="line">            .map &#123; urlString -&gt; <span class="type">URL</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> <span class="type">URL</span>(string: <span class="string">&quot;https://api.github.com/repos/<span class="subst">\(urlString)</span>/events&quot;</span>)<span class="operator">!</span></span><br><span class="line">            &#125;</span><br><span class="line">            .map &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] url -&gt; <span class="type">URLRequest</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> modifiedHeader <span class="operator">=</span> <span class="keyword">self</span><span class="operator">?</span>.lastModified.value &#123;</span><br><span class="line">                    request.addValue(modifiedHeader <span class="keyword">as</span> <span class="type">String</span>,</span><br><span class="line">                        forHTTPHeaderField: <span class="string">&quot;Last-Modified&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> request</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; request -&gt; <span class="type">Observable</span>&lt;(response: <span class="type">HTTPURLResponse</span>, data: <span class="type">Data</span>)&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> <span class="type">URLSession</span>.shared.rx.response(request: request)</span><br><span class="line">            &#125;</span><br><span class="line">            .share(replay: <span class="number">1</span>, scope: .whileConnected)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 转换响应</span></span><br><span class="line">        response</span><br><span class="line">            .filter &#123; response, <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                 <span class="comment">// 检查右边的值是否在左边的 range 内</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">200</span><span class="operator">..&lt;</span><span class="number">300</span> <span class="operator">~=</span> response.statusCode</span><br><span class="line">            &#125;</span><br><span class="line">            .map &#123; <span class="keyword">_</span>, data -&gt; [[<span class="type">String</span>: <span class="keyword">Any</span>]] <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> jsonObject <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">JSONSerialization</span>.jsonObject(with: data, options: []),</span><br><span class="line">                    <span class="keyword">let</span> result <span class="operator">=</span> jsonObject <span class="keyword">as?</span> [[<span class="type">String</span>: <span class="keyword">Any</span>]] <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> []</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            &#125;</span><br><span class="line">            .filter &#123; objects <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> objects.count <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            .map &#123; objects <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> objects.flatMap(<span class="type">Event</span>.<span class="keyword">init</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] newEvents <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span><span class="operator">?</span>.processEvents(newEvents)</span><br><span class="line">            &#125;)</span><br><span class="line">            .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">        response</span><br><span class="line">            .filter &#123; response, <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">200</span><span class="operator">..&lt;</span><span class="number">400</span> <span class="operator">~=</span> response.statusCode</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; response, <span class="keyword">_</span> -&gt; <span class="type">Observable</span>&lt;<span class="type">NSString</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> value <span class="operator">=</span> response.allHeaderFields[<span class="string">&quot;Last-Modified&quot;</span>] <span class="keyword">as?</span> <span class="type">NSString</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Observable</span>.empty()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Observable</span>.just(value)</span><br><span class="line">            &#125;</span><br><span class="line">            .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] modifiedHeader <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf <span class="operator">=</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                strongSelf.lastModified.value <span class="operator">=</span> modifiedHeader</span><br><span class="line">                <span class="keyword">try?</span> modifiedHeader.write(to: strongSelf.modifiedFileURL, atomically: <span class="literal">true</span>,</span><br><span class="line">                    encoding: <span class="type">String</span>.<span class="type">Encoding</span>.utf8.rawValue)</span><br><span class="line">            &#125;)</span><br><span class="line">            .disposed(by: bag)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="第九章：合并Operator"><a href="#第九章：合并Operator" class="headerlink" title="第九章：合并Operator"></a>第九章：合并Operator</h2><p>在前面的章节中, 你学习了如何创建、ﬁlter 和转换可观察序列。RxSwift ﬁltering 和转换运算符的行为与 Swift 的标准集合运算符非常相似。你看到了 RxSwift 与 flatMap 的真正力量, 它让你用很少的代码执行很多任务.   </p>
<p>这一章将向你展示几种不同的组合序列的方法, 以及如何在每个序列中组合数据。你将使用的一些操作员与 Swift 集合操作员非常相似。它们有助于结合异步序列中的元素, 就像使用 Swift 数组一样。</p>
<h3 id="前缀和串联"><a href="#前缀和串联" class="headerlink" title="前缀和串联"></a>前缀和串联</h3><p>从 <code>startWith(_:)</code> 运算符赋值给定初始值的可观察序列。此值必须与可观察元素的类型相同。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> numbers.startWith(<span class="number">1</span>) observable.subscribe(onNext: &#123; value <span class="keyword">in</span> <span class="built_in">print</span>(value) &#125;)</span><br></pre></td></tr></table></figure>

<p>类似地 <code>.concat(_:)</code> 可以合并两个序列。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> first <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="keyword">let</span> second <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>.concat([first, second])</span><br><span class="line">observable.subscribe(onNext: &#123; value <span class="keyword">in</span> <span class="built_in">print</span>(value) &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><p>Merge 也是合并，不过会按照顺序发射事件。</p>
<p><img src="https://gewill.org/assets/merge.jpg" alt="merge"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> left <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> right <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> source <span class="operator">=</span> <span class="type">Observable</span>.of(left.asObservable(), right.asObservable())</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> source.merge()</span><br><span class="line"><span class="keyword">let</span> disposable <span class="operator">=</span> observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> leftValues <span class="operator">=</span> [<span class="string">&quot;Berlin&quot;</span>, <span class="string">&quot;Munich&quot;</span>, <span class="string">&quot;Frankfurt&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> rightValues <span class="operator">=</span> [<span class="string">&quot;Madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span>, <span class="string">&quot;Valencia&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> arc4random_uniform(<span class="number">2</span>) <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="operator">!</span>leftValues.isEmpty &#123;</span><br><span class="line">            left.onNext(<span class="string">&quot;Left:  &quot;</span> <span class="operator">+</span> leftValues.removeFirst())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="operator">!</span>rightValues.isEmpty &#123;</span><br><span class="line">        right.onNext(<span class="string">&quot;Right: &quot;</span> <span class="operator">+</span> rightValues.removeFirst())</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> <span class="operator">!</span>leftValues.isEmpty <span class="operator">||</span> <span class="operator">!</span>rightValues.isEmpty</span><br><span class="line"></span><br><span class="line">disposable.dispose()</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Right: Madrid</span><br><span class="line">Right: Barcelona</span><br><span class="line">Left:  Berlin</span><br><span class="line">Left:  Munich</span><br><span class="line">Left:  Frankfurt</span><br><span class="line">Right: Valencia</span><br></pre></td></tr></table></figure>

<h3 id="Combining-元素"><a href="#Combining-元素" class="headerlink" title="Combining 元素"></a>Combining 元素</h3><p>RxSwift中一组基本的运算符是 <code>combineLatest</code> 。他们组合来自几个序列的值：</p>
<p><img src="https://gewill.org/assets/Combining%20elements.jpg" alt="Combining elements"></p>
<p>Every time one of the inner (combined) sequences emits a value, it calls a closure you provide. You receive the last value from each of the inner sequences. This has many concrete applications, such as observing several text ﬁelds at once and combining their value, watching the status of multiple sources, and so on.</p>
<p>每当内部（组合）序列中的一个发出一个值时，它会调用您提供的闭包。 你会收到每个内部序列的最后一个值。 这里有很多具体的应用场景，例如一次观察几个文本字段并结合它们的价值，观察多个来源的状态等等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> left <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> right <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>.combineLatest(left, right, resultSelector: &#123;</span><br><span class="line">    lastLeft, lastRight <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;<span class="subst">\(lastLeft)</span> <span class="subst">\(lastRight)</span>&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> disposable <span class="operator">=</span> observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&gt; Sending a value to Left&quot;</span>)</span><br><span class="line">left.onNext(<span class="string">&quot;Hello,&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&gt; Sending a value to Right&quot;</span>)</span><br><span class="line">right.onNext(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&gt; Sending another value to Right&quot;</span>)</span><br><span class="line">right.onNext(<span class="string">&quot;RxSwift&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&gt; Sending another value to Left&quot;</span>)</span><br><span class="line">left.onNext(<span class="string">&quot;Have a good day,&quot;</span>)</span><br><span class="line"></span><br><span class="line">disposable.dispose()</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; Sending a value to Left</span><br><span class="line">&gt; Sending a value to Right</span><br><span class="line">Hello, world</span><br><span class="line">&gt; Sending another value to Right</span><br><span class="line">Hello, RxSwift</span><br><span class="line">&gt; Sending another value to Left</span><br><span class="line">Have a good day, RxSwift</span><br></pre></td></tr></table></figure>

<p><code>zip</code> 总是按照顺序一对一对的组合。类似把两个数组按照相同的下标进行组合。</p>
<p> <img src="https://gewill.org/assets/zip.jpg" alt="zip"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Weather</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> cloudy</span><br><span class="line">    <span class="keyword">case</span> sunny</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> left: <span class="type">Observable</span>&lt;<span class="type">Weather</span>&gt; <span class="operator">=</span> <span class="type">Observable</span>.of(.sunny, .cloudy, .cloudy, .sunny)</span><br><span class="line"><span class="keyword">let</span> right <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="string">&quot;Lisbon&quot;</span>, <span class="string">&quot;Copenhagen&quot;</span>, <span class="string">&quot;London&quot;</span>, <span class="string">&quot;Madrid&quot;</span>, <span class="string">&quot;Vienna&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>.zip(left, right) &#123; weather, city <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;It&#x27;s <span class="subst">\(weather)</span> in <span class="subst">\(city)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">It&#x27;s sunny in Lisbon</span><br><span class="line">It&#x27;s cloudy in Copenhagen</span><br><span class="line">It&#x27;s cloudy in London</span><br><span class="line">It&#x27;s sunny in Madrid</span><br></pre></td></tr></table></figure>

<h3 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h3><p>应用程序有不同的需求，必须管理多个输入源。 你经常需要立即接受来自多个观察对象的输入。 有些会简单地在代码中触发行为，而其他的将提供数据。 RxSwift 已经覆盖了强大的运算符这会让你的生活更轻松。 或者，至少你的编码生活！</p>
<p>首先看看 <code>withLatestFrom(_:)</code>。 经常被初学者忽略，它在处理用户界面等方面是一个有用的配套工具。<img src="https://gewill.org/assets/trigger.jpg" alt="trigger"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> button <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">Void</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> textField <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> button.withLatestFrom(textField)</span><br><span class="line"><span class="keyword">_</span> <span class="operator">=</span> observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">textField.onNext(<span class="string">&quot;Par&quot;</span>)</span><br><span class="line">textField.onNext(<span class="string">&quot;Pari&quot;</span>)</span><br><span class="line">textField.onNext(<span class="string">&quot;Paris&quot;</span>)</span><br><span class="line">button.onNext(())</span><br><span class="line">button.onNext(())</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Paris</span><br><span class="line">Paris</span><br></pre></td></tr></table></figure>

<p><code>sample(_:)</code> 和 几乎只有一个变化：每当触发器observable发射一个值时，<code>sample(_:)</code> 从其它的可观察值发出最新值，但只有在自上一次元素后才到达。 如果没有新的数据到达，<code>sample(_:)</code> 将不会发射任何东西。<img src="https://gewill.org/assets/sample.jpg" alt="sample"></p>
<h3 id="Switches"><a href="#Switches" class="headerlink" title="Switches"></a>Switches</h3><p><img src="https://gewill.org/assets/Switches.jpg" alt="Switches"></p>
<p><code>amb(_:)</code> 运算符订阅左侧和右侧的可观察序列。 它等待其中任何一个发出一个元素，然后退订另一个序列。 之后，它只传递第一个活动可观察元素。 它可以从模棱两可中选出一个：首先，你不知道你感兴趣的是哪一个序列，等其中先发射一个序列再做决定。</p>
<p>这个运算符经常被忽视。 它有一些精选的实际应用场景，如连接到冗余服务器，并坚持使用第一个响应的服务器。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> left <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> right <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> left.amb(right)</span><br><span class="line"><span class="keyword">let</span> disposable <span class="operator">=</span> observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">left.onNext(<span class="string">&quot;Lisbon&quot;</span>)</span><br><span class="line">right.onNext(<span class="string">&quot;Copenhagen&quot;</span>)</span><br><span class="line">left.onNext(<span class="string">&quot;London&quot;</span>)</span><br><span class="line">left.onNext(<span class="string">&quot;Madrid&quot;</span>)</span><br><span class="line">right.onNext(<span class="string">&quot;Vienna&quot;</span>)</span><br><span class="line"></span><br><span class="line">disposable.dispose()</span><br></pre></td></tr></table></figure>



<p>更流行的选项是 <code>switchLatest()</code> 运算符：</p>
<p>可以自由切换偏爱那个子序列发射的元素。<img src="https://gewill.org/assets/switchLatest.jpg" alt="switchLatest"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> one <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> two <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> three <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> source <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">Observable</span>&lt;<span class="type">String</span>&gt;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> source.switchLatest()</span><br><span class="line"><span class="keyword">let</span> disposable <span class="operator">=</span> observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">source.onNext(one)</span><br><span class="line">one.onNext(<span class="string">&quot;Some text from sequence one&quot;</span>)</span><br><span class="line">two.onNext(<span class="string">&quot;Some text from sequence two&quot;</span>)</span><br><span class="line"></span><br><span class="line">source.onNext(two)</span><br><span class="line">two.onNext(<span class="string">&quot;More text from sequence two&quot;</span>)</span><br><span class="line">one.onNext(<span class="string">&quot;and also from sequence one&quot;</span>)</span><br><span class="line"></span><br><span class="line">source.onNext(three)</span><br><span class="line">two.onNext(<span class="string">&quot;Why don&#x27;t you seem me?&quot;</span>)</span><br><span class="line">one.onNext(<span class="string">&quot;I&#x27;m alone, help me&quot;</span>)</span><br><span class="line">three.onNext(<span class="string">&quot;Hey it&#x27;s three. I win.&quot;</span>)</span><br><span class="line"></span><br><span class="line">source.onNext(one)</span><br><span class="line">one.onNext(<span class="string">&quot;Nope. It&#x27;s me, one!&quot;</span>)</span><br><span class="line"></span><br><span class="line">disposable.dispose()</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Some text from sequence one</span><br><span class="line">More text from sequence two</span><br><span class="line">Hey it&#x27;s three. I win.</span><br><span class="line">Nope. It&#x27;s me, one!</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>形成可观察序列的心智模型可能很困难。 别担心， 你会习惯它。 <strong>练习是顺序理解序列的关键</strong>。 随着您的体验增长，请随时审查这些示例！ 你将在下一章中更好地了解如何使用它。</p>
<h3 id="Combining-一个序列中元素"><a href="#Combining-一个序列中元素" class="headerlink" title="Combining 一个序列中元素"></a>Combining 一个序列中元素</h3><p>所有的厨师都知道你减少得越多，酱汁就越美味。 虽然不是针对厨师，但 RxSwift 拥有将酱汁减少到最有味道的组分的工具。</p>
<p><code>reduce(_:_:)</code> 和 Swift 标准库中类似。<img src="https://gewill.org/assets/reduce.jpg" alt="reduce"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> source <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>)</span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> source.reduce(<span class="number">0</span>, accumulator: &#123; summary, newValue <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> summary <span class="operator">+</span> newValue</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">25</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>scan(_:accumulator:)</code> 和<code>reduce(_:_:)</code> 只有一个最终结果不同：每次发射事件，都会计算结果并发射。<img src="https://gewill.org/assets/scan.jpg" alt="scan"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> source <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> source.scan(<span class="number">0</span>, accumulator: <span class="operator">+</span>)</span><br><span class="line">observable.subscribe(onNext: &#123; value <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Console 输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">4</span><br><span class="line">9</span><br><span class="line">16</span><br><span class="line">25</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="第十章：合并Operator实践"><a href="#第十章：合并Operator实践" class="headerlink" title="第十章：合并Operator实践"></a>第十章：合并Operator实践</h2><p>在前一章中，你学习了将操作符合并，并通过对一些相当令人头脑灵活的概念进行越来越详细的练习。 一些运算符可能会让你对这些反应性概念的真实应用感到疑惑。<br>在“……实践”一章中，你将有机会尝试一些最强大的运算符。 你将学会解决类似于你在自己的应用程序中遇到的问题。</p>
<h3 id="准备网络后端服务"><a href="#准备网络后端服务" class="headerlink" title="准备网络后端服务"></a>准备网络后端服务</h3><p>这里使用NASA的EONET服务。</p>
<p>我们称之为EONET服务。 它抽象访问由EONET服务器公开的数据，将它们作为服务提供给你的应用程序。 你会看到，结合Rx，这种模式将找到许多应用程序。 它可以让你在应用程序内清晰地分离数据生产和消耗。 你可以轻松替换或模拟生产环境，而不会对用户方面产生任何影响。</p>
<p>先封装一个通用网络请求，然后把 categories 封装为单例，方便所有订阅者订阅。</p>
<h3 id="Categories-view-controller"><a href="#Categories-view-controller" class="headerlink" title="Categories view controller"></a>Categories view controller</h3><p>categories view controller 显示 categories 列表。</p>
<h3 id="Adding-the-event-download-service"><a href="#Adding-the-event-download-service" class="headerlink" title="Adding the event download service"></a>Adding the event download service</h3><h3 id="Getting-events-for-categories"><a href="#Getting-events-for-categories" class="headerlink" title="Getting events for categories"></a>Getting events for categories</h3><h3 id="Events-view-controller"><a href="#Events-view-controller" class="headerlink" title="Events view controller"></a>Events view controller</h3><h3 id="Wiring-the-days-selector"><a href="#Wiring-the-days-selector" class="headerlink" title="Wiring the days selector"></a>Wiring the days selector</h3><h3 id="Splitting-event-downloads"><a href="#Splitting-event-downloads" class="headerlink" title="Splitting event downloads"></a>Splitting event downloads</h3><h2 id="第十一章：基于时间的Operator"><a href="#第十一章：基于时间的Operator" class="headerlink" title="第十一章：基于时间的Operator"></a>第十一章：基于时间的Operator</h2><p>时间就是一切。响应式编程背后的核心思想是基于时间异步数据流的模型。在这方面, RxSwift 提供了一系列操作, 使你能够处理时间和序列在一段时间内的响应和转换方式。正如你将在本章中看到的, 管理序列的时间维度是简单而直接的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/18/RxSwift-I/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/18/RxSwift-I/" class="post-title-link" itemprop="url">RxSwift I：开始学习 RxSwift</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-05-18 23:01:03" itemprop="dateCreated datePublished" datetime="2018-05-18T23:01:03+08:00">2018-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/RxSwift/" itemprop="url" rel="index"><span itemprop="name">RxSwift</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="📒RxSwift-I：开始学习-RxSwift"><a href="#📒RxSwift-I：开始学习-RxSwift" class="headerlink" title="📒RxSwift I：开始学习 RxSwift"></a>📒<strong>RxSwift</strong> I：开始学习 RxSwift</h1><p> <img src="https://gewill.org/assets/Rx_Logo_M.png" alt="Rx_Logo_M.png"></p>
<h2 id="第一章：RxSwift-介绍"><a href="#第一章：RxSwift-介绍" class="headerlink" title="第一章：RxSwift 介绍"></a>第一章：RxSwift 介绍</h2><p>RxSwift是一个组合异步和事件驱动编程的库，通过使用可观察序列和功能样式运算符来，从而允许通过调度程序进行参数化执行。</p>
<p>RxSwift 在本质上简化了开发异步程序，允许代码对新数据作出反应，并以顺序和孤立的方式处理它。</p>
<h3 id="介绍异步编程"><a href="#介绍异步编程" class="headerlink" title="介绍异步编程"></a>介绍异步编程</h3><p><img src="https://gewill.org/assets/51526546882_.pic.jpg" alt="51526546882_.pic.jpg"></p>
<p>使用 Cocoa 和 UIKit 异步的API的问题在于：复杂的异步代码变得非常难写，部分原因是苹果SDK提供的API种类繁多。如NotificationCenter、Delegate、GCD、闭包、Combine。</p>
<p>异步编程词汇表：</p>
<ol>
<li>状态（State），具体地说：共享可变状态</li>
<li>命令式编程（Imperative programming）</li>
<li>副作用（Side effects）</li>
<li>声明式编程（Declarative code）：声明式代码让您可以定义行为片段。只要有相关事件发生，RxSwift 就会运行这些行为，并提供一个不可变的、孤立的数据片段来处理。这样，您可以使用异步代码，但做出与简单 for 循环相同的假设：您正在使用不可变数据并且可以以顺序、确定的方式执行代码。</li>
<li>响应式系统（Reactive systems）</li>
</ol>
<p>响应式系统（Reactive systems）是一个相当抽象的术语，它涵盖了Web或iOS应用程序，它们显示了大多数或全部以下特性：</p>
<ul>
<li>响应式设计（Responsive）：始终保持UI更新，代表了最新的应用程序状态。</li>
<li>能复原的（Resilient）：每个行为都是独立定义的，并提供灵活的错误恢复。</li>
<li>灵活的（Elastic）: 该代码处理不同的工作负载，通常实现诸如懒惰驱动数据收集、事件节流和资源共享等特性。</li>
<li>消息驱动（Message driven）：组件使用基于消息的通信来提高可重用性和隔离性，解耦类的生命周期和实现。</li>
</ul>
<h3 id="RxSwift-基础"><a href="#RxSwift-基础" class="headerlink" title="RxSwift 基础"></a>RxSwift 基础</h3><p><img src="https://gewill.org/assets/61526549641_.pic_hd.jpg" alt="61526549641_.pic_hd.jpg"></p>
<p>这个标志是一只电鳗。(Rx 项目曾经被称为Volta）</p>
<p>RxSwift 是微软开源的 ReactiveX 的Swift语言的实现。</p>
<p><strong>RxSwift</strong> 在传统的<strong>Cocoa</strong>编程和纯函数编程之间找到了最佳位置。它允许您对事件作出反应, 方法是使用不可变的代码定义以确定性的、可组合的方式处理异步输入部分。</p>
<p>Rx代码的三个组成部分是 <code>Observable</code>, <code>Operator</code>和 <code>Scheduler</code>。</p>
<p><code>Observable&lt;Element&gt;</code>类提供了Rx代码的基础：异步产生一系列事件的能力，它可以“携带”数据的不可变快照。简单来说，它允许类在一段时间内订阅其他类发出的值。</p>
<p><code>ObservableType</code> 协议 (<code>Observable</code>需要遵循的) 非常简单。<code>Observable</code>可能发出 (并且<code>Observer</code>能接受) 仅三类型事件:</p>
<p>- next 下一个事件: “携带” 最新 (或  “下一个 “) 数据值的事件。这是<code>Observer</code> “接收” 值的方式。</p>
<p>- completed 已完成的事件: 此事件以成功终止事件序列。这意味着<code>Observable</code>完成其生命周期成功, 不会发出任何其他事件。</p>
<p>- error 错误事件: <code>Observable</code>终止带有错误, 不会发出其他事件.</p>
<p>两种不同的可观测序列: 有限和无限的。</p>
<p>由于它们是高度解耦和可组合的, 所以这些方法通常称为<code>Operator</code>。比如filter。</p>
<p><code>Operator</code>也是高度可组合的，它们总是把数据作为输入并输出它们的结果，所以你可以用许多不同的方式轻松地将它们连接起来，实现比单个<code>Operator</code>自己能做的更多的事情。</p>
<p> <code>Scheduler</code>是<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/DISPATCH">GCD</a>和<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/operationqueue">OperationQueue</a>的Rx等价物。</p>
<p>RxSwift将充当你的订阅（在左边）和<code>Scheduler</code>（在右边）之间的调度器，将工件发送到正确的上下文，并无缝地允许它们与彼此的输出一起工作。</p>
<p><img src="https://gewill.org/assets/71526551674_.pic_hd.jpg" alt="71526551674_.pic_hd.jpg"></p>
<p>要读取此关系图, 请在不同的计划程序中按预定的顺序 (1、2、3、…) 来执行彩色作品。例如:</p>
<p>·蓝色网络订阅以在基于自定义 NSOperation 的计划程序上运行的一段代码 (1) 开始。</p>
<p>·数据输出块作为下一个块 (2) 的输入, 它运行在一个不同的调度程序上, 它位于并发后台 GCD 队列中。</p>
<p>·最后, 在主线程调度程序上计划最后一块蓝色代码 (3), 以便用新数据更新 UI。</p>
<h3 id="App-architecture-应用的架构"><a href="#App-architecture-应用的架构" class="headerlink" title="App architecture 应用的架构"></a>App architecture 应用的架构</h3><p>值得一提的是，RxSwift并没有以任何方式改变应用程序的架构；它主要处理事件、异步数据序列和通用通信协议。</p>
<p>通过在苹果开发文档中实现MVC体系结构，可以创建具有Rx的应用程序。如果你喜欢的话，你也可以选择实现MVP架构或MVVM。RxSwift也可以帮你实现自己的单向数据架构。</p>
<p>微软的MVVM架构是专门针对在平台上创建的事件驱动软件开发的，该平台提供数据绑定。RxSwift和MVVM很好地结合在一起，在这本书的末尾，你会看到这个模式以及如何用RxSwift来实现它。</p>
<p>MVVM和RxSwift结合在一起的原因是，ViewModel允许您公开<code>Observable</code>属性，这些属性可以直接绑定到View Controller 代码中的UIKit控件。这使得绑定模型数据到UI非常简单地展示和编码：</p>
<p><img src="https://gewill.org/assets/81526552550_.pic.jpg" alt="81526552550_.pic.jpg"></p>
<p>本书中的所有其他示例都使用MVC架构来保持示例代码简单易懂。</p>
<h3 id="RxCocoa"><a href="#RxCocoa" class="headerlink" title="RxCocoa"></a>RxCocoa</h3><p>RxSwift是通用Rx API的实现。因此，它不涉及任何Cocoa或UIKit类。</p>
<p>RxCocoa是RxSwift的配套库，所有的类都有助于UIKit和Cocoa的开发。除了具有一些高级类之外，RxCocoa还为许多UI组件添加了响应式扩展，以便您可以订阅不同的UI事件。</p>
<p>例如，使用RxCocoa订阅UISwitch的状态变化是非常容易的，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">toggleSwitch.rx.isOn</span><br><span class="line">	.subcribe(onNext: &#123;enabled <span class="keyword">in</span></span><br><span class="line">    	<span class="built_in">print</span>(enabled <span class="operator">?</span> <span class="string">&quot;it&#x27;s ON&quot;</span> : <span class="string">&quot;it&#x27;s OFF&quot;</span>)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<p>RxCocoa adds the rx.isOn property (among others) to the UISwitch class so you can subscribe to generally useful event sequences.</p>
<p>RxCocoa将rx.isOn属性（其中之一）添加到UISwitch类，这样您就可以订阅通常有用的<code>Observable</code>序列。</p>
<p><img src="https://gewill.org/assets/101526552877_.pic.jpg" alt="101526552877_.pic.jpg"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>官方git：<a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxSwift">https://github.com/ReactiveX/RxSwift</a></p>
<p>使用 <a target="_blank" rel="noopener" href="https://guides.cocoapods.org/using/using-cocoapods.html">CocoaPods</a> 、 <a target="_blank" rel="noopener" href="https://github.com/Carthage/Carthage">Carthage</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-package-manager">Swift Package Manager</a> 均很方便集成RxSwift。</p>
<h3 id="RxSwift-和-Combine"><a href="#RxSwift-和-Combine" class="headerlink" title="RxSwift 和 Combine"></a>RxSwift 和 Combine</h3><p>RxSwift 和 Combine（以及 Swift 中的其他相应式编程框架）共享许多通用语言和非常相似的概念。</p>
<p>RxSwift是一个较旧的，完善的框架，具有一些自己的原始概念，运算符名称和类型多样性，这主要是由于其多平台跨语言标准，该标准也适用于Linux，这对于Server-Side Swift非常有用。它也是开源的，所以如果你愿意，你可以直接为其核心做出贡献，并确切地看到它的特定部分是如何工作的。它与所有支持 Swift 的 Apple 平台版本兼容，一直支持 iOS 8。</p>
<p>Combine 是 Apple 新的、闪亮的框架，涵盖了类似的概念，但专门针对 Swift 和 Apple 自己的平台量身定制。它与 Swift 标准库共享许多通用语言，因此即使新手也觉得 API 非常熟悉。它仅支持从iOS 13，macOS 10.15等开始的较新的Apple平台。不幸的是，截至今天，它还没有开源，并且不支持Linux。</p>
<p>幸运的是，由于 RxSwift 和 Combine 非常相似，因此您的 RxSwift 知识可以轻松转移到 Combine，反之亦然。RxCombine（<a target="_blank" rel="noopener" href="https://github.com/CombineCommunity/RxCombine%EF%BC%89%E7%AD%89%E9%A1%B9%E7%9B%AE%E5%85%81%E8%AE%B8%E6%82%A8%E6%A0%B9%E6%8D%AE%E9%9C%80%E8%A6%81%E6%B7%B7%E5%90%88%E6%90%AD%E9%85%8D">https://github.com/CombineCommunity/RxCombine）等项目允许您根据需要混合搭配</a> RxSwift Observables 和 Combine Publishers。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxSwift/releases/tag/6.5.0">RxSwift 6.5.0</a> 也迎来了 Swift Concurrency 的支持。提供了互操作性：</p>
<ol>
<li><code>await  </code> 调用<code>Observable</code>的<code>values</code></li>
<li>封装 <code>async</code> Task 为 <code>Observable</code></li>
</ol>
<h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><p>RxSwift社区非常友好，思想开放，并且热衷于讨论模式，常用技巧或互相帮助。</p>
<p>更多的Rx库和实验，像雨后春笋一样的涌现，可以在这里找到：<a target="_blank" rel="noopener" href="https://github.com/RxSwiftCommunity">https://github.com/RxSwiftCommunity</a></p>
<p>可能最好的方式来满足许多对RxSwift感兴趣的人，这是Slack的频道：<a target="_blank" rel="noopener" href="http://rxswift-slack.herokuapp.com/">http://rxswift-slack.herokuapp.com</a>。</p>
<p>Slack频道拥有约5000名成员！ 日常的主题包括：互相帮助，讨论RxSwift或其同伴库的潜在新功能，以及共享RxSwift博客文章和会议讲座。</p>
<h2 id="第二章：Observables"><a href="#第二章：Observables" class="headerlink" title="第二章：Observables"></a>第二章：Observables</h2><h3 id="Observable-是什么"><a href="#Observable-是什么" class="headerlink" title="Observable 是什么"></a>Observable 是什么</h3><p>Observable、observable sequence 和 sequence 在 Rx 都是一个意思。或者在其他Rx实现中称之为stream。</p>
<blockquote>
<p>最好称之为 Observable，不过翻译过来还是序列顺口些。</p>
</blockquote>
<h3 id="Observable-的生命周期"><a href="#Observable-的生命周期" class="headerlink" title="Observable 的生命周期"></a>Observable 的生命周期</h3><ul>
<li>observable发出包含元素的<strong>next</strong>事件。 它可以继续这样做，直到它：</li>
<li>…发出<strong>error</strong>事件并终止，或</li>
<li>…发出<strong>completed</strong>事件并终止。</li>
<li>一旦observable被终止，它不能再发出事件。</li>
</ul>
<p>将这种概念化的最佳方法之一是使用弹珠图（<strong>Marble Diagrams</strong> 基于时间轴上绘制的值）。</p>
<p><img src="https://gewill.org/assets/141526623515_.pic.jpg" alt="141526623515_.pic.jpg"></p>
<p><img src="https://gewill.org/assets/151526623523_.pic.jpg" alt="151526623523_.pic.jpg"></p>
<h3 id="创建-Observable"><a href="#创建-Observable" class="headerlink" title="创建 Observable"></a><strong>创建</strong> <strong>Observable</strong></h3><p>类型擦除的ObservableType，也就是 Swift 中的泛型。</p>
<p>它代表了一种推式风格队列。</p>
<p>let observable: Observable<Int> &#x3D; Observable<Int>.just(one)</p>
<h3 id="订阅-Observable"><a href="#订阅-Observable" class="headerlink" title="订阅 Observable"></a><strong>订阅</strong> <strong>Observable</strong></h3><p>订阅observable sequence的事件处理程序。</p>
<p>func subscribe(_ on: @escaping (RxSwift.Event&lt;Self.E&gt;) -&gt; Swift.Void) -&gt; Disposable</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> one <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> two <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> three <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>.of(one, two, three)</span><br><span class="line"></span><br><span class="line">observable.subscribe(onNext: &#123; element <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(element)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在指定的范围内生成一个整数的observable sequence，使用指定的scheduler生成和发送<code>Observer</code>消息。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">range</span>(<span class="params">start</span>: <span class="keyword">Self</span>.<span class="type">E</span>, <span class="params">count</span>: <span class="keyword">Self</span>.<span class="type">E</span>, <span class="params">scheduler</span>: <span class="type">ImmediateSchedulerType</span> <span class="operator">=</span> <span class="keyword">default</span>) -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="keyword">Self</span>.<span class="type">E</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.range(start: <span class="number">1</span>, count: <span class="number">10</span>)</span><br><span class="line">observable</span><br><span class="line">    .subscribe(onNext: &#123; i <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> n <span class="operator">=</span> <span class="type">Double</span>(i)</span><br><span class="line">        <span class="keyword">let</span> fibonacci <span class="operator">=</span> <span class="type">Int</span>(((pow(<span class="number">1.61803</span>, n) <span class="operator">-</span> pow(<span class="number">0.61803</span>, n)) <span class="operator">/</span></span><br><span class="line">            <span class="number">2.23606</span>).rounded())</span><br><span class="line">        <span class="built_in">print</span>(fibonacci)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Disposing-和-terminating"><a href="#Disposing-和-terminating" class="headerlink" title="Disposing 和 terminating"></a><strong>Disposing 和 terminating</strong></h3><p>请记住, 在收到订阅之前, Observable的内容不会执行任何事情。它是触发一个Observable的开始发出事件的订阅, 直到它发出. error 或.completed完成事件并终止。您可以通过取消对它的订阅来手动终止Observable。</p>
<p><code>subscription.dispose()</code></p>
<p>单独管理每个订阅将是单调乏味的, 因此 RxSwift 引入 DisposeBag 类型。DisposeBag 持有 disposable协议的对象，通常是使用<code>.disposed(by:)</code> 方法, 并将调用dispose(), 当DisposeBag即将deallocated。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> observable <span class="operator">=</span> <span class="type">Observable</span>.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> observable.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">&#125;</span><br><span class="line">subscription.dispose()</span><br></pre></td></tr></table></figure>

<p>create操作符接受一个名为subscribe的参数。 它的工作是提供对可观察对象进行调用订阅的实现。 换句话说，它定义了将发送给订阅者的所有事件。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">create</span>(<span class="keyword">_</span> <span class="params">subscribe</span>: <span class="keyword">@escaping</span> (<span class="type">AnyObserver</span>&lt;<span class="type">String</span>&gt;) -&gt; <span class="type">Disposable</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建-observable-工厂类"><a href="#创建-observable-工厂类" class="headerlink" title="创建 observable 工厂类"></a><strong>创建 observable 工厂类</strong></h3><p>可以创建一个可观察的工厂，向每个订阅者发布一个新的Observable，而不是创建一个等待订阅者的Observable。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">deferred</span>(<span class="keyword">_</span> <span class="params">observableFactory</span>: <span class="keyword">@escaping</span> () <span class="keyword">throws</span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;) -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> flip <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> factory: <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> <span class="type">Observable</span>.deferred &#123;</span><br><span class="line">    flip <span class="operator">=</span> <span class="operator">!</span>flip</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> flip &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    factory.subscribe(onNext: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>, terminator: <span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">        .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">123 </span><br><span class="line">456 </span><br><span class="line">123 </span><br><span class="line">456</span><br></pre></td></tr></table></figure>

<h3 id="使用Traits"><a href="#使用Traits" class="headerlink" title="使用Traits"></a><strong>使用Traits</strong></h3><p><strong>Traits</strong>是具有比常规Observable更窄的行为集合的一种Observable。它们的使用是可选的；您可以在任何可能使用trait的地方使用常规Observable。他们的目的是提供一种给你的API或者代码的读者更清楚地表达意图的方式。 </p>
<p>RxSwift中有三种Traits: Single, Maybe 和 Completable.</p>
<p>Singles将发出.success(value)或.error事件。 .success(value)实际上是.next和.completed事件的组合。 这对于一次性进程非常有用，它可以成功并产生一个值或失败，例如下载数据或从磁盘加载数据。</p>
<p>下面的例子是读取 <code>Copyright.txt</code> 的文件内容：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">FileReadError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> fileNotFound, unreadable, encodingFailed</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">loadText</span>(<span class="params">from</span> <span class="params">filename</span>: <span class="type">String</span>) -&gt; <span class="type">Single</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Single</span>.create &#123; single <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> disposable <span class="operator">=</span> <span class="type">Disposables</span>.create()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">Bundle</span>.main.path(forResource: filename, ofType: <span class="string">&quot;txt&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">            single(.error(<span class="type">FileReadError</span>.fileNotFound))</span><br><span class="line">            <span class="keyword">return</span> disposable</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> data <span class="operator">=</span> <span class="type">FileManager</span>.default.contents(atPath: path) <span class="keyword">else</span> &#123;</span><br><span class="line">            single(.error(<span class="type">FileReadError</span>.unreadable))</span><br><span class="line">            <span class="keyword">return</span> disposable</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> contents <span class="operator">=</span> <span class="type">String</span>(data: data, encoding: .utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">            single(.error(<span class="type">FileReadError</span>.encodingFailed))</span><br><span class="line">            <span class="keyword">return</span> disposable</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        single(.success(contents))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> disposable</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loadText(from: <span class="string">&quot;Copyright&quot;</span>)</span><br><span class="line">    .subscribe &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="variable">$0</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="built_in">print</span>(string)</span><br><span class="line">        <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>



<h3 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a><strong>副作用</strong></h3><p> <code>do</code> Operator允许插入副作用，处理程序执行过程中并不会以任何方式更改发出的事件的操作。</p>
<h3 id="打印debug-信息"><a href="#打印debug-信息" class="headerlink" title="打印debug 信息"></a><strong>打印debug 信息</strong></h3><p><code>debug</code> Operator, 它将打印observable的每个事件的信息。</p>
<h2 id="第三章：Subjects"><a href="#第三章：Subjects" class="headerlink" title="第三章：Subjects"></a>第三章：Subjects</h2><h3 id="Subject-是什么"><a href="#Subject-是什么" class="headerlink" title="Subject 是什么"></a>Subject 是什么</h3><p>既可以作为<code>Observable</code>，也可以作为<code>Observer</code>，这就是所谓的 Subjects。</p>
<blockquote>
<p>也是最方便互操作的，<code>BehaviorRelay</code>比较常用。</p>
</blockquote>
<p>RxSwift 中有四个subject类型: </p>
<ol>
<li><code>PublishSubject</code>: 开始为空, 只向订阅者发出新元素. </li>
<li><code>ReplaySubject</code>: 用缓冲区大小, 并将保持元素的缓冲区大小, 并将其重播到新订阅者. </li>
<li><code>BehaviorSubject</code>: 从初始值开始, 将其重播或将最新的元素给新订阅者. </li>
<li><code>AsyncSubject</code>：仅发出序列中的最后一个next事件，并且仅当subject收到completed事件时才发出。这是一个很少使用的主题。</li>
</ol>
<h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents an object that is both an observable sequence as well as an observer.</span></span><br><span class="line"><span class="comment">/// Each notification is broadcasted to all subscribed observers.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">PublishSubject</span>&lt;<span class="title class_">Element</span>&gt;</span><br></pre></td></tr></table></figure>

<p>当你只是想让订阅者只接受在订阅的时候以后发生的新的事件，直到他们unsubscribe，或者subject已经terminated以.completed或.error事件的方式，PublishSubject就可以派上用场。</p>
<p><img src="https://gewill.org/assets/RxSwiftPublishSubject.jpg" alt="RxSwiftPublishSubject"></p>
<p>第一个订阅者在将 1 添加到subject后进行订阅，因此它不会收到该事件。不过，它确实得到了2和3。由于第二个订阅者在添加2之前不会加入，因此它只能获得3。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">ObservableType</span> &#123;</span><br><span class="line">    <span class="comment">/// 添加带有`id`的观察者并打印每个发出的事件。</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">addObserver</span>(<span class="keyword">_</span> <span class="params">id</span>: <span class="type">String</span>) -&gt; <span class="type">Disposable</span> &#123;</span><br><span class="line">        subscribe &#123; <span class="built_in">print</span>(<span class="string">&quot;观察者:&quot;</span>, id, <span class="string">&quot;事件:&quot;</span>, <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从订阅开始向所有观察者广播新事件。</span></span><br><span class="line">example(<span class="string">&quot;PublishSubject&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line">    <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;1&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐶&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐱&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;2&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅰️&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅱️&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    subject.onCompleted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- PublishSubject example ---</span><br><span class="line">观察者: 1 事件: next(🐶)</span><br><span class="line">观察者: 1 事件: next(🐱)</span><br><span class="line">观察者: 1 事件: next(🅰️)</span><br><span class="line">观察者: 2 事件: next(🅰️)</span><br><span class="line">观察者: 1 事件: next(🅱️)</span><br><span class="line">观察者: 2 事件: next(🅱️)</span><br><span class="line">观察者: 1 事件: completed</span><br><span class="line">观察者: 2 事件: completed</span><br></pre></td></tr></table></figure>

<h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents an object that is both an observable sequence as well as an observer.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Each notification is broadcasted to all subscribed and future observers, subject to buffer trimming policies.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplaySubject</span>&lt;<span class="title class_">Element</span>&gt;</span><br></pre></td></tr></table></figure>

<p>ReplaySubject将临时缓存, 或缓冲区, 它们发出的最新元素, 由您选择的 speciﬁed 大小决定。然后, 他们会将该缓冲区重播到新订阅者。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向所有观察者广播新事件，并向新观察者广播之前指定的bufferSize大小的事件数。</span></span><br><span class="line">example(<span class="string">&quot;ReplaySubject&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line">    <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">ReplaySubject</span>&lt;<span class="type">String</span>&gt;.create(bufferSize: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;1&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐶&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐱&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;2&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅰️&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅱️&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    subject.onCompleted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--- ReplaySubject example ---</span><br><span class="line">观察者: 1 事件: next(🐶)</span><br><span class="line">观察者: 1 事件: next(🐱)</span><br><span class="line">观察者: 2 事件: next(🐱) // 相比PublishSubject多了订阅前一个事件</span><br><span class="line">观察者: 1 事件: next(🅰️)</span><br><span class="line">观察者: 2 事件: next(🅰️)</span><br><span class="line">观察者: 1 事件: next(🅱️)</span><br><span class="line">观察者: 2 事件: next(🅱️)</span><br><span class="line">观察者: 1 事件: completed</span><br><span class="line">观察者: 2 事件: completed</span><br></pre></td></tr></table></figure>



<h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents a value that changes over time.</span></span><br><span class="line"><span class="comment">/// Observers can subscribe to the subject to receive the last (or initial) value and all subsequent notifications.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">BehaviorSubject</span>&lt;<span class="title class_">Element</span>&gt;</span><br></pre></td></tr></table></figure>

<p>当您希望使用最新数据预先填充View时, BehaviorSubject非常有用。例如, 可以将用户详情页中的控件绑定到BehaviorSubject, 以便在应用程序获取新数据时, 可以使用最新值来预先填充显示。 </p>
<p><img src="https://gewill.org/assets/RxSwiftBehaviorSubject.png" alt="RxSwiftBehaviorSubject"> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">example(<span class="string">&quot;BehaviorSubject&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line">    <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">BehaviorSubject</span>(value: <span class="string">&quot;🔴&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;1&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐶&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🐱&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;2&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅰️&quot;</span>)</span><br><span class="line">    subject.onNext(<span class="string">&quot;🅱️&quot;</span>)</span><br><span class="line">  </span><br><span class="line">    subject.onCompleted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--- BehaviorSubject example ---</span><br><span class="line">观察者: 1 事件: next(🔴) // 相比ReplaySubject多了订阅前一个事件</span><br><span class="line">观察者: 1 事件: next(🐶)</span><br><span class="line">观察者: 1 事件: next(🐱)</span><br><span class="line">观察者: 2 事件: next(🐱)</span><br><span class="line">观察者: 1 事件: next(🅰️)</span><br><span class="line">观察者: 2 事件: next(🅰️)</span><br><span class="line">观察者: 1 事件: next(🅱️)</span><br><span class="line">观察者: 2 事件: next(🅱️)</span><br><span class="line">观察者: 1 事件: completed</span><br><span class="line">观察者: 2 事件: completed</span><br></pre></td></tr></table></figure>

<h3 id="Relay"><a href="#Relay" class="headerlink" title="Relay"></a>Relay</h3><p>Relay在保持其replay行为的同时包装了subject。与其他subject不同，可以使用 <code>accept(_:)</code> 添加值，而非 <code>onNext(_:)</code>。这是因为Relay只能接受值，即不能向它们添加错误或已完成的事件。</p>
<p>PublishRelay将包装PublishSubject ，而BehaviorRelay将包装BehaviorSubject。中继与包装主体的区别在于，它们可以保证永远不会终止。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RxRelay</span><br><span class="line"></span><br><span class="line">example(<span class="string">&quot;PublishRelay&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line">    <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PublishRelay</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;1&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.accept(<span class="string">&quot;🐶&quot;</span>)</span><br><span class="line">    subject.accept(<span class="string">&quot;🐱&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;2&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.accept(<span class="string">&quot;🅰️&quot;</span>)</span><br><span class="line">    subject.accept(<span class="string">&quot;🅱️&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--- PublishRelay example ---</span><br><span class="line">观察者: 1 事件: next(🐶) //next事件和PublishSubject一样，少了completed事件</span><br><span class="line">观察者: 1 事件: next(🐱)</span><br><span class="line">观察者: 1 事件: next(🅰️)</span><br><span class="line">观察者: 2 事件: next(🅰️)</span><br><span class="line">观察者: 1 事件: next(🅱️)</span><br><span class="line">观察者: 2 事件: next(🅱️)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RxRelay</span><br><span class="line"></span><br><span class="line">example(<span class="string">&quot;BehaviorRelay&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag <span class="operator">=</span> <span class="type">DisposeBag</span>()</span><br><span class="line">    <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">BehaviorRelay</span>&lt;<span class="type">String</span>&gt;(value: <span class="string">&quot;🔴&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;1&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.accept(<span class="string">&quot;🐶&quot;</span>)</span><br><span class="line">    subject.accept(<span class="string">&quot;🐱&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subject.addObserver(<span class="string">&quot;2&quot;</span>).disposed(by: disposeBag)</span><br><span class="line">    subject.accept(<span class="string">&quot;🅰️&quot;</span>)</span><br><span class="line">    subject.accept(<span class="string">&quot;🅱️&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- BehaviorRelay example ---</span><br><span class="line">观察者: 1 事件: next(🔴)  //next事件和BehaviorSubject，少了completed事件</span><br><span class="line">观察者: 1 事件: next(🐶)</span><br><span class="line">观察者: 1 事件: next(🐱)</span><br><span class="line">观察者: 2 事件: next(🐱)</span><br><span class="line">观察者: 1 事件: next(🅰️)</span><br><span class="line">观察者: 2 事件: next(🅰️)</span><br><span class="line">观察者: 1 事件: next(🅱️)</span><br><span class="line">观察者: 2 事件: next(🅱️)</span><br></pre></td></tr></table></figure>



<h2 id="第四章：Observables-和-Subjects-实践"><a href="#第四章：Observables-和-Subjects-实践" class="headerlink" title="第四章：Observables 和 Subjects 实践"></a>第四章：Observables 和 Subjects 实践</h2><p>本章重点是在一个完整的应用开发中使用RxSwift，一步一步的学会如何把概念应用到实际项目中。</p>
<h3 id="在-view-controller-中使用-subject-x2F-relay"><a href="#在-view-controller-中使用-subject-x2F-relay" class="headerlink" title="在 view controller 中使用 subject&#x2F;relay"></a>在 view controller 中使用 subject&#x2F;relay</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">  images</span><br><span class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> imagePreview] photos <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> preview <span class="operator">=</span> imagePreview <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      preview.image <span class="operator">=</span> photos.collage(size: preview.frame.size)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line"></span><br><span class="line">  images</span><br><span class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] photos <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span><span class="operator">?</span>.updateUI(photos: photos)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disposed(by: bag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-subject-在-view-controller-之间传值"><a href="#使用-subject-在-view-controller-之间传值" class="headerlink" title="使用 subject 在 view controller 之间传值"></a>使用 subject 在 view controller 之间传值</h3><p>view controller 之间传值可以通过 delegate，但是用 subject 更好。</p>
<p><img src="https://gewill.org/assets/Talkingtootherviewcontrollersviadelegate.jpg" alt="Talkingtootherviewcontrollersviadelegate"></p>
<p><img src="https://gewill.org/assets/Talkingtootherviewcontrollersviasubjects.jpg" alt="Talkingtootherviewcontrollersviasubjects"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@IBAction</span> <span class="keyword">func</span> <span class="title function_">actionAdd</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> photosViewController <span class="operator">=</span> storyboard<span class="operator">!</span>.instantiateViewController(</span><br><span class="line">        withIdentifier: <span class="string">&quot;PhotosViewController&quot;</span>) <span class="keyword">as!</span> <span class="type">PhotosViewController</span></span><br><span class="line"></span><br><span class="line">    navigationController<span class="operator">!</span>.pushViewController(photosViewController, animated: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    photosViewController.selectedPhotos</span><br><span class="line">        .subscribe(</span><br><span class="line">            onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] newImage <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> images <span class="operator">=</span> <span class="keyword">self</span><span class="operator">?</span>.images <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">                images.accept(images.value <span class="operator">+</span> [newImage])</span><br><span class="line">            &#125;,</span><br><span class="line">            onDisposed: &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;completed photo selection&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .disposed(by: bag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装已有API为Observable"><a href="#封装已有API为Observable" class="headerlink" title="封装已有API为Observable"></a>封装已有API为Observable</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoWriter</span> &#123;</span><br><span class="line">  <span class="keyword">enum</span> <span class="title class_">Errors</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> couldNotSavePhoto</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">save</span>(<span class="keyword">_</span> <span class="params">image</span>: <span class="type">UIImage</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">var</span> savedAssetId: <span class="type">String</span>?</span><br><span class="line">      <span class="type">PHPhotoLibrary</span>.shared().performChanges(&#123;</span><br><span class="line">        <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">PHAssetChangeRequest</span>.creationRequestForAsset(from: image)</span><br><span class="line">        savedAssetId <span class="operator">=</span> request.placeholderForCreatedAsset<span class="operator">?</span>.localIdentifier</span><br><span class="line">      &#125;, completionHandler: &#123; success, error <span class="keyword">in</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">          <span class="keyword">if</span> success, <span class="keyword">let</span> id <span class="operator">=</span> savedAssetId &#123;</span><br><span class="line">            observer.onNext(id)</span><br><span class="line">            observer.onCompleted()</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            observer.onError(error <span class="operator">??</span> <span class="type">Errors</span>.couldNotSavePhoto)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RxSwift-traits-实践"><a href="#RxSwift-traits-实践" class="headerlink" title="RxSwift traits 实践"></a>RxSwift traits 实践</h3><h4 id="Single"><a href="#Single" class="headerlink" title="Single"></a>Single</h4><p>Single 只有<code>.success</code> 或 <code>.error</code> 两种事件 。适合作为封装网络接口的返回值，要么成功，要么失败。<img src="https://gewill.org/assets/single.jpg" alt="single"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PhotoWriter</span>.save(image)</span><br><span class="line">      .asSingle()</span><br><span class="line">      .subscribe(onSuccess: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] id <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Saved with id: <span class="subst">\(id)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">self</span><span class="operator">?</span>.actionClear()</span><br><span class="line">        &#125;, onError: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Error&quot;</span>, description: error.localizedDescription)</span><br><span class="line">      &#125;)</span><br><span class="line">      .disposed(by: bag)</span><br></pre></td></tr></table></figure>

<h4 id="Maybe"><a href="#Maybe" class="headerlink" title="Maybe"></a>Maybe</h4><p>Maybe 有三种事件：<code>.success</code>、<code>.completed</code> 和 <code>.error</code> 。</p>
<p>和 Single 一样，你既可以通过 <code>Maybe.create(&#123; ... &#125;)</code> 直接创建，也可以使用 <code>.asMaybe()</code></p>
<p><img src="https://gewill.org/assets/maybe.jpg" alt="maybe"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PhotoWriter</span>.save(image)</span><br><span class="line">    .asMaybe()</span><br><span class="line">    .subscribe(</span><br><span class="line">        onSuccess: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] id <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Saved with id: <span class="subst">\(id)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.actionClear()</span><br><span class="line">        &#125;,</span><br><span class="line">        onError: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Error&quot;</span>, description: error.localizedDescription)</span><br><span class="line">        &#125;,</span><br><span class="line">        onCompleted: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Saved&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    .disposed(by: bag)</span><br></pre></td></tr></table></figure>

<h4 id="Completable"><a href="#Completable" class="headerlink" title="Completable"></a>Completable</h4><p>Completable 只有<code>.completed</code> 和 <code>.error</code> 两种事件。适合只关心是否完成，而不需要传递value的情况。使用方法：<code>Completable.create(&#123; ... &#125;)</code></p>
<p><img src="https://gewill.org/assets/completable.jpg" alt="completable"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoWriter</span> &#123;</span><br><span class="line">  <span class="keyword">enum</span> <span class="title class_">Errors</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> couldNotSavePhoto</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">save</span>(<span class="keyword">_</span> <span class="params">image</span>: <span class="type">UIImage</span>) -&gt; <span class="type">Completable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Completable</span>.create &#123; completable <span class="keyword">in</span></span><br><span class="line">      <span class="type">PHPhotoLibrary</span>.shared().performChanges(&#123;</span><br><span class="line">        <span class="type">PHAssetChangeRequest</span>.creationRequestForAsset(from: image)</span><br><span class="line">      &#125;, completionHandler: &#123; success, error <span class="keyword">in</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">          <span class="keyword">if</span> success &#123;</span><br><span class="line">            completable(.completed)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            completable(.error(error <span class="operator">??</span> <span class="type">Errors</span>.couldNotSavePhoto))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">PhotoWriter</span>.save(image)</span><br><span class="line">  .subscribe(</span><br><span class="line">    onCompleted: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Saved&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    onError: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span><span class="operator">?</span>.showMessage(<span class="string">&quot;Error&quot;</span>, description: error.localizedDescription)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .disposed(by: bag)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/10/Realm-Notes-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Ge Will">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Will's Blog">
      <meta itemprop="description" content="The people who are crazy enough to think they can change the world, are the ones who DO.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Will's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/10/Realm-Notes-2/" class="post-title-link" itemprop="url">Realm 笔记(二)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-05-10 20:46:38" itemprop="dateCreated datePublished" datetime="2018-05-10T20:46:38+08:00">2018-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-01-13 11:01:04" itemprop="dateModified" datetime="2025-01-13T11:01:04+08:00">2025-01-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://cdn-images-1.medium.com/max/1600/1*s1KQFE3IHyzb_PKF-q_wHA@2x.png" alt="RealmsSchema"></p>
<p><strong>系列文章目录：</strong></p>
<ol>
<li><a target="_blank" rel="noopener" href="http://gewill.org/2018/04/26/Realm-Notes-1/">Realm 笔记 (一)</a></li>
<li><a target="_blank" rel="noopener" href="http://gewill.org/2018/05/10/Realm-Notes-2/">Realm 笔记 (二)</a></li>
</ol>
<h3 id="第七章：Realm配置"><a href="#第七章：Realm配置" class="headerlink" title="第七章：Realm配置"></a>第七章：<strong>Realm</strong>配置</h3><p>打开一个Realm:<code>let realm = try! Realm()</code></p>
<p>Realm没有使用单例，而是每次直接尝试新建一个Realm实例，有以下几个运行时优化：</p>
<ol>
<li>调用Realm()返回同一个共享实例，而不受创建该Realm实例的线程限制。而Object和Realm实例被限制在创建的线程中，所以不能跨线程分享。</li>
<li>Realm也提供了多个安全措施，如：使用不同的密钥或文件不存在均会报错。</li>
</ol>
<blockquote>
<p>书中均使用 try! ，但实际生产环境你可以进行错误处理。</p>
</blockquote>
<p><code>deleteRealmIfMigrationNeeded</code> 新版直接删除Realm文件，不做迁移处理。</p>
<p>存在文件在Documents文件夹有几个好处：自动备份到用户的iCloud storage，方便用户使用iTunes备份和访问。当然苹果推荐存储文件在Library文件夹。</p>
<p>App Bundle 文件夹是只读的，所以该目录中的Realm是能作为只读数据库。</p>
<p>加密在Realm极为简单，只要在配置中添加一个64位的密钥即可。</p>
<h3 id="第八章：多个Realm和共享Realm"><a href="#第八章：多个Realm和共享Realm" class="headerlink" title="第八章：多个Realm和共享Realm"></a>第八章：多个<strong>Realm</strong>和共享<strong>Realm</strong></h3><p>创建一个RealmProvider以方便操作Realm，尤其是涉及多个Realm或加密等情况。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*W8tnptm39Ixw0gvV-ub4FA.jpeg" alt="img"></p>
<p>如需转换JSON、CSV或纯文本为Realm，并内置到App Bundle。此时可以创建一个Target和来Tools.swift，自动生成Realm文件。把生成的Realm文件拖入Xcode即可。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*PQoGupwjm1ZNHXXRjQysUA.jpeg" alt="img"></p>
<h3 id="第九章：依赖注入和测试"><a href="#第九章：依赖注入和测试" class="headerlink" title="第九章：依赖注入和测试"></a>第九章：依赖注入和测试</h3><p>在本章中，您将学习两个重要主题：如何使用依赖注入来改进 Flash Cards 应用的架构，以及如何编写由Realm支持的同步和异步测试。</p>
<p>本章不会深入研究诸如测试驱动开发等主题，而是专注测试使用 Realm Object的类的技巧，并且依赖于特定于Realm的功能，例如更改通知。</p>
<h4 id="测试-cards-场景-Scene"><a href="#测试-cards-场景-Scene" class="headerlink" title="测试 cards 场景(Scene)"></a><strong>测试 cards 场景(Scene)</strong></h4><ul>
<li>CardsViewController：设置所需的手势识别器并根据用户的输入更新UI。本章不会介绍UI测试。</li>
<li>CardsModel：从Realm中抽象查询对象的简单封装。为它编写测试将意味着在测试中重复相同的代码并比较输出，而不提供实际值。除此之外，你真正要在这里测试的将是Realm的底层实现，它已经经过了充分测试。</li>
<li>CardsViewModel：实现此场景的业务逻辑。它格式化Model的输出，以显示在屏幕上，并提供与模型交互的方法。这将是一些单元测试的完美候选！</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*vhkdTdhoOoY1dQW3yPescA.jpeg" alt="img"></p>
<p>这里只是简单测试 ViewModel 初始化和更新状态。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*dmF8jn3bhAwCz7kzsys2cw.jpeg" alt="img"></p>
<h4 id="测试-sets-场景"><a href="#测试-sets-场景" class="headerlink" title="测试 sets 场景"></a>测试 sets 场景</h4><p>在显示列表的场景中，您的视图模型依赖于Realm通知来动态更新数据。你必须：</p>
<ul>
<li>模拟Realm框架以测试依赖通知的 ViewModel 和其他高级Realm功能。</li>
<li>编写依赖Realm通知的测试</li>
</ul>
<p>为了使测试有效，您需要稍微更改代码以提供一个方法将测试的 Realm providers 注入到Model和ViewModel中。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*gfi15_iu5vDJ-u7YgZ6dcQ.jpeg" alt="img"></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*xnR1I5wQ3laa3dVpLMqPoQ.jpeg" alt="img"></p>
<p>异步测试需要使用XCTestExpectation，这个期望类将帮助你等待某些条件在您的测试中得到满足，然后再转到您测试断言的部分。</p>
<p>在使用XCTWaiter类来持有测试的执行，直到满足期望为止。 XCTWaiter是Apple的XCTest框架中的一个便捷类，它暂时停止当前代码的执行，而不会阻塞当前线程。 XCTWaiter定期检查期望的状态，因此当异步代码将执行计数增加到3时，XCTWaiter将负责恢复执行测试。</p>
<p>步骤如下：</p>
<ul>
<li>初始化XCTestExpectation和expectedFulfillmentCount</li>
<li>在异步回调中fulfill，</li>
<li>最后添加定期检查结果的帮助类XCTWaiter。</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*dTCJ1PW8lPGR6l3_W5GBnQ.jpeg" alt="img"></p>
<h4 id="测试-Word-of-Today-场景"><a href="#测试-Word-of-Today-场景" class="headerlink" title="测试 Word of Today 场景"></a>测试 Word of Today 场景</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*FDEM3iDyXtpv-Yqp3iRIIA.jpeg" alt="img"></p>
<h4 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h4><p>在本章中，你将亲身体验用Realm编写同步和异步测试的简易性。本章中重点是：</p>
<ul>
<li>测试自己的逻辑，而不是Realm，因为它已经在全球数百万用户中得到了充分测试和使用。</li>
<li>“哑”模型和视图控制器可以更轻松地测试视图模型，您通常可以在其中放置MVVM应用程序的逻辑。</li>
<li>编写需要这些依赖项的特定测试版本的测试时，使用中央provider结构来抽取某些依赖项的检索很有用。</li>
</ul>
<p>通常，测试基于Realm的代码可能不会改变您构建自己的测试套件的方式。借助本章的经验，您应该能够为您的Realm项目编写可靠的测试，无论你心意哪一种架构。</p>
<blockquote>
<p>注意：对于单元测试，模拟Realm本身是一个偏爱的问题。如果你想模拟Realm并从测试套件中删除Realm依赖关系，你可以模拟关键的方法，比如对象（^）、过滤器（^）等等。风险是你必须增加和保持的代码量，以保持与Realm自己行为的一致，尤其是已经有了基于内存的Realm这个特别棒的方案。</p>
</blockquote>
<blockquote>
<p>笔者觉得模拟Realm的唯一好处是，Realm依赖增加了CI服务器需要安装，构建和测试应用程序的时间。</p>
</blockquote>
<h3 id="第十章：高效率的多线程"><a href="#第十章：高效率的多线程" class="headerlink" title="第十章：高效率的多线程"></a>第十章：高效率的多线程</h3><p>Realm线程：多线程访问同一个Realm总是可以读写到最新的数据。</p>
<p>线程间传递Object，有以下两个替代方法：</p>
<ul>
<li>传递Object的主键</li>
<li>使用ThreadSafeReference：<code>let ref = ThreadSafeReference(to: myRealmObject)</code> 和 <code>let myRealmobject = realm.resolve(ref)</code></li>
</ul>
<p>主线程：访问带主键合适数量的数据时，无需担心性能问题。如在View Controller lifecycle 和 UIKit delegate 中直接读取Object，和更新UI。因为总是在同一个Realm文件的快照中工作，所以速度最快。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Sae-yNE-Z8AiShY1NJPY9A.jpeg" alt="img"></p>
<p>后台线程：（不推荐）由于是异步并发执行，会因为Realm 快照之间同步问题，产生性能和体积大的问题。</p>
<p>专用线程：（推荐）可以解决主线程影响UI，后台线程性能问题。使用Thread，自己维护一个线程的生命周期，所有读写都在该线程操作。还可以缓存任务批量提交读写事务，进一步提高性能。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*vJX_oPQhAAXBeFCDHFyIfQ.jpeg" alt="img"></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*qdG-8dAadridla-Oztjq5w.jpeg" alt="img"></p>
<p>简版（无缓冲机制）</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*yaxbDhdgZUPxzFNbAIEozA.jpeg" alt="img"></p>
<blockquote>
<p><em>未完待续…</em></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ge Will</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
